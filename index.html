<!DOCTYPE html>
<html lang="de">
<head>
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#00aa44" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trade App Layout</title>
  <style>
    body {
      background: #111;
      color: white;
      font-family: sans-serif;
      margin: 0;
      padding: 0;
    }
    .header {
      background: #1c1c1c;
      padding: 10px;
      text-align: center;
      font-size: 18px;
    }
    .session-bar {
      height: 10px;
      background: linear-gradient(to right, #00aaff, #ffaa00, #ff3300);
      margin-top: 5px;
    }
	
    .main {
      padding: 20px;
      padding-bottom: 120px; /* Platz f√ºr Positionsleiste */
      text-align: center;
    }
    .big-btn {
      padding: 20px 30px;
      font-size: 22px;
      font-weight: bold;
      border-radius: 15px;
      border: none;
      background-color: #00aa44;
      color: white;
      margin: 20px auto;
      width: 80%;
      max-width: 300px;
    }
    .tab-buttons {
      text-align: center;
      margin-top: 20px;
    }
    .tab-buttons button {
      background: #333;
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      margin: 5px;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }
    .tab-buttons .active {
      background: #0077cc;
    }
    .stats-box {
      background: #222;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      text-align: left;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
    #resetBtn {
      background: #cc3333;
      color: white;
      padding: 12px;
      border: none;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
      font-weight: bold;
      margin: 20px auto 30px auto;
      cursor: pointer;
      display: block;
      user-select: none;
      position: relative; /* kein fixed */
      z-index: auto;
    }
    .position-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #1c1c1c;
      padding: 10px;
      display: flex;
      gap: 10px;
      overflow-x: auto;
      box-sizing: border-box;
      z-index: 10000; /* √ºber anderen Elementen */
	  touch-action: pan-y; /* Erlaubt vertikales Scrollen, verhindert horizontale Interferenzen */
    }
    .trade-box {
      flex: 0 0 auto;
      box-sizing: border-box;
      width: 85%;
      max-width: 280px;
      background: #333;
      padding: 10px;
      border-radius: 10px;
      min-width: 180px;
      color: white;
      user-select: none;
      z-index: 10001; /* √ºber reset Button */
	   touch-action: none; /* Damit alle Touch-Events an JS gehen */
      position: relative;
    }
    .trade-box.Long {
      background-color: #228B22; /* gr√ºn */
    }
    .trade-box.Short {
      background-color: #B22222; /* rot */
    }
    .result-value {
      margin-top: 5px;
      font-weight: bold;
    }
    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      padding: 20px;
      border-radius: 10px;
      display: none;
      z-index: 1000;
      width: 90%;
      max-width: 300px;
      color: white;
    }
    label {
      cursor: pointer;
      user-select: none;
      margin-right: 15px;
      display: inline-block;
    }
    #pairMultiSelect {
      max-height: 150px;
      overflow-y: auto;
      background: #222;
      padding: 5px;
      border-radius: 6px;
      color: white;
      margin-bottom: 10px;
      text-align: left;
    }
    select, input {
      padding: 8px;
      margin-top: 10px;
      width: 100%;
      border-radius: 5px;
      border: none;
      font-size: 16px;
    }
    .popup button {
      margin-top: 10px;
      padding: 10px;
      width: 100%;
      font-size: 16px;
      cursor: pointer;
    }
    .ticker {
      width: 100%;
      background: #222;
      color: #00ff99;
      padding: 10px;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      font-family: Arial, sans-serif;
      user-select: none;
    }
    .session-info {
      margin-top: 5px;
      font-size: 14px;
      color: #aaf0aa;
      text-align: center;
      font-style: italic;
      user-select: none;
    }
	
.session-details-box {
  display: none;
  background: #1a1a1a;
  padding: 15px;
  margin: 10px 20px;
  border-radius: 10px;
  font-size: 14px;
  color: #eee;
  text-align: left;
  box-shadow: 0 0 10px rgba(0,0,0,0.4);
}


  .session-details-box {
    font-size: 13px;
    margin: 10px;
    padding: 12px;
    line-height: 1.4;
  }

  .session-header, #sessionText {
    font-size: 16px;
    padding: 12px;
  }
  
  #sessionText {
  user-select: none;
  cursor: pointer;
}
    .progress-container {
      position: relative;
      background: #111;
      height: 24px;
      width: 100%;
      border-top: 1px solid #333;
      border-bottom: 1px solid #333;
      overflow: hidden;
      border-radius: 6px;
      margin-top: 5px;
    }
    .progress-bar {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 0%; /* wird per JS gesetzt */
      background: linear-gradient(to right, #00aaff, #ffaa00, #ff3300);
      transition: width 1s linear;
      background-size: 100% 100%;
      background-repeat: no-repeat;
      z-index: 2;
    }
	
	.session-details-box ul {
  padding-left: 20px;
  margin-top: 8px;
  margin-bottom: 8px;
  list-style-type: disc;
}

.session-details-box li {
  margin-bottom: 4px;
}

.tool-button {
  background-color: #333;
  color: white;
  border: none;
  padding: 10px 20px;
  margin: 5px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
}
.tool-button:hover {
  background-color: #444;
}
	
  </style>
</head>
<body>



<div class="ticker" id="sessionText">Session-Zeit: 00:00</div>
<div class="session-info" id="sessionInfo">Tipps und Infos zur Session erscheinen hier...</div>
<div class="progress-container">
  <div class="progress-bar" id="progressBar"></div>
</div>
<!-- HIER EINSETZEN -->
<div id="sessionProgressDisplay"
     style="text-align:center;
            font-size: 16px;
            font-weight: bold;
            margin-top: 8px;
            color: #00ff99;
            background: #111;
            padding: 6px;
            border-radius: 8px;">
</div>

<div class="session-details-box" id="sessionDetailsBox"></div>
<div class="alert-below-header" id="alertBox"></div>

<div class="tab-buttons" style="margin-top: 20px;">
  <button class="btn" id="btn-calc-pos" onclick="switchCalcTab('pos')">üìê Position Size</button>
  <button class="btn" id="btn-calc-risk" onclick="switchCalcTab('risk')">üìä Risiko %</button>
  <button class="btn" id="btn-calc-lot" onclick="switchCalcTab('lot')">üßÆ Lot-Rechner</button>
  <button class="btn" id="btn-calc-breakeven" onclick="switchCalcTab('breakeven')">üß† Break-even</button>
</div>



<div id="calc-pos" class="calc-box" style="margin-top: 15px; display:none;">

  <div class="stats-box">
    <label for="accountSize">üì¶ Kontogr√∂√üe (‚Ç¨):</label>
    <input type="number" id="accountSize" placeholder="z.‚ÄØB. 1000" />

    <label for="riskPercent">‚ö†Ô∏è Risiko in %:</label>
    <input type="number" id="riskPercent" placeholder="z.‚ÄØB. 1" step="0.1" />

    <label for="stopLossPips">üõë Stop-Loss (in Pips):</label>
    <input type="number" id="stopLossPips" placeholder="z.‚ÄØB. 20" />

<label for="symbolSelector">üí± Trading-Paar:</label>
<select id="symbolSelector">
  <optgroup label="üåç Forex Standard">
    <option value="AUD/USD">AUD/USD</option>
    <option value="EUR/USD">EUR/USD</option>
    <option value="GBP/USD">GBP/USD</option>
    <option value="NZD/USD">NZD/USD</option>
    <option value="USD/CHF">USD/CHF</option>
    <option value="USD/CAD">USD/CAD</option>
  </optgroup>

  <optgroup label="üí¥ Forex Yen-Paare">
    <option value="USD/JPY">USD/JPY</option>
    <option value="EUR/JPY">EUR/JPY</option>
    <option value="GBP/JPY">GBP/JPY</option>
    <option value="CHF/JPY">CHF/JPY</option>
    <option value="AUD/JPY">AUD/JPY</option>
    <option value="NZD/JPY">NZD/JPY</option>
    <option value="CAD/JPY">CAD/JPY</option>
  </optgroup>

  <optgroup label="üîÅ Cross-Paare">
    <option value="EUR/GBP">EUR/GBP</option>
    <option value="EUR/AUD">EUR/AUD</option>
    <option value="EUR/CAD">EUR/CAD</option>
    <option value="GBP/AUD">GBP/AUD</option>
    <option value="GBP/CAD">GBP/CAD</option>
    <option value="AUD/CAD">AUD/CAD</option>
  </optgroup>

  <optgroup label="ü•á Metalle">
    <option value="XAU/USD">XAU/USD</option>
    <option value="XAG/USD">XAG/USD</option>
  </optgroup>

  <optgroup label="ü™ô Krypto">
    <option value="BTC/USD">BTC/USD</option>
    <option value="ETH/USD">ETH/USD</option>
  </optgroup>

  <optgroup label="üìä Indizes">
    <option value="US30">US30</option>
    <option value="NAS100">NAS100</option>
    <option value="SPX500">SPX500</option>
    <option value="GER40">GER40</option>
    <option value="UK100">UK100</option>
  </optgroup>
  
</select>

<label for="leverage">‚öôÔ∏è Hebel:</label>
<input type="number" id="leverage" value="500" min="1" placeholder="z.‚ÄØB. 500" />




    <button onclick="calculatePositionSize()">üìê Berechnen</button>
    <p id="positionSizeResult" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
  </div>

  <div style="text-align:right; margin-bottom: 5px;">
    <span onclick="toggleInfoBox()" 
          style="cursor:pointer; background:#444; border-radius:50%; padding:3px 8px; font-weight:bold; color:#0ff;"
          title="Erkl√§rung anzeigen">i</span>
  </div>
  <div id="posInfoBox" style="display:none; background:#222; padding:12px; border-radius:8px; margin-top:10px; color:#ccc; font-size:14px; text-align:left;">
    <strong>‚ÑπÔ∏è Was macht dieser Rechner?</strong><br><br>
    Der Positionsgr√∂√üen-Rechner hilft dir zu ermitteln, wie viele Lots du in einem Trade einsetzen darfst, ohne mehr als einen bestimmten Prozentsatz deines Kontos zu riskieren. Die Berechnung basiert auf vier Angaben:
    <ul style="margin-top:10px; margin-bottom:10px;">
      <li><strong>üì¶ Kontogr√∂√üe:</strong> Dein aktuelles Guthaben in Euro.</li>
      <li><strong>‚ö†Ô∏è Risiko in %:</strong> Wie viel Prozent deines Kontos du maximal pro Trade verlieren willst (z.‚ÄØB. 1%).</li>
      <li><strong>üõë Stop-Loss (Pips):</strong> Die Distanz zwischen Einstieg und Stop-Loss in Pips.</li>
      <li><strong>üí° Pip-Wert pro Lot:</strong> Wie viel ein Pip pro Standard-Lot wert ist (z.‚ÄØB. 10‚ÄØ‚Ç¨ bei EUR/USD).</li>
    </ul>
    <strong>üìê Formel:</strong><br>
    <code style="color:#0ff;">Positionsgr√∂√üe = (Kontogr√∂√üe √ó Risiko%) / (Stop-Loss √ó Pip-Wert)</code><br><br>
    <strong>üîç Beispiel:</strong><br>
    Kontogr√∂√üe: 1000 ‚Ç¨<br>
    Risiko: 2%<br>
    Stop-Loss: 20 Pips<br>
    Pip-Wert: 10 ‚Ç¨/Lot<br><br>
    <strong>‚Üí</strong> Du riskierst 20 ‚Ç¨ (1000‚ÄØ√ó‚ÄØ0,02).<br>
    <strong>‚Üí</strong> Bei 20 Pips w√§ren das 1‚ÄØ‚Ç¨/Pip erlaubt (20‚ÄØ‚Ç¨ / 20‚ÄØPips).<br>
    <strong>‚Üí</strong> Der Pip-Wert ist 10‚ÄØ‚Ç¨/Lot ‚áí <strong>Erlaubte Lotgr√∂√üe: 0.10</strong><br><br>
    <em style="color:#aaa;">Hinweis: Bei Indizes oder Gold kann der Pip-Wert unterschiedlich sein!</em>
  </div>
</div>

<div id="calc-risk" class="calc-box" style="display:none; margin-top: 15px;">
 <div class="stats-box">
  <label for="riskAccountSize">üì¶ Kontogr√∂√üe (‚Ç¨):</label>
  <input type="number" id="riskAccountSize" placeholder="z.‚ÄØB. 1000" />

  <label for="riskLotSize">üßÆ Lotgr√∂√üe:</label>
  <input type="number" id="riskLotSize" placeholder="z.‚ÄØB. 0.1" step="0.01" />

  <label for="riskStopLoss">üõë Stop-Loss (Pips):</label>
  <input type="number" id="riskStopLoss" placeholder="z.‚ÄØB. 25" />

  <label for="riskPipValue">üí° Pip-Wert pro Lot (‚Ç¨):</label>
  <input type="number" id="riskPipValue" placeholder="z.‚ÄØB. 10" value="10" />

  <label for="useTradingView">‚öôÔ∏è TradingView-Modus:</label>
  <input type="checkbox" id="useTradingView" onchange="togglePipMode()" />

  <div id="tvNote" style="font-size: 12px; color: #aaa; margin-top: 5px; display:none;">
    üìâ Pip-Wert wird intern mit <strong>6.30 ‚Ç¨</strong> angenommen (wie bei TradingView)
  </div>

  <button onclick="calculateRiskPercent()">üìä Risiko berechnen</button>
  <p id="riskResult" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
</div>

  <div style="text-align:right; margin-bottom: 5px;">
    <span onclick="toggleRiskInfo()" 
          style="cursor:pointer; background:#444; border-radius:50%; padding:3px 8px; font-weight:bold; color:#0ff;"
          title="Erkl√§rung anzeigen">i</span>
  </div>

  <div id="riskInfoBox" style="display:none; background:#222; padding:12px; border-radius:8px; margin-top:10px; color:#ccc; font-size:14px; text-align:left;">
    <strong>‚ÑπÔ∏è Was macht dieser Rechner?</strong><br><br>
    Der Risiko-%-Rechner zeigt dir, wie viel Geld du bei einem Trade riskierst und wie viel Prozent deines Kontos das ausmacht. Er basiert auf:

    <ul style="margin-top:10px; margin-bottom:10px;">
      <li><strong>üì¶ Kontogr√∂√üe:</strong> Dein Kontoguthaben in Euro</li>
      <li><strong>üßÆ Lotgr√∂√üe:</strong> Wie gro√ü dein Trade ist (z.‚ÄØB. 0.1 = Mini-Lot)</li>
      <li><strong>üõë Stop-Loss (Pips):</strong> Wie weit der SL vom Einstieg entfernt ist</li>
      <li><strong>üí° Pip-Wert:</strong> Wie viel 1 Pip pro Lot kostet (z.‚ÄØB. 10‚ÄØ‚Ç¨)</li>
    </ul>

    <strong>üìê Formel:</strong><br>
    <code style="color:#0ff;">Risiko (‚Ç¨) = Lotgr√∂√üe √ó SL √ó Pip-Wert<br>
    Risiko-% = Risiko / Kontogr√∂√üe √ó 100</code><br><br>

    <strong>üîç Beispiel:</strong><br>
    Konto: 1000‚ÄØ‚Ç¨<br>
    Lot: 0.2<br>
    SL: 30 Pips<br>
    Pip-Wert: 10‚ÄØ‚Ç¨<br>
    ‚Üí Risiko = 0.2 √ó 30 √ó 10 = 60‚ÄØ‚Ç¨<br>
    ‚Üí Risiko-% = 60 / 1000 = <strong>6‚ÄØ%</strong><br><br>

    <em style="color:#aaa;">Achte darauf, dass dein Risiko unter 2‚ÄØ% bleibt, um langfristig zu √ºberleben.</em>
  </div>
</div>



<div id="calc-lot" class="calc-box" style="display:none; margin-top: 15px;">
  <div class="stats-box">
    <label for="lotFixedRisk">üí∞ Risiko in Euro:</label>
    <input type="number" id="lotFixedRisk" placeholder="z.‚ÄØB. 50" />

    <label for="lotSL">üõë Stop-Loss (in Pips):</label>
    <input type="number" id="lotSL" placeholder="z.‚ÄØB. 20" />

    <label for="lotPipValue">üí° Pip-Wert pro Lot (‚Ç¨):</label>
    <input type="number" id="lotPipValue" placeholder="z.‚ÄØB. 10" value="10" />

    <button onclick="calculateLotFromFixed()">üßÆ Lotgr√∂√üe berechnen</button>

    <p id="lotResult" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
  </div>

  <div style="text-align:right; margin-bottom: 5px;">
    <span onclick="toggleLotInfo()" 
          style="cursor:pointer; background:#444; border-radius:50%; padding:3px 8px; font-weight:bold; color:#0ff;"
          title="Erkl√§rung anzeigen">i</span>
  </div>

  <div id="lotInfoBox" style="display:none; background:#222; padding:12px; border-radius:8px; margin-top:10px; color:#ccc; font-size:14px; text-align:left;">
    <strong>‚ÑπÔ∏è Was macht dieser Rechner?</strong><br><br>
    Du gibst an, wie viel Euro du maximal verlieren willst ‚Äì der Rechner sagt dir, welche Lotgr√∂√üe das erlaubt.<br><br>

    <strong>Beispiel:</strong><br>
    Risiko: 100‚ÄØ‚Ç¨<br>
    SL: 25 Pips<br>
    Pip-Wert: 10‚ÄØ‚Ç¨/Lot<br>
    ‚Üí <code style="color:#0ff;">Lots = 100 / (25 √ó 10) = 0.40</code>
  </div>
</div>

<div id="calc-breakeven" class="calc-box" style="display:none; margin-top: 15px;">
  <div class="stats-box">
    <label for="entryPrice">üéØ Einstiegspreis:</label>
    <input type="number" id="entryPrice" placeholder="z.‚ÄØB. 1.12345" step="0.00001" />

    <label for="spreadPips">üìè Spread (Pips):</label>
    <input type="number" id="spreadPips" placeholder="z.‚ÄØB. 1.5" step="0.1" />

    <label for="fees">üí∏ Geb√ºhren (‚Ç¨):</label>
    <input type="number" id="fees" placeholder="z.‚ÄØB. 2.00" step="0.01" />

    <label for="beLotSize">üßÆ Lotgr√∂√üe:</label>
    <input type="number" id="beLotSize" placeholder="z.‚ÄØB. 0.1" step="0.01" />

    <label for="bePipValue">üí° Pip-Wert pro Lot (‚Ç¨):</label>
    <input type="number" id="bePipValue" placeholder="z.‚ÄØB. 10" value="10" />

    <button onclick="calculateBreakeven()">üß† Break-even berechnen</button>

    <p id="breakevenResult" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
  </div>

  <div style="text-align:right; margin-bottom: 5px;">
    <span onclick="toggleBreakevenInfo()" 
          style="cursor:pointer; background:#444; border-radius:50%; padding:3px 8px; font-weight:bold; color:#0ff;"
          title="Erkl√§rung anzeigen">i</span>
  </div>

  <div id="breakevenInfoBox" style="display:none; background:#222; padding:12px; border-radius:8px; margin-top:10px; color:#ccc; font-size:14px; text-align:left;">
    <strong>‚ÑπÔ∏è Was macht dieser Rechner?</strong><br><br>
    Der Break-even-Rechner zeigt dir den Preis, bei dem dein Trade exakt auf Null l√§uft ‚Äì also weder Gewinn noch Verlust.<br><br>

    Dabei ber√ºcksichtigt werden:
    <ul style="margin-top:10px; margin-bottom:10px;">
      <li><strong>üéØ Einstiegspreis:</strong> Der Preis, zu dem du den Trade ge√∂ffnet hast.</li>
      <li><strong>üìè Spread:</strong> Unterschied zwischen Bid und Ask in Pips.</li>
      <li><strong>üí∏ Geb√ºhren:</strong> z.‚ÄØB. Kommissionen des Brokers.</li>
      <li><strong>üßÆ Lotgr√∂√üe:</strong> Deine aktuelle Positionsgr√∂√üe.</li>
      <li><strong>üí° Pip-Wert:</strong> Wert eines Pips pro Lot (z.‚ÄØB. 10‚ÄØ‚Ç¨ bei Forex).</li>
    </ul>

    <strong>üìê Formel:</strong><br>
    <code style="color:#0ff;">Break-even = Einstiegspreis ¬± (Spread + Geb√ºhren √∑ (Lotgr√∂√üe √ó Pip-Wert))</code><br><br>

    <em style="color:#aaa;">Ob du + oder ‚Äì rechnest, h√§ngt davon ab, ob du Long oder Short bist. Dieser Rechner geht vom LONG-Trade aus.</em>
  </div>
</div>

<div id="calc-leverage" class="calc-box" style="display:none; margin-top: 15px;">
  <div class="stats-box">
    <label for="leverageMode">Berechnungsmodus:</label>
    <select id="leverageMode" onchange="toggleLeverageMode()">
      <option value="capital">üîÅ Hebel ‚ûú Kapital berechnen</option>
      <option value="lotcheck">üìä Hebel + Kapital ‚ûú Lotcheck</option>
    </select>

    <!-- MODUS 1: Hebel ‚ûú Kapital -->
    <div id="capitalMode">
      <label for="leverageInput1">üì¶ Kapital (in ‚Ç¨):</label>
      <input type="number" id="leverageInput1" placeholder="z.‚ÄØB. 500" />

      <label for="leverageInput2">üíº Lotgr√∂√üe:</label>
      <input type="number" id="leverageInput2" placeholder="z.‚ÄØB. 1.0" step="0.01" />

      <label for="leverageInput3">üìà Hebel:</label>
      <input type="number" id="leverageInput3" placeholder="z.‚ÄØB. 10" step="1" />
    </div>

    <!-- MODUS 2: Hebel + Kapital ‚ûú Lotcheck -->
    <div id="lotCheckMode" style="display:none">
  <label for="lotCapital">üì¶ Kapital (in ‚Ç¨):</label>
  <input type="number" id="lotCapital" placeholder="z.‚ÄØB. 250" />

  <label for="lotLeverage">üí° Hebel (z.‚ÄØB. 500):</label>
  <input type="number" id="lotLeverage" placeholder="z.‚ÄØB. 500" />

  <label for="lotPair">üìä W√§hrungspaar:</label>
<select id="lotPair">
  <optgroup label="üîÅ Forex">
    <option value="EUR/USD">EUR/USD</option>
    <option value="GBP/USD">GBP/USD</option>
    <option value="AUD/USD">AUD/USD</option>
    <option value="NZD/USD">NZD/USD</option>
    <option value="USD/CAD">USD/CAD</option>
    <option value="USD/CHF">USD/CHF</option>
    <option value="USD/JPY">USD/JPY</option>
    <option value="EUR/JPY">EUR/JPY</option>
    <option value="GBP/JPY">GBP/JPY</option>
    <option value="CHF/JPY">CHF/JPY</option>
    <option value="AUD/JPY">AUD/JPY</option>
    <option value="CAD/JPY">CAD/JPY</option>
    <option value="EUR/GBP">EUR/GBP</option>
    <option value="EUR/AUD">EUR/AUD</option>
    <option value="EUR/CAD">EUR/CAD</option>
    <option value="GBP/AUD">GBP/AUD</option>
    <option value="GBP/CAD">GBP/CAD</option>
  </optgroup>

  <optgroup label="ü•á Rohstoffe">
    <option value="XAU/USD">XAU/USD (Gold)</option>
    <option value="XAG/USD">XAG/USD (Silber)</option>
  </optgroup>

  <optgroup label="üíπ Indizes">
    <option value="US30">US30 (Dow Jones)</option>
    <option value="NAS100">NAS100 (Nasdaq)</option>
    <option value="SPX500">SPX500 (S&P 500)</option>
    <option value="GER40">GER40 (DAX)</option>
    <option value="UK100">UK100 (FTSE)</option>
  </optgroup>

  <optgroup label="‚Çø Krypto">
    <option value="BTC/USD">BTC/USD</option>
    <option value="ETH/USD">ETH/USD</option>
  </optgroup>
</select>

</div>

    <button onclick="calculateLeverage()">üîß Berechnen</button>
    <p id="leverageResult" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
  </div>
</div>








<div class="popup" id="resultPopup">
  <h3>Ergebnis</h3>
  <input type="text" inputmode="decimal" id="pnlInput" placeholder="z.‚ÄØB. 120.50" value="00,00" />
  <button onclick="saveResult()">Speichern</button>
</div>
<div id="syncStatus" style="text-align:center; color:#00ff99; font-weight:bold; margin-top:10px;"></div>


<div class="position-bar" id="positionBar"></div>

<script>

</script>



  
<script>
function calculatePositionSize() {
  const accountSize = parseFloat(document.getElementById("accountSize").value);
  const riskPercent = parseFloat(document.getElementById("riskPercent").value);
  const stopLossPips = parseFloat(document.getElementById("stopLossPips").value);
  const leverage = parseFloat(document.getElementById("leverage").value);
  const symbol = document.getElementById("symbolSelector").value;
  const manualLots = parseFloat(document.getElementById("manualLots")?.value);
  const resultEl = document.getElementById("positionSizeResult");

  const pipValues = {
    "XAU/USD": 100, "XAG/USD": 50,
    "BTC/USD": 30000, "ETH/USD": 1800,
    "US30": 10, "NAS100": 20, "SPX500": 10, "GER40": 25, "UK100": 10,
    "AUD/USD": 10, "EUR/USD": 10, "GBP/USD": 10, "NZD/USD": 10,
    "USD/CHF": 9.26, "USD/CAD": 7.94,
    "USD/JPY": 9.17, "EUR/JPY": 9.17, "GBP/JPY": 9.17,
    "CHF/JPY": 9.17, "AUD/JPY": 9.17, "NZD/JPY": 9.17, "CAD/JPY": 9.17,
    "EUR/GBP": 10, "EUR/AUD": 10, "EUR/CAD": 10,
    "GBP/AUD": 10, "GBP/CAD": 10, "AUD/CAD": 7.94
  };

  const basisWerte = {
    "XAU/USD": 200000, "XAG/USD": 125000, "BTC/USD": 30000, "ETH/USD": 1800,
    "US30": 10, "NAS100": 20, "SPX500": 10, "GER40": 25, "UK100": 10,
    "EUR/USD": 100000, "GBP/USD": 100000, "AUD/USD": 100000, "NZD/USD": 100000,
    "USD/CAD": 100000, "USD/CHF": 100000, "USD/JPY": 100000, "EUR/JPY": 100000,
    "GBP/JPY": 100000, "CHF/JPY": 100000, "AUD/JPY": 100000, "NZD/JPY": 100000,
    "CAD/JPY": 100000, "EUR/GBP": 100000, "EUR/AUD": 100000, "EUR/CAD": 100000,
    "GBP/AUD": 100000, "GBP/CAD": 100000, "AUD/CAD": 100000
  };

  const pipValueStandard = pipValues[symbol];
  const basis = basisWerte[symbol] || 100000;

  if (
    isNaN(accountSize) || isNaN(riskPercent) || isNaN(stopLossPips) ||
    isNaN(leverage) || accountSize <= 0 || riskPercent <= 0 ||
    stopLossPips <= 0 || leverage <= 0 || !pipValueStandard
  ) {
    resultEl.innerHTML = "‚ùå Bitte alle Felder korrekt ausf√ºllen!";
    resultEl.style.color = "#f44";
    return;
  }

  const riskAmount = accountSize * (riskPercent / 100);
  let baseLot = riskAmount / (stopLossPips * (pipValueStandard));
  const maxLots = (accountSize * leverage) / basis;
  let output = "";

  if (0.01 > maxLots) {
    resultEl.innerHTML = `‚ùå Mit diesem Hebel kannst du dir keine <strong>0.01 Lots</strong> leisten.<br>
      üìè Maximal erlaubt bei ${leverage}x Hebel: <strong>${maxLots.toFixed(4)} Lots</strong><br><br>
      Bitte Hebel oder Kapital erh√∂hen.`;
    resultEl.style.color = "#f44";
    return;
  }
const originalLot = baseLot;
  if (baseLot < 0.01) {
    output += `‚ö†Ô∏è Empfohlene Gr√∂√üe: <strong>${baseLot.toFixed(4)}</strong> Lots (unter 0.01)<br>`;
    output += `üîí Mindestgr√∂√üe: 0.01 Lots ‚Äì Risiko kleiner als erwartet.<br><br>`;
    baseLot = 0.01;
  }

  // üìâ Risiko korrekt berechnen mit pipValue angepasst an Lotgr√∂√üe
  const pipValueActual = pipValueStandard * baseLot;
  const risikoEuroEmpfohlen = stopLossPips * pipValueActual;
  const risikoProzentEmpfohlen = (risikoEuroEmpfohlen / accountSize) * 100;
  
  function getRiskComment(riskPercent) {
  if (riskPercent < 1) return "‚úÖ Sehr konservativ";
  if (riskPercent < 2) return "üü¢ Konservativ";
  if (riskPercent < 5) return "üü° Neutral";
  if (riskPercent < 10) return "üü† Erh√∂htes Risiko";
  if (riskPercent < 20) return "üî¥ Sehr hohes Risiko";
  return "üî• Extrem riskant ‚Äì nur f√ºr Profis!";
}

output += `<br>${getRiskComment(risikoProzentEmpfohlen)}<br><br>`;


 let risikoTitel = "üìâ Dein Risiko:";
if (risikoProzentEmpfohlen >= 10) risikoTitel = "‚ö†Ô∏è Dein Risiko (nicht empfohlen):";
else if (risikoProzentEmpfohlen >= 5) risikoTitel = "üü† Dein Risiko (grenzwertig):";
else if (risikoProzentEmpfohlen >= 2) risikoTitel = "üü° Dein Risiko (moderat):";
else risikoTitel = "‚úÖ Dein Risiko (empfohlen):";

output += `<strong>${risikoTitel}</strong><br>`;
  output += `üí∏ <strong>${risikoEuroEmpfohlen.toFixed(2)}‚ÄØ‚Ç¨</strong> (${risikoProzentEmpfohlen.toFixed(2)}‚ÄØ% von ${accountSize}‚ÄØ‚Ç¨)<br><br>`;

  const steps = [1, 2, 3, 4, 5];
  output += `‚úÖ Empfohlen: <strong>${(baseLot * steps[0]).toFixed(2)}</strong> Lots<br>`;
  output += `üü° Riskant: ${(baseLot * steps[1]).toFixed(2)} Lots (Risiko ${(risikoProzentEmpfohlen * steps[1]).toFixed(1)}%)<br>`;
  output += `üü° Riskant: ${(baseLot * steps[2]).toFixed(2)} Lots (Risiko ${(risikoProzentEmpfohlen * steps[2]).toFixed(1)}%)<br>`;
  output += `üî• Hoch: ${(baseLot * steps[3]).toFixed(2)} Lots (Risiko ${(risikoProzentEmpfohlen * steps[3]).toFixed(1)}%)<br>`;
  output += `üßÆ Sehr hoch: ${(baseLot * steps[4]).toFixed(2)} Lots (Risiko ${(risikoProzentEmpfohlen * steps[4]).toFixed(1)}%)<br>`;
  output += `‚ö†Ô∏è Mehr als ${(baseLot * steps[4]).toFixed(2)} Lots = √ºber deinem Risiko-Limit<br><hr>`;
  output += `üìè Maximal erlaubt bei ${leverage}x Hebel: <strong>${maxLots.toFixed(2)} Lots</strong><br>`;

if (!isNaN(manualLots) && manualLots > 0) {
  const pipValueManuell = pipValueStandard * manualLots;
  const risikoEuroManuell = stopLossPips * pipValueManuell;
  const risikoProzentManuell = (risikoEuroManuell / accountSize) * 100;

  output += `<hr><strong>üìâ Risiko bei manueller Lotgr√∂√üe (${manualLots}):</strong><br>`;
  output += `üí∏ <strong>${risikoEuroManuell.toFixed(2)}‚ÄØ‚Ç¨</strong> (${risikoProzentManuell.toFixed(2)}‚ÄØ% von ${accountSize}‚ÄØ‚Ç¨)<br>`;
}


  resultEl.innerHTML = output;
  resultEl.style.color = "#0f0";
}












function toggleInfoBox() {
  const box = document.getElementById("posInfoBox");
  box.style.display = box.style.display === "none" ? "block" : "none";
}

function calculateLotFromFixed() {
  const riskEuro = parseFloat(document.getElementById("lotFixedRisk").value);
  const sl = parseFloat(document.getElementById("lotSL").value);
  const pipVal = parseFloat(document.getElementById("lotPipValue").value);
  const out = document.getElementById("lotResult");

  if (isNaN(riskEuro) || isNaN(sl) || isNaN(pipVal) ||
      riskEuro <= 0 || sl <= 0 || pipVal <= 0) {
    out.innerHTML = "‚ùå Bitte alle Felder korrekt ausf√ºllen!";
    out.style.color = "#f44";
    return;
  }

  const lotSize = riskEuro / (sl * pipVal);

  out.innerHTML = `‚úÖ Empfohlene Lotgr√∂√üe: <strong>${lotSize.toFixed(2)}</strong> Lots`;
  out.style.color = "#0f0";
}

function toggleLotInfo() {
  const box = document.getElementById("lotInfoBox");
  box.style.display = box.style.display === "none" ? "block" : "none";
}


function togglePipMode() {
  const pipField = document.getElementById("riskPipValue");
  const tvNote = document.getElementById("tvNote");
  const checkbox = document.getElementById("useTradingView");

  if (checkbox.checked) {
    pipField.disabled = true;
    pipField.style.background = "#333";
    tvNote.style.display = "block";
  } else {
    pipField.disabled = false;
    pipField.style.background = "";
    tvNote.style.display = "none";
  }
}
function calculateRiskPercent() {
  const account = parseFloat(document.getElementById("riskAccountSize").value);
  const lot = parseFloat(document.getElementById("riskLotSize").value);
  const sl = parseFloat(document.getElementById("riskStopLoss").value);
  const useTV = document.getElementById("useTradingView").checked;
  const output = document.getElementById("riskResult");

  let pipVal = useTV ? 6.3 : parseFloat(document.getElementById("riskPipValue").value);

  if (
    isNaN(account) || isNaN(lot) || isNaN(sl) ||
    account <= 0 || lot <= 0 || sl <= 0 || isNaN(pipVal) || pipVal <= 0
  ) {
    output.innerHTML = "‚ùå Bitte alle Felder korrekt ausf√ºllen!";
    output.style.color = "#f44";
    return;
  }

  const riskEuro = lot * sl * pipVal;
  const riskPercent = (riskEuro / account) * 100;

  output.innerHTML = `‚ö†Ô∏è Du riskierst <strong>${riskEuro.toFixed(2)} ‚Ç¨</strong>  
                      (${riskPercent.toFixed(2)}‚ÄØ% deines Kontos)`;
  output.style.color = riskPercent <= 2 ? "#0f0" : (riskPercent <= 5 ? "#ffaa00" : "#f44");
}


function toggleRiskInfo() {
  const box = document.getElementById("riskInfoBox");
  box.style.display = box.style.display === "none" ? "block" : "none";
}

function calculateBreakeven() {
  const entry = parseFloat(document.getElementById("entryPrice").value);
  const spread = parseFloat(document.getElementById("spreadPips").value);
  const fees = parseFloat(document.getElementById("fees").value);
  const lot = parseFloat(document.getElementById("beLotSize").value);
  const pipVal = parseFloat(document.getElementById("bePipValue").value);
  const output = document.getElementById("breakevenResult");

  if (isNaN(entry) || isNaN(spread) || isNaN(fees) || isNaN(lot) || isNaN(pipVal) ||
      entry <= 0 || spread < 0 || fees < 0 || lot <= 0 || pipVal <= 0) {
    output.innerHTML = "‚ùå Bitte alle Felder korrekt ausf√ºllen!";
    output.style.color = "#f44";
    return;
  }

  const spreadValue = spread;
  const feeInPips = fees / (lot * pipVal);
  const totalPips = spreadValue + feeInPips;
  const pipSize = 0.0001; // F√ºr Forex (z.‚ÄØB. EUR/USD), ggf. anpassbar
  const breakEvenPrice = entry + (totalPips * pipSize);

  output.innerHTML = `üìç Break-even liegt bei <strong>${breakEvenPrice.toFixed(5)}</strong>`;
  output.style.color = "#0ff";
}

function toggleBreakevenInfo() {
  const box = document.getElementById("breakevenInfoBox");
  box.style.display = box.style.display === "none" ? "block" : "none";
}



function toggleLeverageMode() {
  const mode = document.getElementById("leverageMode").value;
  document.getElementById("capitalMode").style.display = mode === "capital" ? "block" : "none";
  document.getElementById("lotCheckMode").style.display = mode === "lotcheck" ? "block" : "none";
  document.getElementById("leverageResult").innerHTML = "";
}

function calculateLeverage() {
  const mode = document.getElementById("leverageMode").value;
  const resultEl = document.getElementById("leverageResult");

  if (mode === "capital") {
    const capital = parseFloat(document.getElementById("leverageInput1").value);
    const lots = parseFloat(document.getElementById("leverageInput2").value);
    const leverage = parseFloat(document.getElementById("leverageInput3").value);

    if (isNaN(capital) || isNaN(lots) || isNaN(leverage) || capital <= 0 || lots <= 0 || leverage <= 0) {
      resultEl.innerHTML = "‚ùå Bitte alles korrekt eingeben!";
      resultEl.style.color = "#f44";
      return;
    }

    const ben√∂tigtesKapital = (lots * 100000) / leverage;
    resultEl.innerHTML = `üì¶ Du brauchst <strong>${ben√∂tigtesKapital.toFixed(2)} ‚Ç¨</strong> Kapital f√ºr ${lots} Lot bei ${leverage}x Hebel`;
    resultEl.style.color = "#0f0";

  } else if (mode === "lotcheck") {
    const capital = parseFloat(document.getElementById("lotCapital").value);
    const leverage = parseFloat(document.getElementById("lotLeverage").value);
    const pair = document.getElementById("lotPair")?.value || "default";

    if (isNaN(capital) || isNaN(leverage) || capital <= 0 || leverage <= 0) {
      resultEl.innerHTML = "‚ùå Bitte Kapital und Hebel korrekt eingeben!";
      resultEl.style.color = "#f44";
      return;
    }

let basis;
switch (pair) {
  // Metalle
 case "XAU/USD": basis = 200000; break;
case "XAG/USD": basis = 125000; break;

  // Krypto
  case "BTC/USD": basis = 30000; break;
  case "ETH/USD": basis = 1800; break;

  // Indizes
  case "US30":    basis = 10; break;
  case "NAS100":  basis = 20; break;
  case "SPX500":  basis = 10; break;
  case "GER40":   basis = 25; break;
  case "UK100":   basis = 10; break;

  // Forex mit typischer 100k Kontraktgr√∂√üe
  case "EUR/USD":
  case "GBP/USD":
  case "AUD/USD":
  case "NZD/USD":
  case "USD/CAD":
  case "USD/CHF":
    basis = 100000; break;

  // Forex mit leicht abweichendem Pip-Wert / Standard je nach Broker
  case "USD/JPY":
  case "EUR/JPY":
  case "GBP/JPY":
  case "CHF/JPY":
  case "AUD/JPY":
  case "CAD/JPY":
    basis = 100000; break; // Optional auf 1.000.000 JPY setzen, je nach Broker

  // Cross-Paare (ohne USD direkt)
  case "EUR/GBP":
  case "EUR/AUD":
  case "EUR/CAD":
  case "GBP/AUD":
  case "GBP/CAD":
    basis = 100000; break;

  default:
    basis = 100000; break; // Fallback f√ºr unbekannte Paare
}
   

    const maxLots = (capital * leverage) / basis;
    let output = `üí∞ <strong>Max. Lotgr√∂√üe (${pair}):</strong> ${maxLots.toFixed(2)} Lot<br><br>üìä <strong>St√ºckelung:</strong><br>`;

    const lotSizes = [1.00, 0.80, 0.50, 0.40, 0.20, 0.10, 0.01];
    lotSizes.forEach(size => {
      const times = Math.floor(maxLots / size);
      output += `‚ñ∏ ${size.toFixed(2)} Lot = ${times > 0 ? times + "x" : "‚ùå nicht m√∂glich"}<br>`;
    });

    resultEl.innerHTML = output;
    resultEl.style.color = "#0f0";
  }
}






function switchCalcTab(tab) {
  // Alle Rechner ausblenden
  document.querySelectorAll(".calc-box").forEach(box => {
    box.style.display = "none";
  });

  // Den gew√ºnschten Rechner einblenden
  const target = document.getElementById("calc-" + tab);
  if (target) target.style.display = "block";

  // Alle Buttons zur√ºcksetzen
  document.querySelectorAll(".tab-buttons .btn").forEach(btn => btn.classList.remove("active"));

  // Den aktiven Button markieren
  const btn = document.getElementById("btn-calc-" + tab);
  if (btn) btn.classList.add("active");
}

window.addEventListener("DOMContentLoaded", () => {
  initPipPairSelect();
});

</script>
  
<script>
const sessionText = document.getElementById("sessionText");
const sessionProgressEl = document.getElementById("sessionProgressDisplay");
const sessionInfoEl = document.getElementById("sessionInfo");
const sessionDetailsBox = document.getElementById("sessionDetailsBox");
const alertBox = document.getElementById("alertBox");
const progressBar = document.getElementById("progressBar");
const progressContainer = document.querySelector(".progress-container");

sessionText.addEventListener("click", () => {
  sessionDetailsBox.style.display = sessionDetailsBox.style.display === "block" ? "none" : "block";
});

function formatHM(mins) {
  const h = Math.floor(mins / 60) % 24;
  const m = mins % 60;
  return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
}

const sessionColors = {
  Sydney: "#3388ff",
  Tokyo: "#00aaff",
  London: "#ffd700",
  "New York": "#ff4500",
  "London Killzone": "#ccff00",
  "New York Killzone": "#ff8800",
  Deadzone: "#333",
};

const sessions = [
  {
    name: "Sydney",
    start: 1380,
    end: 480,
    info: "Ruhiger Markt, geringere Liquidit√§t, Vorbereitung auf Asien.",
    weekDaysInfo: [
      { day: "Sonntag", text: "üõ†Ô∏è Vorbereitung auf neue Woche" },
      { day: "Montag", text: "üåè Asien-Session startet" },
      { day: "Mittwoch", text: "üìä Wirtschaftsdaten Australien" },
      { day: "Freitag", text: "üìÖ W√∂chentliche Analyse & Planung" }
    ],
  },
  {
    name: "Tokyo",
    start: 60,
    end: 600,
    info: "Moderate Volatilit√§t, Fokus auf JPY/AUD/NZD, Breakouts m√∂glich.",
    weekDaysInfo: [
      { day: "Dienstag", text: "üè¶ BoJ Pressekonferenz" },
      { day: "Donnerstag", text: "üìà Japan BIP-Daten" },
      { day: "Freitag", text: "üá∫üá∏ US NFP wirkt oft nach" }
    ],
  },
  {
    name: "London",
    start: 540,
    end: 1020,
    info: "Hohe Liquidit√§t, starke Bewegungen, europ√§ische Wirtschaftsdaten.",
    weekDaysInfo: [
      { day: "Montag", text: "üìâ EU Handelsdaten" },
      { day: "Dienstag", text: "üèõÔ∏è Zinsentscheidungen der EZB" },
      { day: "Donnerstag", text: "üìä Inflationsdaten UK" },
      { day: "Freitag", text: "üìÖ Arbeitsmarktdaten UK" }
    ],
  },
  {
    name: "New York",
    start: 870,
    end: 1380,
    info: "Hohe Volatilit√§t, US-Daten dominieren, Trendfortsetzungen m√∂glich.",
    weekDaysInfo: [
      { day: "Mittwoch", text: "üè¶ Fed Zinsentscheidungen" },
      { day: "Freitag", text: "üìä US NFP Arbeitsmarktdaten" },
      { day: "Freitag", text: "üìà W√∂chentliche Arbeitslosenmeldung" }
    ],
  },
  {
    name: "London Killzone",
    start: 420,
    end: 660,
    info: "Volatile Phase vor London-Open, Stop-Hunts m√∂glich.",
    weekDaysInfo: [
      { day: "Montag", text: "‚ö° Hohe Volatilit√§t durch Markt√∂ffnung" },
      { day: "Mittwoch", text: "üî• Breakouts oft m√∂glich" }
    ],
  },
  {
    name: "New York Killzone",
    start: 810,
    end: 1020,
    info: "Start der NY Session, hohe Aktivit√§t, gute Chancen f√ºr Daytrader.",
    weekDaysInfo: [
      { day: "Dienstag", text: "‚ö° Erh√∂hte Volatilit√§t durch US-Daten" },
      { day: "Donnerstag", text: "üéôÔ∏è Fed Reden & Daten" }
    ],
  },
  {
    name: "Deadzone",
    start: 1380,
    end: 0,
    info: "Niedrige Volatilit√§t, Seitw√§rtsbewegungen, Ruhephase.",
    weekDaysInfo: [
      { day: "T√§glich", text: "üò¥ Markt ruhig, kaum Bewegung" }
    ],
  }
];


let lastAlertSession = null;

function getMinutesNow() {
  const now = new Date();
  return now.getHours() * 60 + now.getMinutes();
}

function getCurrentSessions(minNow) {
  return sessions.filter((s) => {
    const start = s.start;
    const end = s.end;
    if (start > end) {
      return minNow >= start || minNow < end;
    } else {
      return minNow >= start && minNow < end;
    }
  });
}

function updateGradientBar(colors) {
  if (colors.length === 0) {
    progressBar.style.background = "#444";
    progressBar.style.backgroundImage = "";
    return;
  }
  const svg = `
    <svg xmlns='http://www.w3.org/2000/svg' width='100%' height='100%'>
      <defs>
        <linearGradient id='g' x1='0%' y1='0%' x2='100%' y2='0%'>
          ${colors.map((c, i) => `<stop offset='${(i / (colors.length - 1)) * 100}%' stop-color='${c}'/>`).join("")}
        </linearGradient>
      </defs>
      <rect x='0' y='0' width='100%' height='100%' fill='url(#g)'/>
    </svg>`;
  const base64 = btoa(svg);
  progressBar.style.backgroundImage = `url("data:image/svg+xml;base64,${base64}")`;
}

function hexToRgba(hex, alpha) {
  hex = hex.replace("#", "");
  const r = parseInt(hex.substring(0, 2), 16);
  const g = parseInt(hex.substring(2, 4), 16);
  const b = parseInt(hex.substring(4, 6), 16);
  return `rgba(${r},${g},${b},${alpha})`;
}

function getMinutesToNextSession(minNow) {
  const futureStarts = sessions.map((s) => s.start).filter((start) => start > minNow);
  if (futureStarts.length === 0) return sessions[0].start + 1440 - minNow;
  return Math.min(...futureStarts) - minNow;
}

const alertSound = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');

function requestNotificationPermission() {
  if ("Notification" in window && Notification.permission !== "granted") {
    Notification.requestPermission().then(permission => {
      console.log("üîê Notification permission:", permission);
    });
  }
}






function showAlert(msg) {
  const el = document.createElement("div");
  el.className = "alert-message";
  el.textContent = msg;
  alertBox.innerHTML = "";
  alertBox.appendChild(el);
  setTimeout(() => (alertBox.innerHTML = ""), 5000);
  alertSound.play();
  showNotification("Trade App Alarm", msg);  // üîä Alarm-Benachrichtigung

  // üîî Session Push wie WhatsApp
  const customMessages = {
    "Tokyo": "üåè Tokyo ge√∂ffnet ‚Äì JPY-Paare beginnen sich zu bewegen.",
    "London Killzone": "‚öîÔ∏è London Killzone aktiv ‚Äì Liquidit√§tssuche beginnt!",
    "London": "üí∑ London Session gestartet ‚Äì europ√§ische Volatilit√§t beginnt.",
    "New York Killzone": "üî• NY Killzone l√§uft ‚Äì auf Breakouts achten!",
    "New York": "üá∫üá∏ New York Session gestartet ‚Äì starker US-Einfluss jetzt aktiv.",
    "Sydney": "üåô Sydney Session l√§uft ‚Äì ruhiger Start in den Markt.",
    "Deadzone": "üò¥ Deadzone ‚Äì geringe Volatilit√§t, keine aktiven Teilnehmer."
  };

  const minutes = getMinutesNow();
  const activeSessions = getCurrentSessions(minutes);
  if (activeSessions.length > 0) {
    const s = activeSessions[0];
    const pushMessage = customMessages[s.name] || s.info;
    sendPushNotification(`üì£ ${s.name}-Session startet`, pushMessage);
  }
}



function showSessionProgress(activeSessions, currentMinutes) {
  if (activeSessions.length === 0) {
    sessionProgressEl.innerHTML = "‚è≥ Keine aktive Session ‚Äì kein Countdown";
    return;
  }
  const current = activeSessions[0];
  let start = current.start;
  let end = current.end;
  if (start > end) end += 1440;
  let nowMins = currentMinutes;
  if (nowMins < start) nowMins += 1440;
  const duration = end - start;
  const progressMins = nowMins - start;
  const percent = (progressMins / duration) * 100;
  const timeLeft = end - nowMins;
  sessionProgressEl.innerHTML = `‚è±Ô∏è Noch <strong>${formatHM(timeLeft)}</strong> ‚Äì <strong>${percent.toFixed(0)}%</strong> vorbei`;
}

function updateRealTimeBar() {
  const now = new Date();
  const weekday = now.getDay(); // Sonntag = 0, Samstag = 6
  const hours = String(now.getHours()).padStart(2, "0");
  const mins = String(now.getMinutes()).padStart(2, "0");

  // üëâ Wochenende
  if (weekday === 0 || weekday === 6) {
    sessionText.textContent = `üïí Aktuelle Uhrzeit: ${hours}:${mins} ‚Äì Wochenende`;
    progressBar.style.width = "0%";
    progressBar.style.background = "#333";
    progressBar.style.backgroundImage = "";
    progressContainer.style.boxShadow = "0 0 12px 6px rgba(0,0,0,0)";
    sessionInfoEl.textContent = "üì¥ Wochenende ‚Äì Markt ist geschlossen.";
    sessionProgressEl.innerHTML = "‚õî Kein Handel ‚Äì Wochenende";
    sessionDetailsBox.innerHTML = "Keine Session-Daten am Wochenende.";
    return;
  }

// ‚è¨ Ab hier normaler Werktags-Ablauf
const minutes = now.getHours() * 60 + now.getMinutes();
const percent = (minutes / 1439) * 100;

const activeSessions = getCurrentSessions(minutes);
const names = activeSessions.map(s => s.name);
const activeNames = names.length > 0 ? `| Aktive Session: ${names.join(" + ")}` : "| Keine Session aktiv";
sessionText.textContent = `üïí ${hours}:${mins} ${activeNames}`;

progressBar.style.width = `${percent}%`;

const colors = names.map(n => sessionColors[n] || "#666");


  const name = activeSessions.length > 0 ? activeSessions[0].name : "";
  let infoText = "Keine aktiven Sessions ‚Äì Markt wahrscheinlich ruhig.";
  
   updateGradientBar(colors);
   showSessionProgress(activeSessions, minutes); // ‚úÖ HIER rein

  if (colors.length > 0) {
    progressContainer.style.boxShadow = `0 0 12px 6px ${hexToRgba(colors[0], 0.6)}`;
  } else {
    progressContainer.style.boxShadow = "0 0 12px 6px rgba(0,0,0,0)";
  }

  if (name === "Tokyo") {
    infoText = minutes < 180 ? "üåè Tokyo er√∂ffnet ‚Äì erste Bewegungen durch asiatische H√§ndler." :
                minutes < 360 ? "üáØüáµ Asiatische Volatilit√§t aktiv ‚Äì m√∂gliche Bewegungen bei JPY." :
                "üõë Tokyo flacht ab ‚Äì Fokus wechselt langsam nach Europa.";
  } else if (name === "London Killzone") {
    infoText = "‚ö†Ô∏è London Killzone ‚Äì hohe Volatilit√§t & starke Bewegungen m√∂glich.";
  } else if (name === "London") {
    infoText = minutes < 720 ? "üí∑ London Session ‚Äì Markt in Bewegung, europ√§ische Daten entscheidend." :
                minutes < 840 ? "üò¥ Mittagliche Deadzone ‚Äì Markt konsolidiert h√§ufig, Vorsicht bei Entries." :
                "üìà London-Teilnehmer bleiben aktiv ‚Äì Vorbereitung auf NY.";
  } else if (name === "New York Killzone") {
    infoText = "üî• New York Killzone ‚Äì starke Reaktionen auf US-News & Breakouts m√∂glich.";
  } else if (name === "New York") {
    infoText = minutes < 1080 ? "üá∫üá∏ New York Session ‚Äì starker US-Einfluss, Trendfortsetzungen m√∂glich." :
                minutes < 1200 ? "üìâ New York flacht ab ‚Äì Markt beruhigt sich langsam." :
                "üåÉ New York Session endet ‚Äì geringe Bewegung, Vorsicht bei Entries.";
  } else if (minutes >= 720 && minutes < 840) {
    infoText = "üò¥ Mittagliche Deadzone ‚Äì Markt konsolidiert h√§ufig, Vorsicht bei Entries.";
  } else if (minutes >= 1380 || minutes < 60) {
    infoText = "üåô Nacht-Deadzone ‚Äì Markt ist extrem ruhig, keine relevanten Bewegungen.";
  }

  sessionInfoEl.textContent = infoText;

 if (activeSessions.length > 0) {
  let fullInfo = "";

  activeSessions.forEach(s => {
    let weekDaysHtml = "";
    if (s.weekDaysInfo) {
      weekDaysHtml = "<ul style='margin-left:18px; margin-top:4px;'>";
      s.weekDaysInfo.forEach(({ day, text }) => {
        weekDaysHtml += `<li><strong>${day}:</strong> ${text}</li>`;
      });
      weekDaysHtml += "</ul>";
    }

    const label = s.name.includes("Killzone") ? "üî•" :
                  s.name.includes("New York") ? "üá∫üá∏" :
                  s.name.includes("London") ? "üí∑" :
                  s.name.includes("Tokyo") ? "üåè" :
                  s.name.includes("Sydney") ? "üåô" : "üü°";

    fullInfo += `
      <strong>${label} ${s.name}</strong><br>
      üìÖ Start: ${formatHM(s.start)} Uhr<br>
      üïì Ende: ${formatHM(s.end)} Uhr<br>
      ‚ÑπÔ∏è ${s.info}
      ${weekDaysHtml}
      <hr style="border: none; border-top: 1px solid #444; margin: 10px 0;">
    `;
  });

  sessionDetailsBox.innerHTML = fullInfo;
} else {
  sessionDetailsBox.innerHTML = "Keine aktive Session ‚Äì Markt ist ruhig.";
}


  const minutesToNext = getMinutesToNextSession(minutes);
  if (minutesToNext <= 5 && minutesToNext > 0) {
    const currentActive = sessionText.textContent;
    if (lastAlertSession !== currentActive) {
      showAlert(`‚ö†Ô∏è Session-Wechsel in 5 Minuten!`);
      lastAlertSession = currentActive;

      if (activeSessions.length > 0) {
        const s = activeSessions[0];
        showSessionStartNotification(s.name, s.info);
      }
    }
  } else {
    lastAlertSession = null;
  }
}




window.addEventListener("load", () => {
  requestNotificationPermission();
  updateRealTimeBar();
  setInterval(updateRealTimeBar, 60000);
});
</script>



<script>
// ‚úÖ Service Worker Registrierung
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker
      .register("sw.js")
      .then(reg => console.log("‚úÖ Service Worker registriert:", reg))
      .catch(err => console.error("‚ùå SW Registrierung fehlgeschlagen:", err));
  });
}

// ‚úÖ App-Install Trigger mit Button
let deferredPrompt = null;

window.addEventListener('beforeinstallprompt', (e) => {
  console.log("üü° beforeinstallprompt ausgel√∂st");
  e.preventDefault();
  deferredPrompt = e;
  showInstallButton();
});

function showInstallButton() {
  if (localStorage.getItem("installPromptHandled") === "true") return;
  if (document.getElementById("installBtn")) return;

  const installBtn = document.createElement("button");
  installBtn.id = "installBtn";
  installBtn.textContent = "üì≤ App installieren";
  installBtn.className = "big-btn";
  installBtn.style.position = "fixed";
  installBtn.style.bottom = "80px";
  installBtn.style.left = "50%";
  installBtn.style.transform = "translateX(-50%)";
  installBtn.style.zIndex = "9999";
  document.body.appendChild(installBtn);

  installBtn.addEventListener("click", () => {
    installBtn.remove();
    localStorage.setItem("installPromptHandled", "true"); // ‚úÖ Nur einmal fragen
    if (deferredPrompt) {
      deferredPrompt.prompt();
      deferredPrompt.userChoice.then((choiceResult) => {
        console.log("üì• Installationswahl:", choiceResult.outcome);
        deferredPrompt = null;
      });
    }
  });
}

// üïí Fallback-Check nach 3 Sekunden, ob der Button angezeigt werden kann
setTimeout(() => {
  if (deferredPrompt) {
    showInstallButton();
  } else {
    console.log("‚ùå Kein Install-Event verf√ºgbar");
  }
}, 3000);
</script>

<script>
function sendPushNotification(title, message) {
  if ("Notification" in window && Notification.permission === "granted") {
    try {
      const n = new Notification(title, {
        body: message,
        icon: "https://cdn-icons-png.flaticon.com/512/1827/1827409.png",
        vibrate: [200, 100, 200],
        tag: "session-alert",
        renotify: true
      });
      n.onclick = () => {
        window.focus();
        n.close();
      };
      return;
    } catch (err) {
      console.warn("‚ö†Ô∏è Browser-Notification fehlgeschlagen, versuche SW:", err);
    }
  }

  // ‚úÖ Fallback f√ºr PWA, auch im Hintergrund
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.ready.then((registration) => {
      registration.showNotification(title, {
        body: message,
        icon: "https://cdn-icons-png.flaticon.com/512/1827/1827409.png",
        vibrate: [200, 100, 200],
        tag: "session-alert",
        renotify: true
      });
    }).catch(err => {
      console.error("‚ùå ServiceWorker-Notification fehlgeschlagen:", err);
    });
  }
}


// ‚úÖ Einheitlicher Notification-Aufruf f√ºr Sessionstarts
function showSessionStartNotification(sessionName, message) {
  const title = `üì£ ${sessionName}-Session gestartet!`;
  sendPushNotification(title, message);
}

// ‚úÖ Optional: Diagnosetool zum Testen der Berechtigung
function diagnoseNotifications() {
  const output = document.getElementById("notificationStatus");
  output.style.display = "block";

  let msg = "üîç <strong>Benachrichtigungs-Check:</strong><br>";

  if (!("Notification" in window)) {
    msg += "‚ùå Notifications werden vom Browser nicht unterst√ºtzt.<br>";
  } else {
    msg += `üì± Notification.permission: <strong>${Notification.permission}</strong><br>`;
    if (Notification.permission === "granted") {
      try {
        sendPushNotification("‚úÖ Test-Notification", "üéØ Die Notification funktioniert!");
        msg += "‚úÖ Test-Notification wurde ausgel√∂st.<br>";
      } catch (err) {
        msg += "‚ùå Fehler beim Notification-Aufruf: " + err.message + "<br>";
      }
    } else if (Notification.permission === "denied") {
      msg += "üö´ Du hast Benachrichtigungen blockiert.<br>";
    } else if (Notification.permission === "default") {
      Notification.requestPermission().then((perm) => {
        msg += `üì© Neue Erlaubnis: ${perm}<br>`;
      });
    }
  }

  output.innerHTML = msg;
}

function enableNotifications() {
  Notification.requestPermission().then(permission => {
    const statusBox = document.getElementById("notificationStatus");
    statusBox.style.display = "block";

    if (permission === "granted") {
      sendPushNotification("‚úÖ Erlaubt", "Du bekommst ab jetzt Benachrichtigungen!");
      statusBox.innerHTML = "‚úÖ Benachrichtigungen erlaubt!";
    } else if (permission === "denied") {
      statusBox.innerHTML = "‚ùå Benachrichtigungen blockiert. Aktiviere sie im Schloss-Symbol der Adresszeile.";
    } else {
      statusBox.innerHTML = "‚ÑπÔ∏è Keine Entscheidung getroffen.";
    }
  });
}

</script>




</script>
<script>
let myfxSession = null;

async function loginToMyfxbook(email, password) {
  try {
    const url = `https://www.myfxbook.com/api/login.json?email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`;
    const res = await fetch(url);
    const data = await res.json();

    if (data.error || !data.session) {
      alert("‚ùå Login fehlgeschlagen: " + (data.message || "Unbekannter Fehler"));
      return;
    }

    myfxSession = data.session;
    localStorage.setItem("myfxSession", myfxSession);
    alert("‚úÖ Login erfolgreich");
  } catch (e) {
    alert("‚ö†Ô∏è Fehler beim Login (Netzwerk oder CORS)");
  }
}

function doMyfxLogin() {
  const email = document.getElementById("myfxEmail").value;
  const pw = document.getElementById("myfxPassword").value;
  if (!email || !pw) return alert("Bitte E-Mail & Passwort eingeben!");

  localStorage.setItem("myfxEmail", email);
  localStorage.setItem("myfxPassword", pw);
  loginToMyfxbook(email, pw);
}

async function getMyfxAccounts() {
  const res = await fetch(`https://www.myfxbook.com/api/get-my-accounts.json?session=${myfxSession}`);
  const data = await res.json();
  return data.accounts[0].id;
}

async function getMyfxHistory(accountId) {
  const res = await fetch(`https://www.myfxbook.com/api/get-history.json?session=${myfxSession}&id=${accountId}`);
  const data = await res.json();
  return data.history;
}

async function syncMyfxbook() {
  if (!myfxSession) {
    alert("‚ö†Ô∏è Bitte zuerst einloggen!");
    return;
  }

  const accountId = await getMyfxAccounts();
  const trades = await getMyfxHistory(accountId);

  let imported = 0;
  trades.forEach(trade => {
const exists = tradesData.some(t =>
  t.pair === trade.symbol &&
  t.direction === (trade.action === "Buy" ? "Long" : "Short") &&
  new Date(t.date).getTime() === new Date(trade.openTime).getTime()
);
    if (!exists) {
      tradesData.push({
        id: Date.now() + Math.random(),
        pair: trade.symbol,
        direction: trade.action === "Buy" ? "Long" : "Short",
        date: new Date(trade.openTime),
        pnl: parseFloat(trade.profit),
        resultType: trade.profit >= 0 ? "win" : "loss"
      });
      imported++;
    }
  });
  
  

  const balance = trades.reduce((sum, t) => sum + parseFloat(t.profit), 0);

  const answer = prompt("Hast du eine Einzahlung gemacht? Wenn ja, wie viel? (in Euro)");
  let deposit = 0;
  if (answer && !isNaN(answer.replace(',', '.'))) {
    deposit = parseFloat(answer.replace(',', '.'));
  }

  const myfxSummary = { deposit, balance };
  localStorage.setItem("myfxSummary", JSON.stringify(myfxSummary));

  saveTrades();
  loadTrades();
  alert(`üì• ${imported} neue Trades importiert!\nBalance: ${balance.toFixed(2)} ‚Ç¨, Deposit: ${deposit.toFixed(2)} ‚Ç¨`);
}



// ‚úÖ Auto-Sync (leise) um 23:00
async function syncMyfxbookAuto(depositOverride = 0) {
  if (!myfxSession) {
    console.warn("‚ùå Kein Login ‚Äì Auto-Sync abgebrochen.");
    return;
  }

  const accountId = await getMyfxAccounts();
  const trades = await getMyfxHistory(accountId);

  let imported = 0;
  trades.forEach(trade => {
    const exists = tradesData.some(t =>
      t.pair === trade.symbol &&
      new Date(t.date).getTime() === new Date(trade.openTime).getTime() &&
      parseFloat(t.pnl) === parseFloat(trade.profit)
    );
    if (!exists) {
      tradesData.push({
        id: Date.now() + Math.random(),
        pair: trade.symbol,
        direction: trade.action === "Buy" ? "Long" : "Short",
        date: new Date(trade.openTime),
        pnl: parseFloat(trade.profit),
        resultType: trade.profit >= 0 ? "win" : "loss"
      });
      imported++;
    }
  });

  const balance = trades.reduce((sum, t) => sum + parseFloat(t.profit), 0);
  const myfxSummary = { deposit: depositOverride, balance };
  localStorage.setItem("myfxSummary", JSON.stringify(myfxSummary));

  const now = new Date();
  localStorage.setItem("lastSyncFlag", now.toDateString());
  localStorage.setItem("lastSyncTime", now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
  localStorage.removeItem("syncShown");

  saveTrades();
  loadTrades();
  console.log(`‚úÖ Auto-Sync abgeschlossen (${imported} Trades)`);
}

function showManualSyncButtonIfNeeded() {
  const btn = document.getElementById("manualSyncBtn");
  if (!btn) return;
  btn.style.display = "inline-block"; // Immer sichtbar
}

//Sync l√§uft alle 30 Minuten (00:00, 00:30, 01:00 ‚Ä¶).
function autoSyncIfNeeded() {
  const now = new Date();
  const hour = now.getHours().toString().padStart(2, '0');
  const minutes = now.getMinutes();
  const slot = `${hour}:${minutes < 30 ? '00' : '30'}`;

  const lastSyncSlot = localStorage.getItem("lastSyncSlot");

  if (slot !== lastSyncSlot) {
    syncMyfxbookAuto(0); // 0 = kein neuer Deposit
    localStorage.setItem("lastSyncSlot", slot);
    console.log(`‚è±Ô∏è Auto-Sync f√ºr Slot ${slot} durchgef√ºhrt.`);
  }
}

// ‚úÖ Einmalige Anzeige beim n√§chsten Laden
function showSyncStatusOnce() {
  const syncFlag = localStorage.getItem("lastSyncFlag");
  const syncTime = localStorage.getItem("lastSyncTime");
  const syncShown = localStorage.getItem("syncShown");

  if (syncFlag && syncFlag === new Date().toDateString() && syncShown !== "true") {
    showSyncStatus(`Letzter Auto-Sync erfolgreich (${syncTime})`);
    localStorage.setItem("syncShown", "true");
  }
}

function showSyncStatus(text) {
  const el = document.getElementById("syncStatus");
  if (!el) return;
  el.innerHTML = `‚úÖ ${text}`;
  setTimeout(() => el.innerHTML = "", 10000);
}

async function getOpenTrades() {
  if (!myfxSession) {
    console.warn("‚ùå Kein Login ‚Äì offene Trades nicht abrufbar.");
    return;
  }

  const res = await fetch(`https://www.myfxbook.com/api/get-open-trades.json?session=${myfxSession}`);
  const data = await res.json();

  console.log("üì° Antwort von Myfxbook:", data); // NEU

  if (!data.openTrades || data.openTrades.length === 0) {
    console.warn("‚ö†Ô∏è Keine offenen Trades im API-Datenobjekt.");
    alert("‚ùå Keine offenen Trades in API erhalten");
    return;
  }

  let imported = 0;

  data.openTrades.forEach(trade => {
    console.log("üîç Pr√ºfe Trade:", trade); // NEU

    const exists = tradesData.some(t =>
      t.pair === trade.symbol &&
      t.direction === (trade.action === "Buy" ? "Long" : "Short") &&
      new Date(t.date).getTime() === new Date(trade.openTime).getTime()
    );

    console.log("‚öôÔ∏è Bereits vorhanden:", exists); // NEU

    if (!exists) {
      const tradeObj = {
        id: Date.now() + Math.random(),
        pair: trade.symbol,
        direction: trade.action === "Buy" ? "Long" : "Short",
        date: new Date(trade.openTime),
        pnl: null
      };
      console.log("üì• Neuer Trade wird hinzugef√ºgt:", tradeObj); // NEU

      tradesData.push(tradeObj);
      renderTradeBox(tradeObj);
      imported++;
    }
  });

  saveTrades();
  alert(`‚úÖ ${imported} offene Trades importiert.`);
}

// üöÄ On Load
window.addEventListener("load", async () => {
  const savedEmail = localStorage.getItem("myfxEmail");
  const savedPw = localStorage.getItem("myfxPassword");
  const savedSession = localStorage.getItem("myfxSession");

  if (savedEmail && savedPw) {
    document.getElementById("myfxEmail").value = savedEmail;
    document.getElementById("myfxPassword").value = savedPw;
  }

  if (savedSession) {
    myfxSession = savedSession;
    console.log("‚úÖ Session wiederhergestellt.");
  }

  autoSyncIfNeeded();
  setInterval(autoSyncIfNeeded, 5 * 60 * 1000);
  showSyncStatusOnce();
});
</script>
<body>

<button onclick="enableNotifications()">üîì Benachrichtigungen aktivieren</button>
<div id="notificationStatus" style="color:#0f0; font-weight:bold; margin-top:10px; display:none;"></div>

<button onclick="showSessionStartNotification('TEST Session', 'üîî Das ist eine Test-Benachrichtigung!')">
üì≤ Test Session Notification
</button>
<button onclick="diagnoseNotifications()">üîç Benachrichtigung pr√ºfen</button>
<div id="notificationStatus" style="color:#0f0; font-weight:bold; margin-top:10px; display:none;"></div>

</button>
</button>
</body>
</html>
