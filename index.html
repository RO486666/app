<!DOCTYPE html>
<html lang="de">
<head>
<link rel="stylesheet" href="CSS/ticker.css" />
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#00aa44" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trade App Layout</title>
  <style>
html, body {
  margin: 0;
  padding: 0;
  overflow-x: hidden;
  width: 100%;
  max-width: 100vw;
}
* {
  box-sizing: border-box;
}

body {
  width: 100%;
  max-width: 100vw;
  overflow-x: hidden;
}

img, canvas, .stats-box, .calc-box, .popup, .position-bar, .trade-box, .tool-box {
  max-width: 100%;
  width: 100%;
}

  body {
  background: #111;
  color: white;
  font-family: sans-serif;
  margin: 0;
  padding: 0;
  overflow-x: hidden;

  background-image: 
    linear-gradient(0deg, rgba(255,255,255,0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
  background-size: 40px 40px;
  animation: bgScroll 20s linear infinite;
}

@keyframes bgScroll {
  0% {
    background-position: 0 0;
  }
  100% {
    background-position: 400px 400px;
  }
}
#bgCandles {
  opacity: 0.035;        /* super dezent */
  filter: blur(0.6px);   /* weiche Kanten */
  pointer-events: none;  /* klickt nicht durch */
}


    .header {
      background: #1c1c1c;
      padding: 10px;
      text-align: center;
      font-size: 18px;
    }
    .session-bar {
      height: 10px;
      background: linear-gradient(to right, #00aaff, #ffaa00, #ff3300);
      margin-top: 5px;
    }
	
    .main {
      padding: 20px;
      padding-bottom: 120px; /* Platz f√ºr Positionsleiste */
      text-align: center;
    }
    .big-btn {
      padding: 20px 30px;
      font-size: 22px;
      font-weight: bold;
      border-radius: 15px;
      border: none;
      background-color: #00aa44;
      color: white;
      margin: 20px auto;
      width: 80%;
      max-width: 300px;
    }
    .tab-buttons {
      text-align: center;
      margin-top: 20px;
    }
    .tab-buttons button {
      background: #333;
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      margin: 5px;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }
    .tab-buttons .active {
      background: #0077cc;
    }
    .stats-box {
      background: #222;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      text-align: left;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
    #resetBtn {
      background: #cc3333;
      color: white;
      padding: 12px;
      border: none;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
      font-weight: bold;
      margin: 20px auto 30px auto;
      cursor: pointer;
      display: block;
      user-select: none;
      position: relative; /* kein fixed */
      z-index: auto;
    }
    .position-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #1c1c1c;
      padding: 10px;
      display: flex;
      gap: 10px;
      overflow-x: auto;
      box-sizing: border-box;
      z-index: 10000; /* √ºber anderen Elementen */
	  touch-action: pan-y; /* Erlaubt vertikales Scrollen, verhindert horizontale Interferenzen */
    }
    
    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      padding: 20px;
      border-radius: 10px;
      display: none;
      z-index: 1000;
      width: 90%;
      max-width: 300px;
      color: white;
    }
    label {
      cursor: pointer;
      user-select: none;
      margin-right: 15px;
      display: inline-block;
    }
    #pairMultiSelect {
      max-height: 150px;
      overflow-y: auto;
      background: #222;
      padding: 5px;
      border-radius: 6px;
      color: white;
      margin-bottom: 10px;
      text-align: left;
    }
    select, input {
      padding: 8px;
      margin-top: 10px;
      width: 100%;
      border-radius: 5px;
      border: none;
      font-size: 16px;
    }
    .popup button {
      margin-top: 10px;
      padding: 10px;
      width: 100%;
      font-size: 16px;
      cursor: pointer;
    }
    .ticker {
      width: 100%;
      background: #222;
      color: #00ff99;
      padding: 10px;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      font-family: Arial, sans-serif;
      user-select: none;
    }
    .session-info {
      margin-top: 5px;
      font-size: 14px;
      color: #aaf0aa;
      text-align: center;
      font-style: italic;
      user-select: none;
    }
	
.session-details-box {
  display: none;
  background: #1a1a1a;
  padding: 15px;
  margin: 10px 20px;
  border-radius: 10px;
  font-size: 14px;
  color: #eee;
  text-align: left;
  box-shadow: 0 0 10px rgba(0,0,0,0.4);
}


  .session-details-box {
    font-size: 13px;
    margin: 10px;
    padding: 12px;
    line-height: 1.4;
  }

  .session-header, #sessionText {
    font-size: 16px;
    padding: 12px;
  }
  
  #sessionText {
  user-select: none;
  cursor: pointer;
}

.progress-container {
  position: relative;
  width: 100%;
  max-width: 100%;
  height: 24px;
  background: #111;
  border-top: 1px solid #333;
  border-bottom: 1px solid #333;
  overflow: hidden;
  z-index: 9;
  margin: 0 auto;
  padding: 0;
  border-radius: 0;
}




    .progress-bar {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
	  
      width: 0%; /* wird per JS gesetzt */
      background: linear-gradient(to right, #00aaff, #ffaa00, #ff3300);
      transition: width 1s linear;
      background-size: 100% 100%;
      background-repeat: no-repeat;
      z-index: 2;
    }
	
	.session-details-box ul {
  padding-left: 20px;
  margin-top: 8px;
  margin-bottom: 8px;
  list-style-type: disc;
}

.session-details-box li {
  margin-bottom: 4px;
}

.tool-button {
  background-color: #333;
  color: white;
  border: none;
  padding: 10px 20px;
  margin: 5px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
}
.tool-button:hover {
  background-color: #444;
}
.tool-box {
  background: #222;
  padding: 20px;
  border-radius: 10px;
  color: white;
  max-width: 400px;
  margin: auto;
  box-shadow: 0 0 10px rgba(255,255,255,0.1);
}

.tool-box input,
.tool-box button {
  width: 100%;
  margin-bottom: 10px;
  padding: 8px;
  border: none;
  border-radius: 5px;
  font-size: 14px;
}

.tool-box button {
  background: #007bff;
  color: white;
  font-weight: bold;
  cursor: pointer;
}

.crypto-animate {
  font-weight: bold;
  font-size: 18px;
  color: #00ffcc;
  text-shadow: 0 0 5px #00ffcc, 0 0 10px #00ffcc, 0 0 20px #00ffcc;
  animation: glowPulse 2s infinite alternate;
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

.crypto-animate .coin {
  display: inline-block;
  animation: spinCoin 1.5s linear infinite;
  font-size: 22px;
}

@keyframes spinCoin {
  0%   { transform: rotateY(0deg); }
  100% { transform: rotateY(360deg); }
}

@keyframes glowPulse {
  0% {
    text-shadow: 0 0 5px #00ffcc, 0 0 10px #00ffcc;
  }
  100% {
    text-shadow: 0 0 15px #00ffcc, 0 0 30px #00ffcc;
  }
}

.star-rating {
  unicode-bidi: bidi-override;
  direction: rtl;
  display: inline-flex;
}
.star-rating span {
  font-size: 24px;
  cursor: pointer;
  color: #777;
}
.star-rating span.selected {
  color: gold;
}


.journal-screenshot {
  max-width: 160px;
  max-height: 120px;
  width: auto;
  height: auto;
  object-fit: contain;
  border-radius: 6px;
  margin-top: 5px;
  display: block;
  cursor: pointer;
  transition: transform 0.2s ease;
}



  

</style>
<link rel="stylesheet" href="mobile.css" media="screen and (max-width: 480px)">

<div class="ticker">
  <div id="tickerContent"></div>
</div>
<canvas id="bgCandles" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1;"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="scripts/position.js"></script>
<script src="scripts/dawn.js"></script>
<script src="scripts/tax.js"></script>
<script src="scripts/bg-candles.js"></script>
<script src="scripts/ticker.js"></script> <!-- üëà wichtig -->
<script src="imageStorage.js"></script>



</head>
<body>

<div class="ticker" id="sessionText">Session-Zeit: 00:00</div>

<div class="session-info" id="sessionInfo">Tipps und Infos zur Session erscheinen hier...</div>

<div class="progress-container">
  <div class="progress-bar" id="progressBar"></div>
</div>

<div id="daySummary" class="ticker" style="
  background:#333;
  color:#ffcc00;
  font-size: clamp(12px, 3.5vw, 16px);
  cursor: pointer;
  padding: 10px;
  white-space: normal;
  word-break: break-word;
  max-width: 100%;
  box-sizing: border-box;
  text-align: center;
">
  üóìÔ∏è Lade Tagesinfo...
</div>


<div id="dayDetails" style="
  display: none;
  background: #1c1c1c;
  color: white;
  margin: 10px 15px;
  padding: 10px;
  border-radius: 10px;
  font-size: 14px;
  line-height: 1.6;
  box-shadow: 0 0 10px rgba(0,0,0,0.5);
  text-align: left;
  user-select: none;
">
</div>

<div id="sessionProgressDisplay"
     style="text-align:center;
            font-size: 16px;
            font-weight: bold;
            margin-top: 8px;
            color: #00ff99;
            background: #111;
            padding: 6px;
            border-radius: 8px;">
</div>

<div class="session-details-box" id="sessionDetailsBox"></div>
<div class="alert-below-header" id="alertBox"></div>


<!-- Tab-Buttons -->
<div class="tab-buttons" style="margin-top: 20px;">
  <!-- üìê Position Size -->
  <button id="btn-calc-pos" onclick="switchCalcTab('pos')" style="
    background: #ffffff;
    color: #111;
    box-shadow: 0 0 8px rgba(255,255,255,0.4);
    padding: 10px 15px;
    margin: 5px;
    border-radius: 8px;
    border: none;
    font-weight: bold;
    cursor: pointer;
    font-size: 15px;
    transition: all 0.15s ease;
    transform: scale(1);
  " onmousedown="this.style.transform='scale(0.94)'" onmouseup="this.style.transform='scale(1)'">
    üìê Position Size
  </button>

  <!-- üåí Dawn Rechner -->
  <button id="btn-calc-dawn" onclick="switchCalcTab('dawn')" style="
    background: #0077cc;
    color: white;
    box-shadow: 0 0 8px rgba(0,119,204,0.6);
    padding: 10px 15px;
    margin: 5px;
    border-radius: 8px;
    border: none;
    font-weight: bold;
    cursor: pointer;
    font-size: 15px;
    transition: all 0.15s ease;
    transform: scale(1);
  " onmousedown="this.style.transform='scale(0.94)'" onmouseup="this.style.transform='scale(1)'">
    üåí Dawn Rechner
  </button>

  <!-- üìÑ Steuer / Netto -->
  <button id="btn-calc-taxpro" onclick="switchCalcTab('taxpro')" style="
    background: #cc3333;
    color: white;
    box-shadow: 0 0 8px rgba(204,51,51,0.6);
    padding: 10px 15px;
    margin: 5px;
    border-radius: 8px;
    border: none;
    font-weight: bold;
    cursor: pointer;
    font-size: 15px;
    transition: all 0.15s ease;
    transform: scale(1);
  " onmousedown="this.style.transform='scale(0.94)'" onmouseup="this.style.transform='scale(1)'">
    üìÑ Steuer / Netto-Planer
  </button>
</div>








<div id="calc-taxpro" class="calc-box" style="margin-top: 15px; display: none;">
  <div class="stats-box">
    <!-- üîÅ Umschaltbare Ansicht -->
    <div id="steuerMode">
      <label for="gewinnBetrag">üìà Gesamtgewinn (‚Ç¨):</label>
      <input type="number" id="gewinnBetrag" placeholder="z.‚ÄØB. 17200" />

      <label for="einkommenSteuer">üí∏ Einkommensteuer-Satz (%):</label>
      <input type="number" id="einkommenSteuer" placeholder="z.‚ÄØB. 25" value="25" step="0.1" />

      <label><input type="checkbox" id="kirchensteuer" /> ‚úùÔ∏è Kirchensteuer (9‚ÄØ%)</label><br>
      <label><input type="checkbox" id="soliZuschlag" /> üí£ Solidarit√§tszuschlag (5.5‚ÄØ%)</label><br>
      <label><input type="checkbox" id="reserveZehn" /> üí• +10‚ÄØ% Reserve</label><br>

      <button onclick="berechneSteuern()" class="tax-button">üìä Steuer berechnen</button>
      <div id="steuerAusgabe"></div>
    </div>

    <div id="nettoMode" style="display:none">
      <label for="nettoBrutto">üìà Brutto-Gewinn (‚Ç¨):</label>
      <input type="number" id="nettoBrutto" placeholder="z.‚ÄØB. 10000" />

      <label for="nettoSteuer">üí∏ Steuerlast (‚Ç¨):</label>
      <input type="number" id="nettoSteuer" placeholder="z.‚ÄØB. 3500" />

      <label for="nettoEntnommen">üè¶ Tats√§chlich entnommen (‚Ç¨):</label>
      <input type="number" id="nettoEntnommen" placeholder="z.‚ÄØB. 8000" />

      <button onclick="berechneNettoPlan()" class="tax-button">üí∏ Netto berechnen</button>
      <div id="nettoAusgabe"></div>
    </div>

    <!-- üß† Umschalter -->
    <button onclick="switchPlanMode()" id="planToggleBtn" style="
      margin-top: 15px;
      background: #444;
      color: white;
      padding: 10px;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      width: 100%;
      cursor: pointer;
      font-weight: bold;
    ">
    üîÅ Zu Netto-Planer wechseln
    </button>
  </div>
</div>




<div id="calc-dawn" class="calc-box" style="display:none; margin-top: 15px;">
  <div class="stats-box">
    <label for="dawnCapital">üì¶ Startkapital (‚Ç¨):</label>
    <input type="number" id="dawnCapital" placeholder="z.‚ÄØB. 1000">

    <label for="dawnLoss">üìâ Verlust pro Dawn (%) :</label>
    <input type="number" id="dawnLoss" placeholder="z.‚ÄØB. 3" step="0.1">

    <button onclick="simulateDawnDeath()" style="
      background: #0077cc;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 10px;
      font-weight: bold;
      margin-top: 12px;
      width: 100%;
      cursor: pointer;
    ">‚ò†Ô∏è Dawn-Simulation starten</button>

    <p id="dawnDeathResult" style="margin-top: 10px; font-weight: bold; font-size: 16px;"></p>
  </div>
</div>





<div id="calc-pos" class="calc-box" style="margin-top: 15px; display:none;">

  <div class="stats-box">
    <label for="accountSize">üì¶ Kontogr√∂√üe (‚Ç¨):</label>
    <input type="number" id="accountSize" placeholder="z.‚ÄØB. 1000" />

    <label for="riskPercent">‚ö†Ô∏è Risiko in %:</label>
    <input type="number" id="riskPercent" placeholder="z.‚ÄØB. 1" step="0.1" />

    <label for="stopLossPips">üõë Stop-Loss (in Pips):</label>
    <input type="number" id="stopLossPips" placeholder="z.‚ÄØB. 20" />

<label for="symbolSelector">üí± Trading-Paar:</label>
<select id="symbolSelector">
  <optgroup label="üåç Forex Standard">
    <option value="AUD/USD">AUD/USD</option>
    <option value="EUR/USD">EUR/USD</option>
    <option value="GBP/USD">GBP/USD</option>
    <option value="NZD/USD">NZD/USD</option>
    <option value="USD/CHF">USD/CHF</option>
    <option value="USD/CAD">USD/CAD</option>
  </optgroup>

  <optgroup label="üí¥ Forex Yen-Paare">
    <option value="USD/JPY">USD/JPY</option>
    <option value="EUR/JPY">EUR/JPY</option>
    <option value="GBP/JPY">GBP/JPY</option>
    <option value="CHF/JPY">CHF/JPY</option>
    <option value="AUD/JPY">AUD/JPY</option>
    <option value="NZD/JPY">NZD/JPY</option>
    <option value="CAD/JPY">CAD/JPY</option>
  </optgroup>

  <optgroup label="üîÅ Cross-Paare">
    <option value="EUR/GBP">EUR/GBP</option>
    <option value="EUR/AUD">EUR/AUD</option>
    <option value="EUR/CAD">EUR/CAD</option>
    <option value="GBP/AUD">GBP/AUD</option>
    <option value="GBP/CAD">GBP/CAD</option>
    <option value="AUD/CAD">AUD/CAD</option>
  </optgroup>

  <optgroup label="ü•á Metalle">
    <option value="XAU/USD">XAU/USD</option>
    <option value="XAG/USD">XAG/USD</option>
  </optgroup>

  <optgroup label="ü™ô Krypto">
    <option value="BTC/USD">BTC/USD</option>
    <option value="ETH/USD">ETH/USD</option>
  </optgroup>

  <optgroup label="üìä Indizes">
    <option value="US30">US30</option>
    <option value="NAS100">NAS100</option>
    <option value="SPX500">SPX500</option>
    <option value="GER40">GER40</option>
    <option value="UK100">UK100</option>
  </optgroup>
  
</select>

<label for="leverage">‚öôÔ∏è Hebel:</label>
<input type="number" id="leverage" value="500" min="1" placeholder="z.‚ÄØB. 500" />




    <button onclick="calculatePositionSize()">üìê Berechnen</button>
    <p id="positionSizeResult" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
  </div>

  <div style="text-align:right; margin-bottom: 5px;">
    <span onclick="toggleInfoBox()" 
          style="cursor:pointer; background:#444; border-radius:50%; padding:3px 8px; font-weight:bold; color:#0ff;"
          title="Erkl√§rung anzeigen">i</span>
  </div>
  <div id="posInfoBox" style="display:none; background:#222; padding:12px; border-radius:8px; margin-top:10px; color:#ccc; font-size:14px; text-align:left;">
    <strong>‚ÑπÔ∏è Was macht dieser Rechner?</strong><br><br>
    Der Positionsgr√∂√üen-Rechner hilft dir zu ermitteln, wie viele Lots du in einem Trade einsetzen darfst, ohne mehr als einen bestimmten Prozentsatz deines Kontos zu riskieren. Die Berechnung basiert auf vier Angaben:
    <ul style="margin-top:10px; margin-bottom:10px;">
      <li><strong>üì¶ Kontogr√∂√üe:</strong> Dein aktuelles Guthaben in Euro.</li>
      <li><strong>‚ö†Ô∏è Risiko in %:</strong> Wie viel Prozent deines Kontos du maximal pro Trade verlieren willst (z.‚ÄØB. 1%).</li>
      <li><strong>üõë Stop-Loss (Pips):</strong> Die Distanz zwischen Einstieg und Stop-Loss in Pips.</li>
      <li><strong>üí° Pip-Wert pro Lot:</strong> Wie viel ein Pip pro Standard-Lot wert ist (z.‚ÄØB. 10‚ÄØ‚Ç¨ bei EUR/USD).</li>
    </ul>
    <strong>üìê Formel:</strong><br>
    <code style="color:#0ff;">Positionsgr√∂√üe = (Kontogr√∂√üe √ó Risiko%) / (Stop-Loss √ó Pip-Wert)</code><br><br>
    <strong>üîç Beispiel:</strong><br>
    Kontogr√∂√üe: 1000 ‚Ç¨<br>
    Risiko: 2%<br>
    Stop-Loss: 20 Pips<br>
    Pip-Wert: 10 ‚Ç¨/Lot<br><br>
    <strong>‚Üí</strong> Du riskierst 20 ‚Ç¨ (1000‚ÄØ√ó‚ÄØ0,02).<br>
    <strong>‚Üí</strong> Bei 20 Pips w√§ren das 1‚ÄØ‚Ç¨/Pip erlaubt (20‚ÄØ‚Ç¨ / 20‚ÄØPips).<br>
    <strong>‚Üí</strong> Der Pip-Wert ist 10‚ÄØ‚Ç¨/Lot ‚áí <strong>Erlaubte Lotgr√∂√üe: 0.10</strong><br><br>
    <em style="color:#aaa;">Hinweis: Bei Indizes oder Gold kann der Pip-Wert unterschiedlich sein!</em>
  </div>
</div>


  <div style="text-align:right; margin-bottom: 5px;">
    <span onclick="toggleRiskInfo()" 
          style="cursor:pointer; background:#444; border-radius:50%; padding:3px 8px; font-weight:bold; color:#0ff;"
          title="Erkl√§rung anzeigen">i</span>
  </div>

  <div id="riskInfoBox" style="display:none; background:#222; padding:12px; border-radius:8px; margin-top:10px; color:#ccc; font-size:14px; text-align:left;">
    <strong>‚ÑπÔ∏è Was macht dieser Rechner?</strong><br><br>
    Der Risiko-%-Rechner zeigt dir, wie viel Geld du bei einem Trade riskierst und wie viel Prozent deines Kontos das ausmacht. Er basiert auf:

    <ul style="margin-top:10px; margin-bottom:10px;">
      <li><strong>üì¶ Kontogr√∂√üe:</strong> Dein Kontoguthaben in Euro</li>
      <li><strong>üßÆ Lotgr√∂√üe:</strong> Wie gro√ü dein Trade ist (z.‚ÄØB. 0.1 = Mini-Lot)</li>
      <li><strong>üõë Stop-Loss (Pips):</strong> Wie weit der SL vom Einstieg entfernt ist</li>
      <li><strong>üí° Pip-Wert:</strong> Wie viel 1 Pip pro Lot kostet (z.‚ÄØB. 10‚ÄØ‚Ç¨)</li>
    </ul>

    <strong>üìê Formel:</strong><br>
    <code style="color:#0ff;">Risiko (‚Ç¨) = Lotgr√∂√üe √ó SL √ó Pip-Wert<br>
    Risiko-% = Risiko / Kontogr√∂√üe √ó 100</code><br><br>

    <strong>üîç Beispiel:</strong><br>
    Konto: 1000‚ÄØ‚Ç¨<br>
    Lot: 0.2<br>
    SL: 30 Pips<br>
    Pip-Wert: 10‚ÄØ‚Ç¨<br>
    ‚Üí Risiko = 0.2 √ó 30 √ó 10 = 60‚ÄØ‚Ç¨<br>
    ‚Üí Risiko-% = 60 / 1000 = <strong>6‚ÄØ%</strong><br><br>

    <em style="color:#aaa;">Achte darauf, dass dein Risiko unter 2‚ÄØ% bleibt, um langfristig zu √ºberleben.</em>
  </div>
</div>



<div id="calc-lot" class="calc-box" style="display:none; margin-top: 15px;">
  <div class="stats-box">
    <label for="lotFixedRisk">üí∞ Risiko in Euro:</label>
    <input type="number" id="lotFixedRisk" placeholder="z.‚ÄØB. 50" />

    <label for="lotSL">üõë Stop-Loss (in Pips):</label>
    <input type="number" id="lotSL" placeholder="z.‚ÄØB. 20" />

    <label for="lotPipValue">üí° Pip-Wert pro Lot (‚Ç¨):</label>
    <input type="number" id="lotPipValue" placeholder="z.‚ÄØB. 10" value="10" />

    <button onclick="calculateLotFromFixed()">üßÆ Lotgr√∂√üe berechnen</button>

    <p id="lotResult" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
  </div>

  <div style="text-align:right; margin-bottom: 5px;">
    <span onclick="toggleLotInfo()" 
          style="cursor:pointer; background:#444; border-radius:50%; padding:3px 8px; font-weight:bold; color:#0ff;"
          title="Erkl√§rung anzeigen">i</span>
  </div>

  <div id="lotInfoBox" style="display:none; background:#222; padding:12px; border-radius:8px; margin-top:10px; color:#ccc; font-size:14px; text-align:left;">
    <strong>‚ÑπÔ∏è Was macht dieser Rechner?</strong><br><br>
    Du gibst an, wie viel Euro du maximal verlieren willst ‚Äì der Rechner sagt dir, welche Lotgr√∂√üe das erlaubt.<br><br>

    <strong>Beispiel:</strong><br>
    Risiko: 100‚ÄØ‚Ç¨<br>
    SL: 25 Pips<br>
    Pip-Wert: 10‚ÄØ‚Ç¨/Lot<br>
    ‚Üí <code style="color:#0ff;">Lots = 100 / (25 √ó 10) = 0.40</code>
  </div>
</div>

<div id="calc-breakeven" class="calc-box" style="display:none; margin-top: 15px;">
  <div class="stats-box">
    <label for="entryPrice">üéØ Einstiegspreis:</label>
    <input type="number" id="entryPrice" placeholder="z.‚ÄØB. 1.12345" step="0.00001" />

    <label for="spreadPips">üìè Spread (Pips):</label>
    <input type="number" id="spreadPips" placeholder="z.‚ÄØB. 1.5" step="0.1" />

    <label for="fees">üí∏ Geb√ºhren (‚Ç¨):</label>
    <input type="number" id="fees" placeholder="z.‚ÄØB. 2.00" step="0.01" />

    <label for="beLotSize">üßÆ Lotgr√∂√üe:</label>
    <input type="number" id="beLotSize" placeholder="z.‚ÄØB. 0.1" step="0.01" />

    <label for="bePipValue">üí° Pip-Wert pro Lot (‚Ç¨):</label>
    <input type="number" id="bePipValue" placeholder="z.‚ÄØB. 10" value="10" />

    <button onclick="calculateBreakeven()">üß† Break-even berechnen</button>

    <p id="breakevenResult" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
  </div>

  <div style="text-align:right; margin-bottom: 5px;">
    <span onclick="toggleBreakevenInfo()" 
          style="cursor:pointer; background:#444; border-radius:50%; padding:3px 8px; font-weight:bold; color:#0ff;"
          title="Erkl√§rung anzeigen">i</span>
  </div>

  <div id="breakevenInfoBox" style="display:none; background:#222; padding:12px; border-radius:8px; margin-top:10px; color:#ccc; font-size:14px; text-align:left;">
    <strong>‚ÑπÔ∏è Was macht dieser Rechner?</strong><br><br>
    Der Break-even-Rechner zeigt dir den Preis, bei dem dein Trade exakt auf Null l√§uft ‚Äì also weder Gewinn noch Verlust.<br><br>

    Dabei ber√ºcksichtigt werden:
    <ul style="margin-top:10px; margin-bottom:10px;">
      <li><strong>üéØ Einstiegspreis:</strong> Der Preis, zu dem du den Trade ge√∂ffnet hast.</li>
      <li><strong>üìè Spread:</strong> Unterschied zwischen Bid und Ask in Pips.</li>
      <li><strong>üí∏ Geb√ºhren:</strong> z.‚ÄØB. Kommissionen des Brokers.</li>
      <li><strong>üßÆ Lotgr√∂√üe:</strong> Deine aktuelle Positionsgr√∂√üe.</li>
      <li><strong>üí° Pip-Wert:</strong> Wert eines Pips pro Lot (z.‚ÄØB. 10‚ÄØ‚Ç¨ bei Forex).</li>
    </ul>

    <strong>üìê Formel:</strong><br>
    <code style="color:#0ff;">Break-even = Einstiegspreis ¬± (Spread + Geb√ºhren √∑ (Lotgr√∂√üe √ó Pip-Wert))</code><br><br>

    <em style="color:#aaa;">Ob du + oder ‚Äì rechnest, h√§ngt davon ab, ob du Long oder Short bist. Dieser Rechner geht vom LONG-Trade aus.</em>
  </div>
</div>

<div id="calc-leverage" class="calc-box" style="display:none; margin-top: 15px;">
  <div class="stats-box">
    <label for="leverageMode">Berechnungsmodus:</label>
    <select id="leverageMode" onchange="toggleLeverageMode()">
      <option value="capital">üîÅ Hebel ‚ûú Kapital berechnen</option>
      <option value="lotcheck">üìä Hebel + Kapital ‚ûú Lotcheck</option>
    </select>

    <!-- MODUS 1: Hebel ‚ûú Kapital -->
    <div id="capitalMode">
      <label for="leverageInput1">üì¶ Kapital (in ‚Ç¨):</label>
      <input type="number" id="leverageInput1" placeholder="z.‚ÄØB. 500" />

      <label for="leverageInput2">üíº Lotgr√∂√üe:</label>
      <input type="number" id="leverageInput2" placeholder="z.‚ÄØB. 1.0" step="0.01" />

      <label for="leverageInput3">üìà Hebel:</label>
      <input type="number" id="leverageInput3" placeholder="z.‚ÄØB. 10" step="1" />
    </div>

    <!-- MODUS 2: Hebel + Kapital ‚ûú Lotcheck -->
    <div id="lotCheckMode" style="display:none">
  <label for="lotCapital">üì¶ Kapital (in ‚Ç¨):</label>
  <input type="number" id="lotCapital" placeholder="z.‚ÄØB. 250" />

  <label for="lotLeverage">üí° Hebel (z.‚ÄØB. 500):</label>
  <input type="number" id="lotLeverage" placeholder="z.‚ÄØB. 500" />

  <label for="lotPair">üìä W√§hrungspaar:</label>
<select id="lotPair">
  <optgroup label="üîÅ Forex">
    <option value="EUR/USD">EUR/USD</option>
    <option value="GBP/USD">GBP/USD</option>
    <option value="AUD/USD">AUD/USD</option>
    <option value="NZD/USD">NZD/USD</option>
    <option value="USD/CAD">USD/CAD</option>
    <option value="USD/CHF">USD/CHF</option>
    <option value="USD/JPY">USD/JPY</option>
    <option value="EUR/JPY">EUR/JPY</option>
    <option value="GBP/JPY">GBP/JPY</option>
    <option value="CHF/JPY">CHF/JPY</option>
    <option value="AUD/JPY">AUD/JPY</option>
    <option value="CAD/JPY">CAD/JPY</option>
    <option value="EUR/GBP">EUR/GBP</option>
    <option value="EUR/AUD">EUR/AUD</option>
    <option value="EUR/CAD">EUR/CAD</option>
    <option value="GBP/AUD">GBP/AUD</option>
    <option value="GBP/CAD">GBP/CAD</option>
  </optgroup>

  <optgroup label="ü•á Rohstoffe">
    <option value="XAU/USD">XAU/USD (Gold)</option>
    <option value="XAG/USD">XAG/USD (Silber)</option>
  </optgroup>

  <optgroup label="üíπ Indizes">
    <option value="US30">US30 (Dow Jones)</option>
    <option value="NAS100">NAS100 (Nasdaq)</option>
    <option value="SPX500">SPX500 (S&P 500)</option>
    <option value="GER40">GER40 (DAX)</option>
    <option value="UK100">UK100 (FTSE)</option>
  </optgroup>

  <optgroup label="‚Çø Krypto">
    <option value="BTC/USD">BTC/USD</option>
    <option value="ETH/USD">ETH/USD</option>
  </optgroup>
</select>

</div>

    <button onclick="calculateLeverage()">üîß Berechnen</button>
    <p id="leverageResult" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
  </div>
</div>

  <!-- üìÜ Kalender -->
<div id="journalCalendarBox" class="stats-box" style="margin-top: 20px;">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <button onclick="changeMonth(-1)">‚¨ÖÔ∏è</button>
    <h3 id="calendarTitle">üóìÔ∏è Journal-Kalender</h3>
    <button onclick="changeMonth(1)">‚û°Ô∏è</button>
  </div>

  <canvas id="calendarEquityChart" height="150" style="margin:10px auto 5px auto; display:block;"></canvas>

  <div id="calendarEquityStats" style="color: #ccc; margin-top: 5px;"></div>
  <div id="calendarContainer" style="margin-top: 10px;"></div>
  <div id="calendarStats" style="margin-top: 5px; color: #ccc;"></div>
  <div id="journalEntryList" style="margin-top: 0;"></div>
</div>

<!-- üìò Journal-Eingabe -->
<div id="calc-journal" class="calc-box" style="display:none; margin-top: 10px;">
  <div class="stats-box" style="display: flex; flex-direction: column; gap: 14px; max-width: 500px; margin: auto; padding: 20px; border-radius: 12px; background: #1a1a1a; color: #eee;">

    <label>üß≠ Strategie-Modus:</label>
    <select id="tradingMode" onchange="updateBiasOptions()" class="input" style="width: 100%;">

      <option value="day">Daytrading</option>
      <option value="swing">Swing-Trading</option>
    </select>

    <label>üìÜ Datum:</label>
    <input type="date" id="journalManualDate" class="input" style="width: 100%;" />

    <label>üí± Symbol:</label>
    <input type="text" id="journalSymbol" class="input" placeholder="z.‚ÄØB. EUR/USD" oninput="suggestSymbol()" autocomplete="off" style="width: 100%;" />
    <div id="symbolSuggestions" style="background:#222; color:white; padding:5px; display:none; border-radius:6px;"></div>

<!-- Einstieg + Ausstieg + Richtung -->
<div style="display: flex; gap: 10px; flex-wrap: wrap;">
  <div style="flex: 1; min-width: 130px;">
    <label>üéØ Einstieg:</label>
    <input type="number" id="journalEntry" class="input" style="width: 100%;" onchange="autoSuggestExit()" />
  </div>
  <div style="flex: 1; min-width: 130px;">
    <label>üèÅ Ausstieg:</label>
    <input type="number" id="journalExit" class="input" style="width: 100%;" onchange="userChangedExit = true;" />
  </div>
  <div style="flex: 1; min-width: 130px;">
    <label>Richtung:</label>
    <select id="journalDirection" class="input" onchange="autoSuggestExit()">
      <option value="long">üìà Long</option>
      <option value="short">üìâ Short</option>
    </select>
  </div>
</div>

  <div style="display: flex; flex-direction: column; gap: 10px;">
<div>
  <label>üì¶ Lotgr√∂√üe:</label>
  <select id="journalLots" class="input" style="width: 100%; background-color: white; color: black;">
    <option value="">‚Äì Bitte w√§hlen ‚Äì</option>
    <option value="0.01">0.01</option>
    <option value="0.02">0.02</option>
    <option value="0.03">0.03</option>
    <option value="0.05">0.05</option>
    <option value="0.10">0.10</option>
    <option value="0.25">0.25</option>
    <option value="0.50">0.50</option>
    <option value="1.00">1.00</option>
    <option value="2.00">2.00</option>
    <option value="3.00">3.00</option>
    <option value="5.00">5.00</option>
    <option value="10.00">10.00</option>
    <option value="25.00">25.00</option>
    <option value="50.00">50.00</option>
    <option value="100.00">100.00</option>
  </select>
</div>


  <div>
    <label>üìä PnL (‚Ç¨):</label>
<input type="text"
       id="journalPnL"
       class="input"
       placeholder="z.‚ÄØB. -50.00"
       inputmode="numeric"
       pattern="^-?[0-9]+([.,][0-9]{1,2})?$"
       style="width: 100%; background-color: white; color: black;" />


  </div>
</div>


  <div class="emotion-block">
  <label>üòê Fokus <strong>vor</strong> dem Trade:</label>
  <div id="starsBefore" class="star-rating"></div>
  <input type="hidden" id="emotionBefore" value="5" />
</div>

<div class="emotion-block">
  <label>üò§ Emotion <strong>nach</strong> dem Trade:</label>
  <div id="starsAfter" class="star-rating"></div>
  <input type="hidden" id="emotionAfter" value="5" />
</div>


    <label>üß† Setup:</label>
    <select id="journalSetup" class="input" style="width: 100%;">
      <option value="">‚Äì Setup w√§hlen ‚Äì</option>
      <option value="Breakout">Breakout</option>
      <option value="Rejection">Rejection</option>
      <option value="Liquidity Grab">Liquidity Grab</option>
      <option value="News Spike">News Spike</option>
      <option value="Orderblock Reentry">Orderblock Reentry</option>
    </select>

<!-- üß± Setup-Box Start -->
<div id="setupBoxWrapper"
  style="margin-top: 10px; border-radius: 12px; padding: 16px;
         background: linear-gradient(135deg, #3d1e1e, #6b2f2f);
         border: 2px solid #aa3333;
         color: #eee;
         box-shadow: 0 0 8px rgba(255, 50, 50, 0.25);
         transition: all 0.3s ease;">

  <label style="font-weight: bold; font-size: 16px; display: block; margin-bottom: 10px; color: #f0f0f0; text-shadow: 1px 1px 2px black;">
    ‚úÖ Setup-Check
  </label>

  <label style="margin-top: 5px; color: #f0f0f0; text-shadow: 1px 1px 2px black;">üß≠ Multi-Timeframe Bias:</label>
  <div id="biasTimeframes" style="display: flex; flex-wrap: wrap; gap: 10px; font-size: 14px; color: #eeeeee; text-shadow: 1px 1px 2px black;">
    <label><input type="checkbox" value="15M" onchange="updateSetupScoreDisplay()" /> 15M</label>
    <label><input type="checkbox" value="30M" onchange="updateSetupScoreDisplay()" /> 30M</label>
    <label><input type="checkbox" value="1H" onchange="updateSetupScoreDisplay()" /> 1H</label>
    <label><input type="checkbox" value="4H" onchange="updateSetupScoreDisplay()" /> 4H</label>
    <label><input type="checkbox" value="D1" onchange="updateSetupScoreDisplay()" /> D1</label>
    <label><input type="checkbox" value="W1" onchange="updateSetupScoreDisplay()" /> W1</label>
  </div>

  <div id="ruleChecklist" style="display: flex; flex-direction: column; gap: 10px; font-size: 14px; margin-top:10px; color: #eeeeee; text-shadow: 1px 1px 2px black;">
    <label><input type="checkbox" id="ruleAOI" onchange="updateSetupScoreDisplay()" />
      üß± AOI / POI reagiert sichtbar
    </label>
    <small style="margin-left: 20px; color:#dddddd; text-shadow: 1px 1px 1px black;">
      ‚ñ∂ Preis reagiert klar in AOI&POI (z.‚ÄØB. W, D1)
    </small>

    <label><input type="checkbox" id="ruleEntry" onchange="updateSetupScoreDisplay()" />
      üéØ Entry-Trigger best√§tigt
    </label>
    <small style="margin-left: 20px; color:#dddddd; text-shadow: 1px 1px 1px black;">
      ‚ñ∂ Rejection, Equal High/Low Raid, Shift
    </small>

    <label><input type="checkbox" id="ruleEntryPattern" onchange="updateSetupScoreDisplay()" />
      üß† Einstiegsmuster sichtbar
    </label>
    <small style="margin-left: 20px; color:#dddddd; text-shadow: 1px 1px 1px black;">
      ‚ñ∂ z.‚ÄØB. Inside Bar, Morning Star, Pinbar, Engulfing, Quasimodo
    </small>

    <label><input type="checkbox" id="rulePsych" onchange="updateSetupScoreDisplay()" />
      üí° Psychologisches Level
    </label>
    <small style="margin-left: 20px; color:#dddddd; text-shadow: 1px 1px 1px black;">
      ‚ñ∂ 00/50-Level, Vorwochen-Hoch/Tief, runde Zahlen (z.‚ÄØB. 1900, 1950)
    </small>

    <label><input type="checkbox" id="ruleSession" onchange="updateSetupScoreDisplay()" />
      üïí Richtiges Zeitfenster
    </label>
    <small style="margin-left: 20px; color:#dddddd; text-shadow: 1px 1px 1px black;">
      ‚ñ∂ Killzones: London (08:00‚Äì11:00), New York (14:30‚Äì17:00), Asia (02:00‚Äì04:00)
    </small>

    <label><input type="checkbox" id="ruleRR" onchange="updateSetupScoreDisplay()" />
      üìè Minimum 1:2.5 RR
    </label>
    <small style="margin-left: 20px; color:#dddddd; text-shadow: 1px 1px 1px black;">
      ‚ñ∂ Laut Struktur realistisch erreichbares Ziel: ‚â• 2,5x SL-Distanz
    </small>

    <label><input type="checkbox" id="ruleLTFShift" onchange="updateSetupScoreDisplay()" />
      üîÅ LTF Strukturwechsel (Shift)
    </label>
    <small style="margin-left: 20px; color:#dddddd; text-shadow: 1px 1px 1px black;">
      ‚ñ∂ MSS auf 15M - 2H ‚Üí z.‚ÄØB. HL ‚Üí HH ‚Üí LL
    </small>

    <div id="setupScoreDisplay" style="margin-top: 12px; font-size: 14px; font-weight: bold; color: #f0f0f0; text-shadow: 1px 1px 2px black;">
      üìä Setup-Score: <strong>0%</strong> ‚Äì ‚ùå Nicht g√ºltig
    </div>
  </div> <!-- ‚úÖ Ende der Regel-Checkliste-Box -->

</div> <!-- ‚úÖ Ende setupBoxWrapper -->

<!-- üîª Jetzt alles au√üerhalb der Box -->
<div style="margin-top: 20px; font-size: 14px; color: #eeeeee; text-shadow: 1px 1px 2px black;">

  <label>üìù Kommentar <strong>vor dem Trade</strong>:</label>
  <textarea id="journalNotesBefore" rows="2" class="input" style="border-radius: 6px; width: 100%; margin-bottom: 10px;"></textarea>

  <label>üìù Kommentar <strong>nach dem Trade</strong>:</label>
  <textarea id="journalNotesAfter" rows="2" class="input" style="border-radius: 6px; width: 100%; margin-bottom: 10px;"></textarea>

  <label for="screenshotInput">üì∏ Screenshots hochladen (optional):</label>
  <input type="file" id="screenshotInput" accept="image/*" multiple class="input" style="margin-bottom: 15px;" />

  <button id="saveJournalEntryButton" onclick="saveJournalEntry()" style="
    background-color: #0077cc;
    color: white;
    padding: 14px;
    border: none;
    border-radius: 8px;
    margin-top: 10px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    width: 100%;
  ">üíæ Eintrag speichern</button>
</div>




<div id="lightboxOverlay" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:9999;" onclick="closeLightbox()">
  <img id="lightboxImage" src="" alt="Bild" style="max-width:90vw; max-height:90vh; border-radius:10px; box-shadow: 0 0 20px #000;" />
</div>

<div style="margin-top:20px; text-align:center;">
  <button onclick="resetCurrentMonth()" style="margin:5px; background:#cc6600; color:white; padding:8px 15px; border:none; border-radius:5px;">üóìÔ∏è Monat zur√ºcksetzen</button>
  <button onclick="resetSelectedDay()" style="margin:5px; background:#0066cc; color:white; padding:8px 15px; border:none; border-radius:5px;">üìÖ Tag zur√ºcksetzen</button>
  <button onclick="resetAllJournal()" style="margin:5px; background:#990000; color:white; padding:8px 15px; border:none; border-radius:5px;">üóëÔ∏è Alles l√∂schen</button>
</div>

<!-- üîç Lightbox f√ºr vergr√∂√üerte Bilder -->
<div id="lightboxOverlay" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:9999;" onclick="closeLightbox()">
  <img id="lightboxImage" src="" alt="Full Screenshot" style="max-width:90vw; max-height:90vh; border-radius:10px; box-shadow: 0 0 20px #000;" />
</div>


<input type="file" id="screenshotInput" accept="image/*" multiple>

<div class="popup" id="resultPopup">
  <h3>Ergebnis</h3>
  <input type="text" inputmode="decimal" id="pnlInput" placeholder="z.‚ÄØB. 120.50" value="00,00" />
  <button onclick="saveResult()">Speichern</button>
</div>
<div id="syncStatus" style="text-align:center; color:#00ff99; font-weight:bold; margin-top:10px;"></div>

<body>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="scripts/position.js"></script>
<script src="scripts/dawn.js"></script>
<script src="scripts/tax.js"></script>
<script src="imageStorage.js"></script>
<script src="scripts/bg-candles.js"></script>
<script src="scripts/ticker.js"></script>
<script src="scripts/session.js"></script>
<script src="scripts/jornal.js"></script>
<script src="scripts/pwa.js"></script>
</body>

</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<script>
function sendPushNotification(title, message) {
  if ("Notification" in window && Notification.permission === "granted" && "serviceWorker" in navigator) {
    navigator.serviceWorker.ready.then((registration) => {
      registration.showNotification(title, {
        body: message,
        icon: "https://cdn-icons-png.flaticon.com/512/1827/1827409.png",
        vibrate: [200, 100, 200],
        tag: "session-alert",
        renotify: true
      });
    }).catch(err => {
      console.error("‚ùå Notification via Service Worker fehlgeschlagen:", err);
    });
  } else {
    console.warn("‚ùå Keine Notification m√∂glich ‚Äì Erlaubnis oder SW fehlen.");
  }
}

// ‚úÖ Einheitlicher Notification-Aufruf f√ºr Sessionstarts
function showSessionStartNotification(sessionName, message) {
  const title = `üì£ ${sessionName}-Session gestartet!`;
  sendPushNotification(title, message);
}

// ‚úÖ Diagnosetool zum Testen
function diagnoseNotifications() {
  const output = document.getElementById("notificationStatus");
  output.style.display = "block";

  let msg = "üîç <strong>Benachrichtigungs-Check:</strong><br>";

  if (!("Notification" in window)) {
    msg += "‚ùå Notifications werden vom Browser nicht unterst√ºtzt.<br>";
  } else {
    msg += `üì± Notification.permission: <strong>${Notification.permission}</strong><br>`;
    if (Notification.permission === "granted") {
      try {
        sendPushNotification("‚úÖ Test-Notification", "üéØ Die Notification funktioniert!");
        msg += "‚úÖ Test-Notification wurde ausgel√∂st.<br>";
      } catch (err) {
        msg += "‚ùå Fehler beim Notification-Aufruf: " + err.message + "<br>";
      }
    } else if (Notification.permission === "denied") {
      msg += "üö´ Du hast Benachrichtigungen blockiert.<br>";
    } else if (Notification.permission === "default") {
      Notification.requestPermission().then((perm) => {
        msg += `üì© Neue Erlaubnis: ${perm}<br>`;
      });
    }
  }

  output.innerHTML = msg;
}

// ‚úÖ Aktivierungs-Button
function enableNotifications() {
  Notification.requestPermission().then(permission => {
    const statusBox = document.getElementById("notificationStatus");
    statusBox.style.display = "block";

    if (permission === "granted") {
      sendPushNotification("‚úÖ Erlaubt", "Du bekommst ab jetzt Benachrichtigungen!");
      statusBox.innerHTML = "‚úÖ Benachrichtigungen erlaubt!";
    } else if (permission === "denied") {
      statusBox.innerHTML = "‚ùå Benachrichtigungen blockiert. Aktiviere sie im Schloss-Symbol der Adresszeile.";
    } else {
      statusBox.innerHTML = "‚ÑπÔ∏è Keine Entscheidung getroffen.";
    }
  });
}
</script>

</html>
