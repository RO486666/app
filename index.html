<!DOCTYPE html>
<html lang="de">
<head>
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#00aa44" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trade App Layout</title>
  <style>
    body {
      background: #111;
      color: white;
      font-family: sans-serif;
      margin: 0;
      padding: 0;
    }
    .header {
      background: #1c1c1c;
      padding: 10px;
      text-align: center;
      font-size: 18px;
    }
    .session-bar {
      height: 10px;
      background: linear-gradient(to right, #00aaff, #ffaa00, #ff3300);
      margin-top: 5px;
    }
	
    .main {
      padding: 20px;
      padding-bottom: 120px; /* Platz f√ºr Positionsleiste */
      text-align: center;
    }
    .big-btn {
      padding: 20px 30px;
      font-size: 22px;
      font-weight: bold;
      border-radius: 15px;
      border: none;
      background-color: #00aa44;
      color: white;
      margin: 20px auto;
      width: 80%;
      max-width: 300px;
    }
    .tab-buttons {
      text-align: center;
      margin-top: 20px;
    }
    .tab-buttons button {
      background: #333;
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      margin: 5px;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }
    .tab-buttons .active {
      background: #0077cc;
    }
    .stats-box {
      background: #222;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      text-align: left;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
    #resetBtn {
      background: #cc3333;
      color: white;
      padding: 12px;
      border: none;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
      font-weight: bold;
      margin: 20px auto 30px auto;
      cursor: pointer;
      display: block;
      user-select: none;
      position: relative; /* kein fixed */
      z-index: auto;
    }
    .position-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #1c1c1c;
      padding: 10px;
      display: flex;
      gap: 10px;
      overflow-x: auto;
      box-sizing: border-box;
      z-index: 10000; /* √ºber anderen Elementen */
	  touch-action: pan-y; /* Erlaubt vertikales Scrollen, verhindert horizontale Interferenzen */
    }
    .trade-box {
      flex: 0 0 auto;
      box-sizing: border-box;
      width: 85%;
      max-width: 280px;
      background: #333;
      padding: 10px;
      border-radius: 10px;
      min-width: 180px;
      color: white;
      user-select: none;
      z-index: 10001; /* √ºber reset Button */
	   touch-action: none; /* Damit alle Touch-Events an JS gehen */
      position: relative;
    }
    .trade-box.Long {
      background-color: #228B22; /* gr√ºn */
    }
    .trade-box.Short {
      background-color: #B22222; /* rot */
    }
    .result-value {
      margin-top: 5px;
      font-weight: bold;
    }
    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      padding: 20px;
      border-radius: 10px;
      display: none;
      z-index: 1000;
      width: 90%;
      max-width: 300px;
      color: white;
    }
    label {
      cursor: pointer;
      user-select: none;
      margin-right: 15px;
      display: inline-block;
    }
    #pairMultiSelect {
      max-height: 150px;
      overflow-y: auto;
      background: #222;
      padding: 5px;
      border-radius: 6px;
      color: white;
      margin-bottom: 10px;
      text-align: left;
    }
    select, input {
      padding: 8px;
      margin-top: 10px;
      width: 100%;
      border-radius: 5px;
      border: none;
      font-size: 16px;
    }
    .popup button {
      margin-top: 10px;
      padding: 10px;
      width: 100%;
      font-size: 16px;
      cursor: pointer;
    }
    .ticker {
      width: 100%;
      background: #222;
      color: #00ff99;
      padding: 10px;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      font-family: Arial, sans-serif;
      user-select: none;
    }
    .session-info {
      margin-top: 5px;
      font-size: 14px;
      color: #aaf0aa;
      text-align: center;
      font-style: italic;
      user-select: none;
    }
	
.session-details-box {
  display: none;
  background: #1a1a1a;
  padding: 15px;
  margin: 10px 20px;
  border-radius: 10px;
  font-size: 14px;
  color: #eee;
  text-align: left;
  box-shadow: 0 0 10px rgba(0,0,0,0.4);
}


  .session-details-box {
    font-size: 13px;
    margin: 10px;
    padding: 12px;
    line-height: 1.4;
  }

  .session-header, #sessionText {
    font-size: 16px;
    padding: 12px;
  }
  
  #sessionText {
  user-select: none;
  cursor: pointer;
}
    .progress-container {
      position: relative;
      background: #111;
      height: 24px;
      width: 100%;
      border-top: 1px solid #333;
      border-bottom: 1px solid #333;
      overflow: hidden;
      border-radius: 6px;
      margin-top: 5px;
    }
    .progress-bar {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 0%; /* wird per JS gesetzt */
      background: linear-gradient(to right, #00aaff, #ffaa00, #ff3300);
      transition: width 1s linear;
      background-size: 100% 100%;
      background-repeat: no-repeat;
      z-index: 2;
    }
	
	.session-details-box ul {
  padding-left: 20px;
  margin-top: 8px;
  margin-bottom: 8px;
  list-style-type: disc;
}

.session-details-box li {
  margin-bottom: 4px;
}

.tool-button {
  background-color: #333;
  color: white;
  border: none;
  padding: 10px 20px;
  margin: 5px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
}
.tool-button:hover {
  background-color: #444;
}
	
  </style>
</head>
<body>

<button onclick="startCtraderLogin()" class="tool-button">üîê Mit cTrader verbinden</button>
<button onclick="exchangeCodeForToken()">üîÑ Code ‚ûú Token tauschen</button>
<button onclick="getAccounts()">üìä Konten laden</button>
<button id="manualSyncBtn" onclick="syncMyfxbook()" style="display:none">
  üì• Manuell synchronisieren (22:00‚Äì23:00)
</button>

<div class="ticker" id="sessionText">Session-Zeit: 00:00</div>
<div class="session-info" id="sessionInfo">Tipps und Infos zur Session erscheinen hier...</div>
<div class="progress-container">
  <div class="progress-bar" id="progressBar"></div>
</div>
<!-- HIER EINSETZEN -->
<div id="sessionProgressDisplay"
     style="text-align:center;
            font-size: 16px;
            font-weight: bold;
            margin-top: 8px;
            color: #00ff99;
            background: #111;
            padding: 6px;
            border-radius: 8px;">
</div>

<div class="session-details-box" id="sessionDetailsBox"></div>
<div class="alert-below-header" id="alertBox"></div>

<div class="tab-buttons" style="margin-top: 20px;">
  <button class="btn" id="btn-calc-pos" onclick="switchCalcTab('pos')">üìê Position Size</button>
  <button class="btn" id="btn-calc-risk" onclick="switchCalcTab('risk')">üìä Risiko %</button>
  <button class="btn" id="btn-calc-lot" onclick="switchCalcTab('lot')">üßÆ Lot-Rechner</button>
  <button class="btn" id="btn-calc-breakeven" onclick="switchCalcTab('breakeven')">üß† Break-even</button>
  <button class="btn" id="btn-calc-pip" onclick="switchCalcTab('pip')">üìè Pip-Wert</button>
  <button class="btn" id="btn-calc-leverage" onclick="switchCalcTab('leverage')">üîß Hebel-Rechner</button>
</div>



<div id="calc-pos" class="calc-box" style="margin-top: 15px; display:none;">

  <div class="stats-box">
    <label for="accountSize">üì¶ Kontogr√∂√üe (‚Ç¨):</label>
    <input type="number" id="accountSize" placeholder="z.‚ÄØB. 1000" />

    <label for="riskPercent">‚ö†Ô∏è Risiko in %:</label>
    <input type="number" id="riskPercent" placeholder="z.‚ÄØB. 1" step="0.1" />

    <label for="stopLossPips">üõë Stop-Loss (in Pips):</label>
    <input type="number" id="stopLossPips" placeholder="z.‚ÄØB. 20" />

    <label for="pipValue">üí° Pip-Wert pro Lot (‚Ç¨):</label>
    <input type="number" id="pipValue" placeholder="z.‚ÄØB. 10 (Standard bei Forex)" value="10" />

    <button onclick="calculatePositionSize()">üìê Berechnen</button>
    <p id="positionSizeResult" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
  </div>

  <div style="text-align:right; margin-bottom: 5px;">
    <span onclick="toggleInfoBox()" 
          style="cursor:pointer; background:#444; border-radius:50%; padding:3px 8px; font-weight:bold; color:#0ff;"
          title="Erkl√§rung anzeigen">i</span>
  </div>
  <div id="posInfoBox" style="display:none; background:#222; padding:12px; border-radius:8px; margin-top:10px; color:#ccc; font-size:14px; text-align:left;">
    <strong>‚ÑπÔ∏è Was macht dieser Rechner?</strong><br><br>
    Der Positionsgr√∂√üen-Rechner hilft dir zu ermitteln, wie viele Lots du in einem Trade einsetzen darfst, ohne mehr als einen bestimmten Prozentsatz deines Kontos zu riskieren. Die Berechnung basiert auf vier Angaben:
    <ul style="margin-top:10px; margin-bottom:10px;">
      <li><strong>üì¶ Kontogr√∂√üe:</strong> Dein aktuelles Guthaben in Euro.</li>
      <li><strong>‚ö†Ô∏è Risiko in %:</strong> Wie viel Prozent deines Kontos du maximal pro Trade verlieren willst (z.‚ÄØB. 1%).</li>
      <li><strong>üõë Stop-Loss (Pips):</strong> Die Distanz zwischen Einstieg und Stop-Loss in Pips.</li>
      <li><strong>üí° Pip-Wert pro Lot:</strong> Wie viel ein Pip pro Standard-Lot wert ist (z.‚ÄØB. 10‚ÄØ‚Ç¨ bei EUR/USD).</li>
    </ul>
    <strong>üìê Formel:</strong><br>
    <code style="color:#0ff;">Positionsgr√∂√üe = (Kontogr√∂√üe √ó Risiko%) / (Stop-Loss √ó Pip-Wert)</code><br><br>
    <strong>üîç Beispiel:</strong><br>
    Kontogr√∂√üe: 1000 ‚Ç¨<br>
    Risiko: 2%<br>
    Stop-Loss: 20 Pips<br>
    Pip-Wert: 10 ‚Ç¨/Lot<br><br>
    <strong>‚Üí</strong> Du riskierst 20 ‚Ç¨ (1000‚ÄØ√ó‚ÄØ0,02).<br>
    <strong>‚Üí</strong> Bei 20 Pips w√§ren das 1‚ÄØ‚Ç¨/Pip erlaubt (20‚ÄØ‚Ç¨ / 20‚ÄØPips).<br>
    <strong>‚Üí</strong> Der Pip-Wert ist 10‚ÄØ‚Ç¨/Lot ‚áí <strong>Erlaubte Lotgr√∂√üe: 0.10</strong><br><br>
    <em style="color:#aaa;">Hinweis: Bei Indizes oder Gold kann der Pip-Wert unterschiedlich sein!</em>
  </div>
</div>

<div id="calc-risk" class="calc-box" style="display:none; margin-top: 15px;">
 <div class="stats-box">
  <label for="riskAccountSize">üì¶ Kontogr√∂√üe (‚Ç¨):</label>
  <input type="number" id="riskAccountSize" placeholder="z.‚ÄØB. 1000" />

  <label for="riskLotSize">üßÆ Lotgr√∂√üe:</label>
  <input type="number" id="riskLotSize" placeholder="z.‚ÄØB. 0.1" step="0.01" />

  <label for="riskStopLoss">üõë Stop-Loss (Pips):</label>
  <input type="number" id="riskStopLoss" placeholder="z.‚ÄØB. 25" />

  <label for="riskPipValue">üí° Pip-Wert pro Lot (‚Ç¨):</label>
  <input type="number" id="riskPipValue" placeholder="z.‚ÄØB. 10" value="10" />

  <label for="useTradingView">‚öôÔ∏è TradingView-Modus:</label>
  <input type="checkbox" id="useTradingView" onchange="togglePipMode()" />

  <div id="tvNote" style="font-size: 12px; color: #aaa; margin-top: 5px; display:none;">
    üìâ Pip-Wert wird intern mit <strong>6.30 ‚Ç¨</strong> angenommen (wie bei TradingView)
  </div>

  <button onclick="calculateRiskPercent()">üìä Risiko berechnen</button>
  <p id="riskResult" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
</div>

  <div style="text-align:right; margin-bottom: 5px;">
    <span onclick="toggleRiskInfo()" 
          style="cursor:pointer; background:#444; border-radius:50%; padding:3px 8px; font-weight:bold; color:#0ff;"
          title="Erkl√§rung anzeigen">i</span>
  </div>

  <div id="riskInfoBox" style="display:none; background:#222; padding:12px; border-radius:8px; margin-top:10px; color:#ccc; font-size:14px; text-align:left;">
    <strong>‚ÑπÔ∏è Was macht dieser Rechner?</strong><br><br>
    Der Risiko-%-Rechner zeigt dir, wie viel Geld du bei einem Trade riskierst und wie viel Prozent deines Kontos das ausmacht. Er basiert auf:

    <ul style="margin-top:10px; margin-bottom:10px;">
      <li><strong>üì¶ Kontogr√∂√üe:</strong> Dein Kontoguthaben in Euro</li>
      <li><strong>üßÆ Lotgr√∂√üe:</strong> Wie gro√ü dein Trade ist (z.‚ÄØB. 0.1 = Mini-Lot)</li>
      <li><strong>üõë Stop-Loss (Pips):</strong> Wie weit der SL vom Einstieg entfernt ist</li>
      <li><strong>üí° Pip-Wert:</strong> Wie viel 1 Pip pro Lot kostet (z.‚ÄØB. 10‚ÄØ‚Ç¨)</li>
    </ul>

    <strong>üìê Formel:</strong><br>
    <code style="color:#0ff;">Risiko (‚Ç¨) = Lotgr√∂√üe √ó SL √ó Pip-Wert<br>
    Risiko-% = Risiko / Kontogr√∂√üe √ó 100</code><br><br>

    <strong>üîç Beispiel:</strong><br>
    Konto: 1000‚ÄØ‚Ç¨<br>
    Lot: 0.2<br>
    SL: 30 Pips<br>
    Pip-Wert: 10‚ÄØ‚Ç¨<br>
    ‚Üí Risiko = 0.2 √ó 30 √ó 10 = 60‚ÄØ‚Ç¨<br>
    ‚Üí Risiko-% = 60 / 1000 = <strong>6‚ÄØ%</strong><br><br>

    <em style="color:#aaa;">Achte darauf, dass dein Risiko unter 2‚ÄØ% bleibt, um langfristig zu √ºberleben.</em>
  </div>
</div>



<div id="calc-lot" class="calc-box" style="display:none; margin-top: 15px;">
  <div class="stats-box">
    <label for="lotFixedRisk">üí∞ Risiko in Euro:</label>
    <input type="number" id="lotFixedRisk" placeholder="z.‚ÄØB. 50" />

    <label for="lotSL">üõë Stop-Loss (in Pips):</label>
    <input type="number" id="lotSL" placeholder="z.‚ÄØB. 20" />

    <label for="lotPipValue">üí° Pip-Wert pro Lot (‚Ç¨):</label>
    <input type="number" id="lotPipValue" placeholder="z.‚ÄØB. 10" value="10" />

    <button onclick="calculateLotFromFixed()">üßÆ Lotgr√∂√üe berechnen</button>

    <p id="lotResult" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
  </div>

  <div style="text-align:right; margin-bottom: 5px;">
    <span onclick="toggleLotInfo()" 
          style="cursor:pointer; background:#444; border-radius:50%; padding:3px 8px; font-weight:bold; color:#0ff;"
          title="Erkl√§rung anzeigen">i</span>
  </div>

  <div id="lotInfoBox" style="display:none; background:#222; padding:12px; border-radius:8px; margin-top:10px; color:#ccc; font-size:14px; text-align:left;">
    <strong>‚ÑπÔ∏è Was macht dieser Rechner?</strong><br><br>
    Du gibst an, wie viel Euro du maximal verlieren willst ‚Äì der Rechner sagt dir, welche Lotgr√∂√üe das erlaubt.<br><br>

    <strong>Beispiel:</strong><br>
    Risiko: 100‚ÄØ‚Ç¨<br>
    SL: 25 Pips<br>
    Pip-Wert: 10‚ÄØ‚Ç¨/Lot<br>
    ‚Üí <code style="color:#0ff;">Lots = 100 / (25 √ó 10) = 0.40</code>
  </div>
</div>

<div id="calc-breakeven" class="calc-box" style="display:none; margin-top: 15px;">
  <div class="stats-box">
    <label for="entryPrice">üéØ Einstiegspreis:</label>
    <input type="number" id="entryPrice" placeholder="z.‚ÄØB. 1.12345" step="0.00001" />

    <label for="spreadPips">üìè Spread (Pips):</label>
    <input type="number" id="spreadPips" placeholder="z.‚ÄØB. 1.5" step="0.1" />

    <label for="fees">üí∏ Geb√ºhren (‚Ç¨):</label>
    <input type="number" id="fees" placeholder="z.‚ÄØB. 2.00" step="0.01" />

    <label for="beLotSize">üßÆ Lotgr√∂√üe:</label>
    <input type="number" id="beLotSize" placeholder="z.‚ÄØB. 0.1" step="0.01" />

    <label for="bePipValue">üí° Pip-Wert pro Lot (‚Ç¨):</label>
    <input type="number" id="bePipValue" placeholder="z.‚ÄØB. 10" value="10" />

    <button onclick="calculateBreakeven()">üß† Break-even berechnen</button>

    <p id="breakevenResult" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
  </div>

  <div style="text-align:right; margin-bottom: 5px;">
    <span onclick="toggleBreakevenInfo()" 
          style="cursor:pointer; background:#444; border-radius:50%; padding:3px 8px; font-weight:bold; color:#0ff;"
          title="Erkl√§rung anzeigen">i</span>
  </div>

  <div id="breakevenInfoBox" style="display:none; background:#222; padding:12px; border-radius:8px; margin-top:10px; color:#ccc; font-size:14px; text-align:left;">
    <strong>‚ÑπÔ∏è Was macht dieser Rechner?</strong><br><br>
    Der Break-even-Rechner zeigt dir den Preis, bei dem dein Trade exakt auf Null l√§uft ‚Äì also weder Gewinn noch Verlust.<br><br>

    Dabei ber√ºcksichtigt werden:
    <ul style="margin-top:10px; margin-bottom:10px;">
      <li><strong>üéØ Einstiegspreis:</strong> Der Preis, zu dem du den Trade ge√∂ffnet hast.</li>
      <li><strong>üìè Spread:</strong> Unterschied zwischen Bid und Ask in Pips.</li>
      <li><strong>üí∏ Geb√ºhren:</strong> z.‚ÄØB. Kommissionen des Brokers.</li>
      <li><strong>üßÆ Lotgr√∂√üe:</strong> Deine aktuelle Positionsgr√∂√üe.</li>
      <li><strong>üí° Pip-Wert:</strong> Wert eines Pips pro Lot (z.‚ÄØB. 10‚ÄØ‚Ç¨ bei Forex).</li>
    </ul>

    <strong>üìê Formel:</strong><br>
    <code style="color:#0ff;">Break-even = Einstiegspreis ¬± (Spread + Geb√ºhren √∑ (Lotgr√∂√üe √ó Pip-Wert))</code><br><br>

    <em style="color:#aaa;">Ob du + oder ‚Äì rechnest, h√§ngt davon ab, ob du Long oder Short bist. Dieser Rechner geht vom LONG-Trade aus.</em>
  </div>
</div>

<div id="calc-leverage" class="calc-box" style="display:none; margin-top: 15px;">
  <div class="stats-box">
    <label for="leverageMode">Berechnungsmodus:</label>
    <select id="leverageMode" onchange="toggleLeverageMode()">
      <option value="capital">üîÅ Hebel ‚ûú Kapital berechnen</option>
      <option value="lotcheck">üìä Hebel + Kapital ‚ûú Lotcheck</option>
    </select>

    <!-- MODUS 1: Hebel ‚ûú Kapital -->
    <div id="capitalMode">
      <label for="leverageInput1">üì¶ Kapital (in ‚Ç¨):</label>
      <input type="number" id="leverageInput1" placeholder="z.‚ÄØB. 500" />

      <label for="leverageInput2">üíº Lotgr√∂√üe:</label>
      <input type="number" id="leverageInput2" placeholder="z.‚ÄØB. 1.0" step="0.01" />

      <label for="leverageInput3">üìà Hebel:</label>
      <input type="number" id="leverageInput3" placeholder="z.‚ÄØB. 10" step="1" />
    </div>

    <!-- MODUS 2: Hebel + Kapital ‚ûú Lotcheck -->
    <div id="lotCheckMode" style="display:none">
  <label for="lotCapital">üì¶ Kapital (in ‚Ç¨):</label>
  <input type="number" id="lotCapital" placeholder="z.‚ÄØB. 250" />

  <label for="lotLeverage">üí° Hebel (z.‚ÄØB. 500):</label>
  <input type="number" id="lotLeverage" placeholder="z.‚ÄØB. 500" />

  <label for="lotPair">üìä W√§hrungspaar:</label>
<select id="lotPair">
  <optgroup label="üîÅ Forex">
    <option value="EUR/USD">EUR/USD</option>
    <option value="GBP/USD">GBP/USD</option>
    <option value="AUD/USD">AUD/USD</option>
    <option value="NZD/USD">NZD/USD</option>
    <option value="USD/CAD">USD/CAD</option>
    <option value="USD/CHF">USD/CHF</option>
    <option value="USD/JPY">USD/JPY</option>
    <option value="EUR/JPY">EUR/JPY</option>
    <option value="GBP/JPY">GBP/JPY</option>
    <option value="CHF/JPY">CHF/JPY</option>
    <option value="AUD/JPY">AUD/JPY</option>
    <option value="CAD/JPY">CAD/JPY</option>
    <option value="EUR/GBP">EUR/GBP</option>
    <option value="EUR/AUD">EUR/AUD</option>
    <option value="EUR/CAD">EUR/CAD</option>
    <option value="GBP/AUD">GBP/AUD</option>
    <option value="GBP/CAD">GBP/CAD</option>
  </optgroup>

  <optgroup label="ü•á Rohstoffe">
    <option value="XAU/USD">XAU/USD (Gold)</option>
    <option value="XAG/USD">XAG/USD (Silber)</option>
  </optgroup>

  <optgroup label="üíπ Indizes">
    <option value="US30">US30 (Dow Jones)</option>
    <option value="NAS100">NAS100 (Nasdaq)</option>
    <option value="SPX500">SPX500 (S&P 500)</option>
    <option value="GER40">GER40 (DAX)</option>
    <option value="UK100">UK100 (FTSE)</option>
  </optgroup>

  <optgroup label="‚Çø Krypto">
    <option value="BTC/USD">BTC/USD</option>
    <option value="ETH/USD">ETH/USD</option>
  </optgroup>
</select>

</div>

    <button onclick="calculateLeverage()">üîß Berechnen</button>
    <p id="leverageResult" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
  </div>
</div>



<div id="calc-pip" class="calc-box" style="display:none; margin-top: 15px;">
  <div class="stats-box">
    <label for="pairSelect">üîÄ W√§hrungspaar:</label>
    <select id="pairSelect">
      <!-- Wird automatisch gef√ºllt -->
    </select>

    <label for="lotSize">üíº Lotgr√∂√üe:</label>
    <input type="number" id="lotSize" placeholder="z.‚ÄØB. 0.01" value="0.01" step="0.01" />

    <button onclick="calculatePipValue()">üìè Pip-Wert berechnen</button>

    <p id="pipResult" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
  </div>

  <div style="text-align:right; margin-bottom: 5px;">
    <span onclick="togglePipInfo()" 
          style="cursor:pointer; background:#444; border-radius:50%; padding:3px 8px; font-weight:bold; color:#0ff;"
          title="Erkl√§rung anzeigen">i</span>
  </div>

  <div id="pipInfoBox" style="display:none; background:#222; padding:12px; border-radius:8px; margin-top:10px; color:#ccc; font-size:14px; text-align:left;">
    <strong>‚ÑπÔ∏è Was macht dieser Rechner?</strong><br><br>
    Dieser Rechner zeigt dir, wie viel **1 Pip** bei der gew√§hlten **Lotgr√∂√üe** und dem **W√§hrungspaar** wert ist.<br><br>

    <strong>üìê Formel:</strong>  
    Pip-Wert = Standard-Wert pro Lot √ó Lotgr√∂√üe<br><br>

    Die Werte basieren auf typischen Marktbedingungen.<br>
    Bei Rohstoffen (XAU, XAG) ist der Pip-Wert oft h√∂her.
  </div>
</div>



  <div class="tab-buttons">
    <button class="btn active" onclick="switchTab('tag')">Tag</button>
    <button class="btn" onclick="switchTab('woche')">Woche</button>
    <button class="btn" onclick="switchTab('monat')">Monat</button>
	<button class="btn" onclick="switchTab('halbjahr')">Halbjahr</button>
	<button class="btn" onclick="switchTab('jahr')">Jahr</button>
  </div>
  
  <div id="sessionProgressDisplay" style="font-size: 13px; color: #aaa; margin-top: 5px;"></div>

   <div class="stats-box" id="tagBox">
  <h3>üìÖ Tagesauswertung</h3>
  <p>Gewinne: 0 | Verluste: 0</p>
  <p>Long-Wins: 0 | Short-Wins: 0</p>
  <p>St√§rke: Long: 0.0% | Short: 0.0%</p>
  <p>Balance: 0,00 ‚Ç¨</p>
  <p>Deposits: 0,00 ‚Ç¨</p>
  <p>Profit: 0,00 ‚Ç¨</p>
  <p>Anzahl Trades: 0</p>
</div>

<div class="stats-box" id="wocheBox" style="display:none">
  <h3>üìà Wochenauswertung</h3>
  <p>Gewinne: 0 | Verluste: 0</p>
  <p>Long-Wins: 0 | Short-Wins: 0</p>
  <p>St√§rke: Long: 0.0% | Short: 0.0%</p>
  <p>Balance: 0,00 ‚Ç¨</p>
  <p>Deposits: 0,00 ‚Ç¨</p>
  <p>Profit: 0,00 ‚Ç¨</p>
  <p>Anzahl Trades: 0</p>
</div>

<div class="stats-box" id="monatBox" style="display:none">
  <h3>üìä Monatsauswertung</h3>
  <p>Gewinne: 0 | Verluste: 0</p>
  <p>Long-Wins: 0 | Short-Wins: 0</p>
  <p>St√§rke: Long: 0.0% | Short: 0.0%</p>
  <p>Balance: 0,00 ‚Ç¨</p>
  <p>Deposits: 0,00 ‚Ç¨</p>
  <p>Profit: 0,00 ‚Ç¨</p>
  <p>Anzahl Trades: 0</p>
</div>

<div class="stats-box" id="halbjahrBox" style="display:none">
  <h3>üìÖ Halbjahresauswertung</h3>
  <p>Gewinne: 0 | Verluste: 0</p>
  <p>Long-Wins: 0 | Short-Wins: 0</p>
  <p>St√§rke: Long: 0.0% | Short: 0.0%</p>
  <p>Balance: 0,00 ‚Ç¨</p>
  <p>Deposits: 0,00 ‚Ç¨</p>
  <p>Profit: 0,00 ‚Ç¨</p>
  <p>Anzahl Trades: 0</p>
</div>

  <div class="stats-box" id="jahrBox" style="display:none">
  <h3>üìÜ Jahresauswertung</h3>
  <p>Gewinne: 0 | Verluste: 0</p>
  <p>Long-Wins: 0 | Short-Wins: 0</p>
  <p>St√§rke: Long: 0.0% | Short: 0.0%</p>
  <p>Balance: 0,00 ‚Ç¨</p>
  <p>Deposits: 0,00 ‚Ç¨</p>
  <p>Profit: 0,00 ‚Ç¨</p>
  <p>Anzahl Trades: 0</p>
</div>

<div id="resetPopup" class="popup" style="display: none;">
  <h3>Was m√∂chtest du zur√ºcksetzen?</h3>
  <button id="resetDay">üìÖ Tag zur√ºcksetzen</button>
  <button id="resetWeek">üìà Woche zur√ºcksetzen</button>
  <button id="resetMonth">üìä Monat zur√ºcksetzen</button>
  <button id="resetAllBtn" style="background: crimson;">Alles l√∂schen</button>
  <button id="cancelReset" style="background:#555;">Abbrechen</button>
</div>
 <button id="resetBtn">Alles zur√ºcksetzen</button>


<div class="popup" id="tradePopup">
  <h3>Trade eingeben</h3>

  <label>Paare ausw√§hlen (mehrere m√∂glich):</label><br>
  <div id="pairMultiSelect"></div>


  <label for="directionSelect">Postion w√§hlen:</label>
  <select id="directionSelect" style="width: 100%; margin-top: 5px;">
    <option value="">Bitte w√§hlen</option>
    <option value="Long">Long</option>
    <option value="Short">Short</option>
  </select>

  <button onclick="addTrades()">Trades speichern</button>
   <button onclick="hidePopups()" style="margin-top:10px; background:#555;">Abbrechen</button>
</div>

<div class="popup" id="resultPopup">
  <h3>Ergebnis</h3>
  <input type="text" inputmode="decimal" id="pnlInput" placeholder="z.‚ÄØB. 120.50" value="00,00" />
  <button onclick="saveResult()">Speichern</button>
</div>
<div id="syncStatus" style="text-align:center; color:#00ff99; font-weight:bold; margin-top:10px;"></div>
<button id="manualSyncBtn" onclick="syncMyfxbook()" style="display:none">
  üì• Manuell synchronisieren (22:00‚Äì23:00)
</button>

<div class="position-bar" id="positionBar"></div>

<script>
  const pairs = [
  "AUD/CAD",
  "AUD/JPY",
  "AUD/USD",
  "CHF/JPY",
  "EUR/AUD",
  "EUR/CAD",
  "EUR/GBP",
  "EUR/JPY",
  "EUR/USD",
  "GBP/AUD",
  "GBP/JPY",
  "GBP/USD",
  "NZD/JPY",
  "NZD/USD",
  "USD/CAD",
  "USD/CHF",
  "USD/JPY",
  "XAG/USD",
  "XAU/USD"
];

function initMultiPairSelect() {
  const container = document.getElementById("pairMultiSelect");
  container.innerHTML = "";

  pairs.forEach(pair => {
    const label = document.createElement("label");
    label.style.marginRight = "15px";
    label.style.cursor = "pointer";
    label.style.userSelect = "none";

    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.value = pair;
    checkbox.checked = false;

    label.appendChild(checkbox);
    label.appendChild(document.createTextNode(" " + pair));
    container.appendChild(label);
  });
}


function resetAll() {
  if (!confirm("Willst du wirklich ALLE Statistiken und Trades l√∂schen?")) return;

  // üßπ Nur Statistik & Trade-Daten l√∂schen
  tradesData.length = 0;
  localStorage.removeItem("tradesData");
  localStorage.removeItem("myfxSummary");
  localStorage.removeItem("dayStats");
  localStorage.removeItem("weekStats");
  localStorage.removeItem("monthStats");
  localStorage.removeItem("halfYearStats");
  localStorage.removeItem("yearStats");

  // üßº UI zur√ºcksetzen
  document.getElementById("positionBar").innerHTML = "";

  // üîÅ Stats neu berechnen
  updateStats();

  // üîÑ Optional: Neuladen f√ºr klare UI
  location.reload();
}

function isSameDay(date1, date2) {
  return (
    date1.getDate() === date2.getDate() &&
    date1.getMonth() === date2.getMonth() &&
    date1.getFullYear() === date2.getFullYear()
  );
}

function isSameWeek(date1, date2) {
  const startOfWeek = new Date(date2);
  startOfWeek.setDate(date2.getDate() - date2.getDay());
  const endOfWeek = new Date(startOfWeek);
  endOfWeek.setDate(startOfWeek.getDate() + 6);
  return date1 >= startOfWeek && date1 <= endOfWeek;
}

function isSameMonth(date1, date2) {
  return date1.getMonth() === date2.getMonth() && date1.getFullYear() === date2.getFullYear();
}

function isSameHalfYear(date1, date2) {
  const half1 = date2.getMonth() < 6; // Jan-Jun ist erstes Halbjahr
  const half2 = date1.getMonth() < 6;
  return half1 === half2 && date1.getFullYear() === date2.getFullYear();
}

function isSameYear(date1, date2) {
  return date1.getFullYear() === date2.getFullYear();
}

const tradesData = [];
let activeBox = null;
let resultType = "win";

function loadTrades() {
  const saved = localStorage.getItem("tradesData");
  if (saved) {
    const arr = JSON.parse(saved);
    tradesData.length = 0;
    document.getElementById("positionBar").innerHTML = "";
  arr.forEach((trade) => {
  trade.date = new Date(trade.date);
  tradesData.push(trade);
  if (trade.pnl === null) {
    renderTradeBox(trade);
  }
});
  }
  updateStats();
}

function saveTrades() {
  localStorage.setItem("tradesData", JSON.stringify(tradesData));
}

function renderTradeBox(tradeObj) {
  const box = document.createElement("div");
  box.className = "trade-box " + tradeObj.direction;
  box.dataset.id = tradeObj.id;

  // Touchstart Listener
  let touchStartY = 0;
  let isSwiping = false;
  box.addEventListener("touchstart", (e) => {
    touchStartY = e.touches[0].clientY;
    isSwiping = false;
  }, { passive: true });

  // Close (X) Button zum Entfernen oben rechts
  const closeBtn = document.createElement("button");
  closeBtn.type = "button"; // wichtig f√ºr mobile Browser
  closeBtn.textContent = "‚úñ"; // kleines X
  closeBtn.style.position = "absolute";
  closeBtn.style.top = "8px";
  closeBtn.style.right = "8px";
  closeBtn.style.background = "transparent";
  closeBtn.style.border = "none";
  closeBtn.style.color = "white";
  closeBtn.style.fontSize = "20px";
  closeBtn.style.cursor = "pointer";
  closeBtn.style.zIndex = "10"; // sicherstellen, dass oben
  closeBtn.title = "Trade entfernen";
  closeBtn.addEventListener("click", (e) => {
    e.stopPropagation(); // Verhindert, dass andere Events feuern
    removeTradeById(tradeObj.id);
  });
  box.style.position = "relative"; // damit closeBtn richtig positioniert ist
  box.appendChild(closeBtn);

  let resultText = "";
if (typeof tradeObj.pnl === "number") {
  resultText = `<div class="result-value">PnL: ${tradeObj.pnl.toFixed(2)} ‚Ç¨</div>`;
} else {
  resultText = `
    <button onclick="markResult(this, 'win')">‚úÖ Erfolg</button>
    <button onclick="markResult(this, 'loss')">‚ùå Misserfolg</button>
    <div class="result-value"></div>
  `;
}

  const contentDiv = document.createElement("div");
  contentDiv.innerHTML = `<strong>${tradeObj.pair}</strong><br>${tradeObj.direction}<br>${resultText}`;
  box.appendChild(contentDiv);

  // Swipe-up f√ºr Handy (Touch-Event)
  box.addEventListener("touchmove", e => {
    const touchCurrentY = e.touches[0].clientY;
    const diffY = touchStartY - touchCurrentY;

    if (diffY > 15) { // kleiner Swipe-Up Threshold
      if (!isSwiping) {
        isSwiping = true;
        e.preventDefault(); // verhindert Scrollen
        removeTradeById(tradeObj.id);
      }
    }
  }, { passive: false });

  box.addEventListener("touchend", () => {
    touchStartY = 0;
    isSwiping = false;
  });

  document.getElementById("positionBar").appendChild(box);
}

function removeTradeById(id) {
  const index = tradesData.findIndex(t => t.id === id);
  if (index !== -1) {
    tradesData.splice(index, 1);
    saveTrades();
    loadTrades(); // neu rendern
  }
}

function markResult(btn, type) {
  activeBox = btn.closest(".trade-box");
  resultType = type;
  document.getElementById("pnlInput").value = "";
  document.getElementById("resultPopup").style.display = "block";
}

function saveResult() {
  let pnlRaw = document.getElementById("pnlInput").value;
  if (pnlRaw === "") return;

  // Tausenderpunkte entfernen und Komma durch Punkt ersetzen
  pnlRaw = pnlRaw.replace(/\./g, '').replace(',', '.');

  let pnl = parseFloat(pnlRaw);
  if (isNaN(pnl)) return;

  pnl = Math.abs(pnl);
  pnl = resultType === "loss" ? -pnl : pnl;

  const resultDiv = activeBox.querySelector(".result-value");
  resultDiv.innerText = `PnL: ${pnl.toFixed(2)} ‚Ç¨`;

  const tradeId = activeBox.dataset.id;
  const trade = tradesData.find((t) => t.id == tradeId);
  if (trade) {
    trade.pnl = pnl;
    trade.resultType = resultType;
  }

  activeBox.remove();

  saveTrades();

  hidePopups();
  updateStats();
}




function updateStats() {
  const now = new Date();

  function calcStats(filterFn) {
    const filtered = tradesData.filter((t) => t.pnl !== null && filterFn(t.date));
    const wins = filtered.filter((t) => t.pnl > 0);
    const losses = filtered.filter((t) => t.pnl < 0);
    const totalPnl = filtered.reduce((sum, t) => sum + t.pnl, 0);
    const totalAbsPnl = filtered.reduce((sum, t) => sum + Math.abs(t.pnl), 0);
	

    const profitFactor =
      losses.length === 0
        ? "‚Äì"
        : (wins.reduce((s, t) => s + t.pnl, 0) / Math.abs(losses.reduce((s, t) => s + t.pnl, 0))).toFixed(2);

    const avg = filtered.length === 0 ? "‚Äì" : (totalPnl / filtered.length).toFixed(2);
    const profitPercent = filtered.length === 0 ? null : (wins.length / filtered.length) * 100;


    return {
      trades: filtered,
      wins: wins.length,
      losses: losses.length,
      totalPnl,
      avg,
      totalTrades: wins.length + losses.length,
      profitPercent
    };
  }

  function colorText(value, isPnl = false) {
  if (isPnl) {
    return value >= 0
      ? `<span style="color: #0f0;">${value.toLocaleString('de-DE', {minimumFractionDigits: 2, maximumFractionDigits: 2})} ‚Ç¨</span>`
      : `<span style="color: #f44;">${value.toLocaleString('de-DE', {minimumFractionDigits: 2, maximumFractionDigits: 2})} ‚Ç¨</span>`;
  } else {
    return `<span style="color: ${value > 0 ? "#0f0" : "#f44"}">${value}</span>`;
  }
}

 function fillBox(box, stats, longShort) {
    const summaryRaw = localStorage.getItem("myfxSummary");
    let deposit = 0, balance = stats.totalPnl, profit = stats.totalPnl;

    if (summaryRaw) {
      try {
        const myfx = JSON.parse(summaryRaw);
        if (myfx.deposit !== undefined && myfx.balance !== undefined) {
          deposit = myfx.deposit;
          balance = myfx.balance;
          profit = myfx.balance - myfx.deposit;
        }
      } catch (e) {
        console.warn("Myfx-Daten kaputt:", e);
      }
    }

 
    box.querySelector("p:nth-child(4)").innerHTML = `Balance: ${colorText(balance, true)}`;
    box.querySelector("p:nth-child(5)").innerHTML = `Deposits: ${colorText(deposit, true)}`;
    box.querySelector("p:nth-child(6)").innerHTML = `Profit: ${colorText(profit, true)}`;
    box.querySelector("p:nth-child(7)").innerHTML = `Anzahl Trades: ${stats.totalTrades}`;
    box.querySelector("p:nth-child(8)").innerHTML = `Profitabel: ${colorProfitPercent(stats.profitPercent)}`;
  }

   function getMyfxSummary() {
    try {
      const raw = localStorage.getItem("myfxSummary");
      if (!raw) return null;
      const obj = JSON.parse(raw);
      if (obj.deposit !== undefined && obj.balance !== undefined) return obj;
    } catch (e) {
      return null;
    }
    return null;
  }

  function colorProfitPercent(p) {
    if (p === null) return "‚Äì";
    if (p < 35) return `<span style="color:#f44">${p.toFixed(1)}%</span>`;
    if (p < 50) return `<span style="color:#ffcc00">${p.toFixed(1)}%</span>`;
    if (p < 75) return `<span style="color:#9acd32">${p.toFixed(1)}%</span>`;
    return `<span style="color:#008000">${p.toFixed(1)}%</span>`;
  }

  function countLongShortWins(trades) {
    const longs = trades.filter(t => t.direction === "Long" && t.pnl > 0).length;
    const shorts = trades.filter(t => t.direction === "Short" && t.pnl > 0).length;
    return { longs, shorts };
  }


  const isToday = (date) => isSameDay(date, now);
  const isThisWeek = (date) => isSameWeek(date, now);
  const isThisMonth = (date) => isSameMonth(date, now);
  const isThisHalfYear = (date) => isSameHalfYear(date, now);
  const isThisYear = (date) => isSameYear(date, now);

  const dayStats = calcStats(isToday);
  const weekStats = calcStats(isThisWeek);
  const monthStats = calcStats(isThisMonth);
  const halfYearStats = calcStats(isThisHalfYear);
  const yearStats = calcStats(isThisYear);

  const dayLongShort = countLongShortWins(dayStats.trades);
  const weekLongShort = countLongShortWins(weekStats.trades);
  const monthLongShort = countLongShortWins(monthStats.trades);
  const halfYearLongShort = countLongShortWins(halfYearStats.trades);
  const yearLongShort = countLongShortWins(yearStats.trades);

 // TAG
const tagSummary = getMyfxSummary();
const tagTruePnl = tagSummary ? tagSummary.balance - tagSummary.deposit : dayStats.totalPnl;
const tagBox = document.getElementById("tagBox");
tagBox.querySelector("p:nth-child(2)").innerHTML =
  `Gewinne: ${colorText(dayStats.wins)} | Verluste: ${colorText(dayStats.losses)}<br>` +
  `Long-Wins: ${dayLongShort.longs} | Short-Wins: ${dayLongShort.shorts}<br>` +
  `St√§rke: ${colorSidePercent(dayLongShort.longs, dayLongShort.shorts)}`;
tagBox.querySelector("p:nth-child(3)").innerHTML = `Gesamt PnL: ${colorText(tagTruePnl, true)}`;
tagBox.querySelector("p:nth-child(4)").innerHTML = `Anzahl Trades: ${dayStats.totalTrades}`;
tagBox.querySelector("p:nth-child(5)").innerHTML = `Profitabel: ${colorProfitPercent(dayStats.profitPercent)}`;
tagBox.querySelector("p:nth-child(6)").innerHTML = `Gewinne: ${colorText(dayStats.wins)} | Verluste: ${colorText(dayStats.losses)}`;
fillBox(tagBox, dayStats, dayLongShort);

// WOCHE
const weekSummary = getMyfxSummary();
const weekTruePnl = weekSummary ? weekSummary.balance - weekSummary.deposit : weekStats.totalPnl;
const wocheBox = document.getElementById("wocheBox");
wocheBox.querySelector("p:nth-child(2)").innerHTML =
  `Gewinne: ${colorText(weekStats.wins)} | Verluste: ${colorText(weekStats.losses)}<br>` +
  `Long-Wins: ${weekLongShort.longs} | Short-Wins: ${weekLongShort.shorts}<br>` +
  `St√§rke: ${colorSidePercent(weekLongShort.longs, weekLongShort.shorts)}`;
wocheBox.querySelector("p:nth-child(3)").innerHTML = `Gesamt PnL: ${colorText(weekTruePnl, true)}`;
wocheBox.querySelector("p:nth-child(4)").innerHTML = `Anzahl Trades: ${weekStats.totalTrades}`;
wocheBox.querySelector("p:nth-child(5)").innerHTML = `Profitabel: ${colorProfitPercent(weekStats.profitPercent)}`;
wocheBox.querySelector("p:nth-child(6)").innerHTML = `Gewinne: ${colorText(weekStats.wins)} | Verluste: ${colorText(weekStats.losses)}`;
fillBox(wocheBox, weekStats, weekLongShort);

// MONAT
const monatSummary = getMyfxSummary();
const monatTruePnl = monatSummary ? monatSummary.balance - monatSummary.deposit : monthStats.totalPnl;
const monatBox = document.getElementById("monatBox");
monatBox.querySelector("p:nth-child(2)").innerHTML =
  `Gewinne: ${colorText(monthStats.wins)} | Verluste: ${colorText(monthStats.losses)}<br>` +
  `Long-Wins: ${monthLongShort.longs} | Short-Wins: ${monthLongShort.shorts}<br>` +
  `St√§rke: ${colorSidePercent(monthLongShort.longs, monthLongShort.shorts)}`;
monatBox.querySelector("p:nth-child(3)").innerHTML = `Gesamt PnL: ${colorText(monatTruePnl, true)}`;
monatBox.querySelector("p:nth-child(4)").innerHTML = `Anzahl Trades: ${monthStats.totalTrades}`;
monatBox.querySelector("p:nth-child(5)").innerHTML = `Profitabel: ${colorProfitPercent(monthStats.profitPercent)}`;
monatBox.querySelector("p:nth-child(6)").innerHTML = `Gewinne: ${colorText(monthStats.wins)} | Verluste: ${colorText(monthStats.losses)}`;
fillBox(monatBox, monthStats, monthLongShort);

// HALBJAHR
const halbjahrSummary = getMyfxSummary();
const halbjahrTruePnl = halbjahrSummary ? halbjahrSummary.balance - halbjahrSummary.deposit : halfYearStats.totalPnl;
const halbjahrBox = document.getElementById("halbjahrBox");
halbjahrBox.querySelector("p:nth-child(2)").innerHTML =
  `Gewinne: ${colorText(halfYearStats.wins)} | Verluste: ${colorText(halfYearStats.losses)}<br>` +
  `Long-Wins: ${halfYearLongShort.longs} | Short-Wins: ${halfYearLongShort.shorts}<br>` +
  `St√§rke: ${colorSidePercent(halfYearLongShort.longs, halfYearLongShort.shorts)}`;
halbjahrBox.querySelector("p:nth-child(3)").innerHTML = `Gesamt PnL: ${colorText(halbjahrTruePnl, true)}`;
halbjahrBox.querySelector("p:nth-child(4)").innerHTML = `Anzahl Trades: ${halfYearStats.totalTrades}`;
halbjahrBox.querySelector("p:nth-child(5)").innerHTML = `Profitabel: ${colorProfitPercent(halfYearStats.profitPercent)}`;
halbjahrBox.querySelector("p:nth-child(6)").innerHTML = `Gewinne: ${colorText(halfYearStats.wins)} | Verluste: ${colorText(halfYearStats.losses)}`;
fillBox(halbjahrBox, halfYearStats, halfYearLongShort);

// JAHR
const jahrSummary = getMyfxSummary();
const jahrTruePnl = jahrSummary ? jahrSummary.balance - jahrSummary.deposit : yearStats.totalPnl;
const jahrBox = document.getElementById("jahrBox");
jahrBox.querySelector("p:nth-child(2)").innerHTML =
  `Gewinne: ${colorText(yearStats.wins)} | Verluste: ${colorText(yearStats.losses)}<br>` +
  `Long-Wins: ${yearLongShort.longs} | Short-Wins: ${yearLongShort.shorts}<br>` +
  `St√§rke: ${colorSidePercent(yearLongShort.longs, yearLongShort.shorts)}`;
jahrBox.querySelector("p:nth-child(3)").innerHTML = `Gesamt PnL: ${colorText(jahrTruePnl, true)}`;
jahrBox.querySelector("p:nth-child(4)").innerHTML = `Anzahl Trades: ${yearStats.totalTrades}`;
jahrBox.querySelector("p:nth-child(5)").innerHTML = `Profitabel: ${colorProfitPercent(yearStats.profitPercent)}`;
jahrBox.querySelector("p:nth-child(6)").innerHTML = `Gewinne: ${colorText(yearStats.wins)} | Verluste: ${colorText(yearStats.losses)}`;
fillBox(jahrBox, yearStats, yearLongShort);

}

function switchTab(tab) {
  // Tab-Buttons zur√ºcksetzen
  document.querySelectorAll(".tab-buttons button").forEach(btn => btn.classList.remove("active"));

  // Nur Statistikboxen gezielt ausblenden
  const statsIds = ["tagBox", "wocheBox", "monatBox", "halbjahrBox", "jahrBox"];
  statsIds.forEach(id => {
    const box = document.getElementById(id);
    if (box) box.style.display = "none";
  });

  // Gew√§hlte Statistikbox einblenden
  const target = document.getElementById(tab + "Box");
  if (target) target.style.display = "block";

  // Aktiven Button wieder markieren
  document.querySelectorAll(".tab-buttons button").forEach((btn) => {
    if (btn.textContent.toLowerCase() === tab) btn.classList.add("active");
  });
}


function colorSidePercent(longWins, shortWins) {
  const total = longWins + shortWins;
  if (total === 0) return "‚Äì";

  const longPercent = (longWins / total) * 100;
  const shortPercent = (shortWins / total) * 100;

  const longColor = longPercent > shortPercent ? "#0f0" : "#f44";
  const shortColor = shortPercent > longPercent ? "#0f0" : "#f44";

  return `
    <span style="color:${longColor}">Long: ${longPercent.toFixed(1)}%</span> | 
    <span style="color:${shortColor}">Short: ${shortPercent.toFixed(1)}%</span>
  `;
}


function showPopup() {
  document.getElementById("tradePopup").style.display = "block";
}

function hidePopups() {
  document.getElementById("tradePopup").style.display = "none";
  document.getElementById("resultPopup").style.display = "none";
}

function resetDay() {
  const today = new Date();
  const remaining = tradesData.filter(t => !isSameDay(t.date, today));
  tradesData.length = 0;
  tradesData.push(...remaining);
  saveTrades();
  loadTrades();
}

function resetWeek() {
  const today = new Date();
  const remaining = tradesData.filter(t => !isSameWeek(t.date, today));
  tradesData.length = 0;
  tradesData.push(...remaining);
  saveTrades();
  loadTrades();
}

function resetMonth() {
  const today = new Date();
  const remaining = tradesData.filter(t => !isSameMonth(t.date, today));
  tradesData.length = 0;
  tradesData.push(...remaining);
  saveTrades();
  loadTrades();
}

window.addEventListener("load", () => {
  initMultiPairSelect();
  loadTrades();

  const resetBtn = document.getElementById("resetBtn");
  const resetDayBtn = document.getElementById("resetDay");
  const resetWeekBtn = document.getElementById("resetWeek");
  const resetMonthBtn = document.getElementById("resetMonth");
  const resetAllBtn = document.getElementById("resetAllBtn");
  const cancelResetBtn = document.getElementById("cancelReset");

  if (resetBtn) {
    resetBtn.addEventListener("click", () => {
      document.getElementById("resetPopup").style.display = "block";
    });
  }

  if (resetDayBtn) {
    resetDayBtn.addEventListener("click", () => {
      resetDay();
      document.getElementById("resetPopup").style.display = "none";
    });
  }

  if (resetWeekBtn) {
    resetWeekBtn.addEventListener("click", () => {
      resetWeek();
      document.getElementById("resetPopup").style.display = "none";
    });
  }

  if (resetMonthBtn) {
    resetMonthBtn.addEventListener("click", () => {
      resetMonth();
      document.getElementById("resetPopup").style.display = "none";
    });
  }

  if (resetAllBtn) {
    resetAllBtn.addEventListener("click", () => {
      resetAll();
      document.getElementById("resetPopup").style.display = "none";
    });
  }

  if (cancelResetBtn) {
    cancelResetBtn.addEventListener("click", () => {
      document.getElementById("resetPopup").style.display = "none";
    });
  }
});
  window.addEventListener('load', () => {
    const pnlInput = document.getElementById("pnlInput");

    function formatNumberDE(value) {
      const number = Number(value.toString().replace(/\./g, '').replace(',', '.'));
      if (isNaN(number)) return '00,00';

      return number.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    pnlInput.addEventListener('focus', () => {
      if (pnlInput.value === '00,00') {
        pnlInput.value = '';
      }
    });

    pnlInput.addEventListener('blur', () => {
      pnlInput.value = formatNumberDE(pnlInput.value);
    });
  });


  </script>
  
<script>
function calculatePositionSize() {
  const accountSize = parseFloat(document.getElementById("accountSize").value);
  const riskPercent = parseFloat(document.getElementById("riskPercent").value);
  const stopLossPips = parseFloat(document.getElementById("stopLossPips").value);
  const pipValue = parseFloat(document.getElementById("pipValue").value);

  const resultEl = document.getElementById("positionSizeResult");

  if (isNaN(accountSize) || isNaN(riskPercent) || isNaN(stopLossPips) || isNaN(pipValue) ||
      accountSize <= 0 || riskPercent <= 0 || stopLossPips <= 0 || pipValue <= 0) {
    resultEl.innerHTML = "‚ùå Bitte alle Felder korrekt ausf√ºllen!";
    resultEl.style.color = "#f44";
    return;
  }

  const riskAmount = accountSize * (riskPercent / 100);
  const positionSize = riskAmount / (stopLossPips * pipValue);
  resultEl.innerHTML = `‚úÖ Max. Lotgr√∂√üe: <strong>${positionSize.toFixed(2)}</strong> Lots`;
  resultEl.style.color = "#0f0";
}

function toggleInfoBox() {
  const box = document.getElementById("posInfoBox");
  box.style.display = box.style.display === "none" ? "block" : "none";
}

function calculateLotFromFixed() {
  const riskEuro = parseFloat(document.getElementById("lotFixedRisk").value);
  const sl = parseFloat(document.getElementById("lotSL").value);
  const pipVal = parseFloat(document.getElementById("lotPipValue").value);
  const out = document.getElementById("lotResult");

  if (isNaN(riskEuro) || isNaN(sl) || isNaN(pipVal) ||
      riskEuro <= 0 || sl <= 0 || pipVal <= 0) {
    out.innerHTML = "‚ùå Bitte alle Felder korrekt ausf√ºllen!";
    out.style.color = "#f44";
    return;
  }

  const lotSize = riskEuro / (sl * pipVal);

  out.innerHTML = `‚úÖ Empfohlene Lotgr√∂√üe: <strong>${lotSize.toFixed(2)}</strong> Lots`;
  out.style.color = "#0f0";
}

function toggleLotInfo() {
  const box = document.getElementById("lotInfoBox");
  box.style.display = box.style.display === "none" ? "block" : "none";
}


function togglePipMode() {
  const pipField = document.getElementById("riskPipValue");
  const tvNote = document.getElementById("tvNote");
  const checkbox = document.getElementById("useTradingView");

  if (checkbox.checked) {
    pipField.disabled = true;
    pipField.style.background = "#333";
    tvNote.style.display = "block";
  } else {
    pipField.disabled = false;
    pipField.style.background = "";
    tvNote.style.display = "none";
  }
}
function calculateRiskPercent() {
  const account = parseFloat(document.getElementById("riskAccountSize").value);
  const lot = parseFloat(document.getElementById("riskLotSize").value);
  const sl = parseFloat(document.getElementById("riskStopLoss").value);
  const useTV = document.getElementById("useTradingView").checked;
  const output = document.getElementById("riskResult");

  let pipVal = useTV ? 6.3 : parseFloat(document.getElementById("riskPipValue").value);

  if (
    isNaN(account) || isNaN(lot) || isNaN(sl) ||
    account <= 0 || lot <= 0 || sl <= 0 || isNaN(pipVal) || pipVal <= 0
  ) {
    output.innerHTML = "‚ùå Bitte alle Felder korrekt ausf√ºllen!";
    output.style.color = "#f44";
    return;
  }

  const riskEuro = lot * sl * pipVal;
  const riskPercent = (riskEuro / account) * 100;

  output.innerHTML = `‚ö†Ô∏è Du riskierst <strong>${riskEuro.toFixed(2)} ‚Ç¨</strong>  
                      (${riskPercent.toFixed(2)}‚ÄØ% deines Kontos)`;
  output.style.color = riskPercent <= 2 ? "#0f0" : (riskPercent <= 5 ? "#ffaa00" : "#f44");
}


function toggleRiskInfo() {
  const box = document.getElementById("riskInfoBox");
  box.style.display = box.style.display === "none" ? "block" : "none";
}

function calculateBreakeven() {
  const entry = parseFloat(document.getElementById("entryPrice").value);
  const spread = parseFloat(document.getElementById("spreadPips").value);
  const fees = parseFloat(document.getElementById("fees").value);
  const lot = parseFloat(document.getElementById("beLotSize").value);
  const pipVal = parseFloat(document.getElementById("bePipValue").value);
  const output = document.getElementById("breakevenResult");

  if (isNaN(entry) || isNaN(spread) || isNaN(fees) || isNaN(lot) || isNaN(pipVal) ||
      entry <= 0 || spread < 0 || fees < 0 || lot <= 0 || pipVal <= 0) {
    output.innerHTML = "‚ùå Bitte alle Felder korrekt ausf√ºllen!";
    output.style.color = "#f44";
    return;
  }

  const spreadValue = spread;
  const feeInPips = fees / (lot * pipVal);
  const totalPips = spreadValue + feeInPips;
  const pipSize = 0.0001; // F√ºr Forex (z.‚ÄØB. EUR/USD), ggf. anpassbar
  const breakEvenPrice = entry + (totalPips * pipSize);

  output.innerHTML = `üìç Break-even liegt bei <strong>${breakEvenPrice.toFixed(5)}</strong>`;
  output.style.color = "#0ff";
}

function toggleBreakevenInfo() {
  const box = document.getElementById("breakevenInfoBox");
  box.style.display = box.style.display === "none" ? "block" : "none";
}

const pipValues = {
  "AUD/CAD": 7.94, "AUD/JPY": 9.17, "AUD/USD": 10,
  "CHF/JPY": 9.17, "EUR/AUD": 10, "EUR/CAD": 10,
  "EUR/GBP": 10, "EUR/JPY": 9.17, "EUR/USD": 10,
  "GBP/AUD": 10, "GBP/JPY": 9.17, "GBP/USD": 10,
  "NZD/JPY": 9.17, "NZD/USD": 10,
  "USD/CAD": 7.94, "USD/CHF": 9.26, "USD/JPY": 9.17,
  "XAG/USD": 50, "XAU/USD": 100
};

function initPipPairSelect() {
  const select = document.getElementById("pairSelect");
  select.innerHTML = "";

  Object.keys(pipValues).forEach(pair => {
    const option = document.createElement("option");
    option.value = pair;
    option.textContent = pair;
    select.appendChild(option);
  });
}

function calculatePipValue() {
  const pair = document.getElementById("pairSelect").value;
  const result = document.getElementById("pipResult");

  if (!pair) {
    result.innerHTML = "‚ùå Bitte g√ºltiges W√§hrungspaar w√§hlen!";
    result.style.color = "#f44";
    return;
  }

  const pipPerLot = pipValues[pair] || 10;

  result.innerHTML = `üìç Der Pip-Wert bei <strong>${pair}</strong> betr√§gt pro 1 Lot: <strong>${pipPerLot.toFixed(2)} ‚Ç¨</strong>`;
  result.style.color = "#0f0";
}


function togglePipInfo() {
  const box = document.getElementById("pipInfoBox");
  box.style.display = box.style.display === "none" ? "block" : "none";
}

function toggleLeverageMode() {
  const mode = document.getElementById("leverageMode").value;
  document.getElementById("capitalMode").style.display = mode === "capital" ? "block" : "none";
  document.getElementById("lotCheckMode").style.display = mode === "lotcheck" ? "block" : "none";
  document.getElementById("leverageResult").innerHTML = "";
}

function calculateLeverage() {
  const mode = document.getElementById("leverageMode").value;
  const resultEl = document.getElementById("leverageResult");

  if (mode === "capital") {
    const capital = parseFloat(document.getElementById("leverageInput1").value);
    const lots = parseFloat(document.getElementById("leverageInput2").value);
    const leverage = parseFloat(document.getElementById("leverageInput3").value);

    if (isNaN(capital) || isNaN(lots) || isNaN(leverage) || capital <= 0 || lots <= 0 || leverage <= 0) {
      resultEl.innerHTML = "‚ùå Bitte alles korrekt eingeben!";
      resultEl.style.color = "#f44";
      return;
    }

    const ben√∂tigtesKapital = (lots * 100000) / leverage;
    resultEl.innerHTML = `üì¶ Du brauchst <strong>${ben√∂tigtesKapital.toFixed(2)} ‚Ç¨</strong> Kapital f√ºr ${lots} Lot bei ${leverage}x Hebel`;
    resultEl.style.color = "#0f0";

  } else if (mode === "lotcheck") {
    const capital = parseFloat(document.getElementById("lotCapital").value);
    const leverage = parseFloat(document.getElementById("lotLeverage").value);
    const pair = document.getElementById("lotPair")?.value || "default";

    if (isNaN(capital) || isNaN(leverage) || capital <= 0 || leverage <= 0) {
      resultEl.innerHTML = "‚ùå Bitte Kapital und Hebel korrekt eingeben!";
      resultEl.style.color = "#f44";
      return;
    }

let basis;
switch (pair) {
  // Metalle
 case "XAU/USD": basis = 200000; break;
case "XAG/USD": basis = 125000; break;

  // Krypto
  case "BTC/USD": basis = 30000; break;
  case "ETH/USD": basis = 1800; break;

  // Indizes
  case "US30":    basis = 10; break;
  case "NAS100":  basis = 20; break;
  case "SPX500":  basis = 10; break;
  case "GER40":   basis = 25; break;
  case "UK100":   basis = 10; break;

  // Forex mit typischer 100k Kontraktgr√∂√üe
  case "EUR/USD":
  case "GBP/USD":
  case "AUD/USD":
  case "NZD/USD":
  case "USD/CAD":
  case "USD/CHF":
    basis = 100000; break;

  // Forex mit leicht abweichendem Pip-Wert / Standard je nach Broker
  case "USD/JPY":
  case "EUR/JPY":
  case "GBP/JPY":
  case "CHF/JPY":
  case "AUD/JPY":
  case "CAD/JPY":
    basis = 100000; break; // Optional auf 1.000.000 JPY setzen, je nach Broker

  // Cross-Paare (ohne USD direkt)
  case "EUR/GBP":
  case "EUR/AUD":
  case "EUR/CAD":
  case "GBP/AUD":
  case "GBP/CAD":
    basis = 100000; break;

  default:
    basis = 100000; break; // Fallback f√ºr unbekannte Paare
}
   

    const maxLots = (capital * leverage) / basis;
    let output = `üí∞ <strong>Max. Lotgr√∂√üe (${pair}):</strong> ${maxLots.toFixed(2)} Lot<br><br>üìä <strong>St√ºckelung:</strong><br>`;

    const lotSizes = [1.00, 0.80, 0.50, 0.40, 0.20, 0.10, 0.01];
    lotSizes.forEach(size => {
      const times = Math.floor(maxLots / size);
      output += `‚ñ∏ ${size.toFixed(2)} Lot = ${times > 0 ? times + "x" : "‚ùå nicht m√∂glich"}<br>`;
    });

    resultEl.innerHTML = output;
    resultEl.style.color = "#0f0";
  }
}






function switchCalcTab(tab) {
  // Alle Rechner ausblenden
  document.querySelectorAll(".calc-box").forEach(box => {
    box.style.display = "none";
  });

  // Den gew√ºnschten Rechner einblenden
  const target = document.getElementById("calc-" + tab);
  if (target) target.style.display = "block";

  // Alle Buttons zur√ºcksetzen
  document.querySelectorAll(".tab-buttons .btn").forEach(btn => btn.classList.remove("active"));

  // Den aktiven Button markieren
  const btn = document.getElementById("btn-calc-" + tab);
  if (btn) btn.classList.add("active");
}

window.addEventListener("DOMContentLoaded", () => {
  initPipPairSelect();
});

</script>
  
<script>
const sessionText = document.getElementById("sessionText");
const sessionProgressEl = document.getElementById("sessionProgressDisplay");
const sessionInfoEl = document.getElementById("sessionInfo");
const sessionDetailsBox = document.getElementById("sessionDetailsBox");
const alertBox = document.getElementById("alertBox");
const progressBar = document.getElementById("progressBar");
const progressContainer = document.querySelector(".progress-container");

sessionText.addEventListener("click", () => {
  sessionDetailsBox.style.display = sessionDetailsBox.style.display === "block" ? "none" : "block";
});

function formatHM(mins) {
  const h = Math.floor(mins / 60) % 24;
  const m = mins % 60;
  return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
}

const sessionColors = {
  Sydney: "#3388ff",
  Tokyo: "#00aaff",
  London: "#ffd700",
  "New York": "#ff4500",
  "London Killzone": "#ccff00",
  "New York Killzone": "#ff8800",
  Deadzone: "#333",
};

const sessions = [
  {
    name: "Sydney",
    start: 1380,
    end: 480,
    info: "Ruhiger Markt, geringere Liquidit√§t, Vorbereitung auf Asien.",
    weekDaysInfo: [
      { day: "Sonntag", text: "üõ†Ô∏è Vorbereitung auf neue Woche" },
      { day: "Montag", text: "üåè Asien-Session startet" },
      { day: "Mittwoch", text: "üìä Wirtschaftsdaten Australien" },
      { day: "Freitag", text: "üìÖ W√∂chentliche Analyse & Planung" }
    ],
  },
  {
    name: "Tokyo",
    start: 60,
    end: 600,
    info: "Moderate Volatilit√§t, Fokus auf JPY/AUD/NZD, Breakouts m√∂glich.",
    weekDaysInfo: [
      { day: "Dienstag", text: "üè¶ BoJ Pressekonferenz" },
      { day: "Donnerstag", text: "üìà Japan BIP-Daten" },
      { day: "Freitag", text: "üá∫üá∏ US NFP wirkt oft nach" }
    ],
  },
  {
    name: "London",
    start: 540,
    end: 1020,
    info: "Hohe Liquidit√§t, starke Bewegungen, europ√§ische Wirtschaftsdaten.",
    weekDaysInfo: [
      { day: "Montag", text: "üìâ EU Handelsdaten" },
      { day: "Dienstag", text: "üèõÔ∏è Zinsentscheidungen der EZB" },
      { day: "Donnerstag", text: "üìä Inflationsdaten UK" },
      { day: "Freitag", text: "üìÖ Arbeitsmarktdaten UK" }
    ],
  },
  {
    name: "New York",
    start: 870,
    end: 1380,
    info: "Hohe Volatilit√§t, US-Daten dominieren, Trendfortsetzungen m√∂glich.",
    weekDaysInfo: [
      { day: "Mittwoch", text: "üè¶ Fed Zinsentscheidungen" },
      { day: "Freitag", text: "üìä US NFP Arbeitsmarktdaten" },
      { day: "Freitag", text: "üìà W√∂chentliche Arbeitslosenmeldung" }
    ],
  },
  {
    name: "London Killzone",
    start: 420,
    end: 660,
    info: "Volatile Phase vor London-Open, Stop-Hunts m√∂glich.",
    weekDaysInfo: [
      { day: "Montag", text: "‚ö° Hohe Volatilit√§t durch Markt√∂ffnung" },
      { day: "Mittwoch", text: "üî• Breakouts oft m√∂glich" }
    ],
  },
  {
    name: "New York Killzone",
    start: 810,
    end: 1020,
    info: "Start der NY Session, hohe Aktivit√§t, gute Chancen f√ºr Daytrader.",
    weekDaysInfo: [
      { day: "Dienstag", text: "‚ö° Erh√∂hte Volatilit√§t durch US-Daten" },
      { day: "Donnerstag", text: "üéôÔ∏è Fed Reden & Daten" }
    ],
  },
  {
    name: "Deadzone",
    start: 1380,
    end: 0,
    info: "Niedrige Volatilit√§t, Seitw√§rtsbewegungen, Ruhephase.",
    weekDaysInfo: [
      { day: "T√§glich", text: "üò¥ Markt ruhig, kaum Bewegung" }
    ],
  }
];


let lastAlertSession = null;

function getMinutesNow() {
  const now = new Date();
  return now.getHours() * 60 + now.getMinutes();
}

function getCurrentSessions(minNow) {
  return sessions.filter((s) => {
    const start = s.start;
    const end = s.end;
    if (start > end) {
      return minNow >= start || minNow < end;
    } else {
      return minNow >= start && minNow < end;
    }
  });
}

function updateGradientBar(colors) {
  if (colors.length === 0) {
    progressBar.style.background = "#444";
    progressBar.style.backgroundImage = "";
    return;
  }
  const svg = `
    <svg xmlns='http://www.w3.org/2000/svg' width='100%' height='100%'>
      <defs>
        <linearGradient id='g' x1='0%' y1='0%' x2='100%' y2='0%'>
          ${colors.map((c, i) => `<stop offset='${(i / (colors.length - 1)) * 100}%' stop-color='${c}'/>`).join("")}
        </linearGradient>
      </defs>
      <rect x='0' y='0' width='100%' height='100%' fill='url(#g)'/>
    </svg>`;
  const base64 = btoa(svg);
  progressBar.style.backgroundImage = `url("data:image/svg+xml;base64,${base64}")`;
}

function hexToRgba(hex, alpha) {
  hex = hex.replace("#", "");
  const r = parseInt(hex.substring(0, 2), 16);
  const g = parseInt(hex.substring(2, 4), 16);
  const b = parseInt(hex.substring(4, 6), 16);
  return `rgba(${r},${g},${b},${alpha})`;
}

function getMinutesToNextSession(minNow) {
  const futureStarts = sessions.map((s) => s.start).filter((start) => start > minNow);
  if (futureStarts.length === 0) return sessions[0].start + 1440 - minNow;
  return Math.min(...futureStarts) - minNow;
}

const alertSound = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');

function requestNotificationPermission() {
  if ("Notification" in window && Notification.permission !== "granted") {
    Notification.requestPermission();
  }
}

function showNotification(title, message) {
  if ("Notification" in window && Notification.permission === "granted") {
    const options = {
      body: message,
      icon: 'https://cdn-icons-png.flaticon.com/512/1827/1827409.png',
      vibrate: [200, 100, 200],
      tag: "session-alert"
    };
    const notification = new Notification(title, options);
    notification.onclick = () => {
      window.focus();
      notification.close();
    };
  }
}

// üîî Rausgezogen ‚Äì au√üerhalb der Funktion definieren!
function showSessionStartNotification(sessionName, message) {
  if ("Notification" in window && Notification.permission === "granted") {
    const options = {
      body: message,
      icon: 'https://cdn-icons-png.flaticon.com/512/1827/1827409.png',
      vibrate: [100, 50, 100],
      tag: sessionName + "-start",
      renotify: false
    };
    new Notification(`üì£ ${sessionName}-Session gestartet!`, options);
  }
}

function showAlert(msg) {
  const el = document.createElement("div");
  el.className = "alert-message";
  el.textContent = msg;
  alertBox.innerHTML = "";
  alertBox.appendChild(el);
  setTimeout(() => (alertBox.innerHTML = ""), 5000);
  alertSound.play();
  showNotification("Trade App Alarm", msg);
}

function showSessionProgress(activeSessions, currentMinutes) {
  if (activeSessions.length === 0) {
    sessionProgressEl.innerHTML = "‚è≥ Keine aktive Session ‚Äì kein Countdown";
    return;
  }
  const current = activeSessions[0];
  let start = current.start;
  let end = current.end;
  if (start > end) end += 1440;
  let nowMins = currentMinutes;
  if (nowMins < start) nowMins += 1440;
  const duration = end - start;
  const progressMins = nowMins - start;
  const percent = (progressMins / duration) * 100;
  const timeLeft = end - nowMins;
  sessionProgressEl.innerHTML = `‚è±Ô∏è Noch <strong>${formatHM(timeLeft)}</strong> ‚Äì <strong>${percent.toFixed(0)}%</strong> vorbei`;
}

function updateRealTimeBar() {
  const now = new Date();
  const weekday = now.getDay(); // Sonntag = 0, Samstag = 6
  const hours = String(now.getHours()).padStart(2, "0");
  const mins = String(now.getMinutes()).padStart(2, "0");

  // üëâ Wochenende
  if (weekday === 0 || weekday === 6) {
    sessionText.textContent = `üïí Aktuelle Uhrzeit: ${hours}:${mins} ‚Äì Wochenende`;
    progressBar.style.width = "0%";
    progressBar.style.background = "#333";
    progressBar.style.backgroundImage = "";
    progressContainer.style.boxShadow = "0 0 12px 6px rgba(0,0,0,0)";
    sessionInfoEl.textContent = "üì¥ Wochenende ‚Äì Markt ist geschlossen.";
    sessionProgressEl.innerHTML = "‚õî Kein Handel ‚Äì Wochenende";
    sessionDetailsBox.innerHTML = "Keine Session-Daten am Wochenende.";
    return;
  }

// ‚è¨ Ab hier normaler Werktags-Ablauf
const minutes = now.getHours() * 60 + now.getMinutes();
const percent = (minutes / 1439) * 100;

const activeSessions = getCurrentSessions(minutes);
const names = activeSessions.map(s => s.name);
const activeNames = names.length > 0 ? `| Aktive Session: ${names.join(" + ")}` : "| Keine Session aktiv";
sessionText.textContent = `üïí ${hours}:${mins} ${activeNames}`;

progressBar.style.width = `${percent}%`;

const colors = names.map(n => sessionColors[n] || "#666");


  const name = activeSessions.length > 0 ? activeSessions[0].name : "";
  let infoText = "Keine aktiven Sessions ‚Äì Markt wahrscheinlich ruhig.";
  
   updateGradientBar(colors);
   showSessionProgress(activeSessions, minutes); // ‚úÖ HIER rein

  if (colors.length > 0) {
    progressContainer.style.boxShadow = `0 0 12px 6px ${hexToRgba(colors[0], 0.6)}`;
  } else {
    progressContainer.style.boxShadow = "0 0 12px 6px rgba(0,0,0,0)";
  }

  if (name === "Tokyo") {
    infoText = minutes < 180 ? "üåè Tokyo er√∂ffnet ‚Äì erste Bewegungen durch asiatische H√§ndler." :
                minutes < 360 ? "üáØüáµ Asiatische Volatilit√§t aktiv ‚Äì m√∂gliche Bewegungen bei JPY." :
                "üõë Tokyo flacht ab ‚Äì Fokus wechselt langsam nach Europa.";
  } else if (name === "London Killzone") {
    infoText = "‚ö†Ô∏è London Killzone ‚Äì hohe Volatilit√§t & starke Bewegungen m√∂glich.";
  } else if (name === "London") {
    infoText = minutes < 720 ? "üí∑ London Session ‚Äì Markt in Bewegung, europ√§ische Daten entscheidend." :
                minutes < 840 ? "üò¥ Mittagliche Deadzone ‚Äì Markt konsolidiert h√§ufig, Vorsicht bei Entries." :
                "üìà London-Teilnehmer bleiben aktiv ‚Äì Vorbereitung auf NY.";
  } else if (name === "New York Killzone") {
    infoText = "üî• New York Killzone ‚Äì starke Reaktionen auf US-News & Breakouts m√∂glich.";
  } else if (name === "New York") {
    infoText = minutes < 1080 ? "üá∫üá∏ New York Session ‚Äì starker US-Einfluss, Trendfortsetzungen m√∂glich." :
                minutes < 1200 ? "üìâ New York flacht ab ‚Äì Markt beruhigt sich langsam." :
                "üåÉ New York Session endet ‚Äì geringe Bewegung, Vorsicht bei Entries.";
  } else if (minutes >= 720 && minutes < 840) {
    infoText = "üò¥ Mittagliche Deadzone ‚Äì Markt konsolidiert h√§ufig, Vorsicht bei Entries.";
  } else if (minutes >= 1380 || minutes < 60) {
    infoText = "üåô Nacht-Deadzone ‚Äì Markt ist extrem ruhig, keine relevanten Bewegungen.";
  }

  sessionInfoEl.textContent = infoText;

  if (activeSessions.length > 0) {
    const s = activeSessions[0];
    let weekDaysHtml = "";
    if (s.weekDaysInfo) {
      weekDaysHtml = "<br><strong>üìÖ Wichtige Tage:</strong><ul style='margin-left:18px;'>";
      s.weekDaysInfo.forEach(({ day, text }) => {
        weekDaysHtml += `<li><strong>${day}:</strong> ${text}</li>`;
      });
      weekDaysHtml += "</ul>";
    }
    sessionDetailsBox.innerHTML = `
      <strong>üü° ${s.name} Session</strong><br>
      üìÖ Start: ${formatHM(s.start)} Uhr<br>
      üïì Ende: ${formatHM(s.end)} Uhr<br>
      ‚ÑπÔ∏è ${s.info}
      ${weekDaysHtml}
    `;
  } else {
    sessionDetailsBox.innerHTML = "Keine aktive Session ‚Äì Markt ist ruhig.";
  }

  const minutesToNext = getMinutesToNextSession(minutes);
  if (minutesToNext <= 5 && minutesToNext > 0) {
    const currentActive = sessionText.textContent;
    if (lastAlertSession !== currentActive) {
      showAlert(`‚ö†Ô∏è Session-Wechsel in 5 Minuten!`);
      lastAlertSession = currentActive;

      if (activeSessions.length > 0) {
  const s = activeSessions[0];

  const customMessages = {
    "Tokyo": "üåè Tokyo ge√∂ffnet ‚Äì Fokus auf JPY & Breakouts m√∂glich.",
    "London Killzone": "‚öîÔ∏è London Killzone aktiv ‚Äì erh√∂hte Volatilit√§t und Liquidit√§tssuche.",
    "London": "üí∑ London Session startet ‚Äì EU-Daten & starke Marktbewegungen erwartet.",
    "New York Killzone": "üî• NY Killzone l√§uft ‚Äì US-News und Breakouts stehen an.",
    "New York": "üá∫üá∏ New York Session beginnt ‚Äì Achtung auf Trendfortsetzungen.",
    "Deadzone": "üò¥ Deadzone ‚Äì niedrige Volatilit√§t, Markt bewegt sich kaum.",
    "Sydney": "üåô Sydney Session l√§uft ‚Äì Vorbereitung auf Asienmarkt beginnt."
  };

  const customText = customMessages[s.name] || s.info;
  showSessionStartNotification(s.name, customText);
}

    }
  } else {
    lastAlertSession = null;
  }
}




window.addEventListener("load", () => {
  requestNotificationPermission();
  updateRealTimeBar();
  setInterval(updateRealTimeBar, 60000);
});
</script>

<script>
// ‚úÖ Service Worker Registrierung
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker
      .register("sw.js")
      .then(reg => console.log("‚úÖ Service Worker registriert:", reg))
      .catch(err => console.error("‚ùå SW Registrierung fehlgeschlagen:", err));
  });
}

// ‚úÖ App-Install Trigger mit Button
let deferredPrompt = null;

window.addEventListener('beforeinstallprompt', (e) => {
  console.log("üü° beforeinstallprompt ausgel√∂st");
  e.preventDefault();
  deferredPrompt = e;
  showInstallButton();
});

function showInstallButton() {
  if (localStorage.getItem("installPromptHandled") === "true") return;
  if (document.getElementById("installBtn")) return;

  const installBtn = document.createElement("button");
  installBtn.id = "installBtn";
  installBtn.textContent = "üì≤ App installieren";
  installBtn.className = "big-btn";
  installBtn.style.position = "fixed";
  installBtn.style.bottom = "80px";
  installBtn.style.left = "50%";
  installBtn.style.transform = "translateX(-50%)";
  installBtn.style.zIndex = "9999";
  document.body.appendChild(installBtn);

  installBtn.addEventListener("click", () => {
    installBtn.remove();
    localStorage.setItem("installPromptHandled", "true"); // ‚úÖ Nur einmal fragen
    if (deferredPrompt) {
      deferredPrompt.prompt();
      deferredPrompt.userChoice.then((choiceResult) => {
        console.log("üì• Installationswahl:", choiceResult.outcome);
        deferredPrompt = null;
      });
    }
  });
}

// üïí Fallback-Check nach 3 Sekunden, ob der Button angezeigt werden kann
setTimeout(() => {
  if (deferredPrompt) {
    showInstallButton();
  } else {
    console.log("‚ùå Kein Install-Event verf√ºgbar");
  }
}, 3000);
</script>




<script>

const ctraderClientId = "15634_88Uy92WLJTI32Y4G6mz5Mn3WG0AFUGB5WPhKtp4XUrWlgpvSzp";
const ctraderRedirectUri = "https://ro486666.github.io/callback.html"; // ‚úÖ RICHTIG


function startCtraderLogin() {
  const authUrl = `https://connect.spotware.com/apps/oauth/authorize?client_id=15634_88Uy92WLJTI32Y4G6mz5Mn3WG0AFUGB5WPhKtp4XUrWlgpvSzp&redirect_uri=https://ro486666.github.io/callback.html&response_type=code&scope=accounts`;


  window.location.href = authUrl;
}
</script>



<script>
async function exchangeCodeForToken() {
  const code = localStorage.getItem("ctraderCode");
  if (!code) {
    alert("‚ùå Kein Code vorhanden. Bitte erst √ºber Spotware einloggen.");
    return;
  }

  try {
    const res = await fetch("http://localhost:3000/token", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ code })
    });

    const data = await res.json();
    if (data.access_token) {
      localStorage.setItem("ctraderToken", data.access_token);
      alert("‚úÖ Token gespeichert: Zugriff bereit!");
    } else {
      console.error(data);
      alert("‚ùå Fehler beim Token-Tausch");
    }
  } catch (err) {
    alert("‚ö†Ô∏è Netzwerkfehler beim Token-Tausch");
    console.error(err);
  }
}

async function getAccounts() {
  const token = localStorage.getItem("ctraderToken");
  if (!token) return alert("‚ùå Kein Token verf√ºgbar");

  try {
    const res = await fetch(`http://localhost:3000/accounts?access_token=${token}`);
    const data = await res.json();
    console.log("üìä Konten:", data);
  } catch (err) {
    console.error("Fehler beim Laden der Konten:", err);
  }
}

async function getPositions(accountId) {
  const token = localStorage.getItem("ctraderToken");
  if (!token) return alert("‚ùå Kein Token verf√ºgbar");

  try {
    const res = await fetch(`http://localhost:3000/positions?access_token=${token}&account_id=${accountId}`);
    const data = await res.json();
    console.log("üìÇ Positionen:", data);
  } catch (err) {
    console.error("Fehler beim Laden der Positionen:", err);
  }
}
</script>



</script>

<button onclick="showSessionStartNotification('Test', 'üì≤ Notification funktioniert!')" style="
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #00aa44;
  color: white;
  padding: 12px 18px;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: bold;
  z-index: 9999;
  box-shadow: 0 0 10px #00aa44;
">
üîî Test Push
</button>
</body>
</html>
