<!DOCTYPE html>
<html lang="de">
<head>
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#00aa44" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trade App Layout</title>
  <style>
    body {
      background: #111;
      color: white;
      font-family: sans-serif;
      margin: 0;
      padding: 0;
    }
    .header {
      background: #1c1c1c;
      padding: 10px;
      text-align: center;
      font-size: 18px;
    }
    .session-bar {
      height: 10px;
      background: linear-gradient(to right, #00aaff, #ffaa00, #ff3300);
      margin-top: 5px;
    }
    .main {
      padding: 20px;
      padding-bottom: 120px; /* Platz f√ºr Positionsleiste */
      text-align: center;
    }
    .big-btn {
      padding: 20px 30px;
      font-size: 22px;
      font-weight: bold;
      border-radius: 15px;
      border: none;
      background-color: #00aa44;
      color: white;
      margin: 20px auto;
      width: 80%;
      max-width: 300px;
    }
    .tab-buttons {
      text-align: center;
      margin-top: 20px;
    }
    .tab-buttons button {
      background: #333;
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      margin: 5px;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }
    .tab-buttons .active {
      background: #0077cc;
    }
    .stats-box {
      background: #222;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      text-align: left;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
    #resetBtn {
      background: #cc3333;
      color: white;
      padding: 12px;
      border: none;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
      font-weight: bold;
      margin: 20px auto 30px auto;
      cursor: pointer;
      display: block;
      user-select: none;
      position: relative; /* kein fixed */
      z-index: auto;
    }
    .position-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #1c1c1c;
      padding: 10px;
      display: flex;
      gap: 10px;
      overflow-x: auto;
      box-sizing: border-box;
      z-index: 10000; /* √ºber anderen Elementen */
	  touch-action: pan-y; /* Erlaubt vertikales Scrollen, verhindert horizontale Interferenzen */
    }
    .trade-box {
      flex: 0 0 auto;
      box-sizing: border-box;
      width: 85%;
      max-width: 280px;
      background: #333;
      padding: 10px;
      border-radius: 10px;
      min-width: 180px;
      color: white;
      user-select: none;
      z-index: 10001; /* √ºber reset Button */
	   touch-action: none; /* Damit alle Touch-Events an JS gehen */
      position: relative;
    }
    .trade-box.Long {
      background-color: #228B22; /* gr√ºn */
    }
    .trade-box.Short {
      background-color: #B22222; /* rot */
    }
    .result-value {
      margin-top: 5px;
      font-weight: bold;
    }
    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      padding: 20px;
      border-radius: 10px;
      display: none;
      z-index: 1000;
      width: 90%;
      max-width: 300px;
      color: white;
    }
    label {
      cursor: pointer;
      user-select: none;
      margin-right: 15px;
      display: inline-block;
    }
    #pairMultiSelect {
      max-height: 150px;
      overflow-y: auto;
      background: #222;
      padding: 5px;
      border-radius: 6px;
      color: white;
      margin-bottom: 10px;
      text-align: left;
    }
    select, input {
      padding: 8px;
      margin-top: 10px;
      width: 100%;
      border-radius: 5px;
      border: none;
      font-size: 16px;
    }
    .popup button {
      margin-top: 10px;
      padding: 10px;
      width: 100%;
      font-size: 16px;
      cursor: pointer;
    }
    .ticker {
      width: 100%;
      background: #222;
      color: #00ff99;
      padding: 10px;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      font-family: Arial, sans-serif;
      user-select: none;
    }
    .session-info {
      margin-top: 5px;
      font-size: 14px;
      color: #aaf0aa;
      text-align: center;
      font-style: italic;
      user-select: none;
    }
	
.session-details-box {
  display: none;
  background: #1a1a1a;
  padding: 15px;
  margin: 10px 20px;
  border-radius: 10px;
  font-size: 14px;
  color: #eee;
  text-align: left;
  box-shadow: 0 0 10px rgba(0,0,0,0.4);
}


  .session-details-box {
    font-size: 13px;
    margin: 10px;
    padding: 12px;
    line-height: 1.4;
  }

  .session-header, #sessionText {
    font-size: 16px;
    padding: 12px;
  }
  
  #sessionText {
  user-select: none;
  cursor: pointer;
}
    .progress-container {
      position: relative;
      background: #111;
      height: 24px;
      width: 100%;
      border-top: 1px solid #333;
      border-bottom: 1px solid #333;
      overflow: hidden;
      border-radius: 6px;
      margin-top: 5px;
    }
    .progress-bar {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 0%; /* wird per JS gesetzt */
      background: linear-gradient(to right, #00aaff, #ffaa00, #ff3300);
      transition: width 1s linear;
      background-size: 100% 100%;
      background-repeat: no-repeat;
      z-index: 2;
    }
	
	.session-details-box ul {
  padding-left: 20px;
  margin-top: 8px;
  margin-bottom: 8px;
  list-style-type: disc;
}

.session-details-box li {
  margin-bottom: 4px;
}
	
	
  </style>
</head>
<body>

<div class="ticker" id="sessionText">Session-Zeit: 00:00</div>
<div class="session-info" id="sessionInfo">Tipps und Infos zur Session erscheinen hier...</div>
<div class="progress-container">
  <div class="progress-bar" id="progressBar"></div>
</div>
<div class="session-details-box" id="sessionDetailsBox"></div>
<div class="alert-below-header" id="alertBox"></div>

<div class="main">
  <button class="big-btn" onclick="showPopup()">+ Trade starten</button>

  <div class="tab-buttons">
    <button class="btn active" onclick="switchTab('tag')">Tag</button>
    <button class="btn" onclick="switchTab('woche')">Woche</button>
    <button class="btn" onclick="switchTab('monat')">Monat</button>
  </div>

  <div class="stats-box" id="tagBox">
    <h3>üìÖ Tagesauswertung</h3>
    <p>Gewinne: 0 | Verluste: 0</p>
    <p>Gesamt PnL: 0 ‚Ç¨</p>
    <p>Profitfaktor: ‚Äì</p>
    <p>Durchschnitt Gewinn/Verlust: ‚Äì</p>
  </div>

  <div class="stats-box" id="wocheBox" style="display:none">
    <h3>üìà Wochenauswertung</h3>
    <p>Gewinne: 0 | Verluste: 0</p>
    <p>Gesamt PnL: 0 ‚Ç¨</p>
    <p>Profitfaktor: ‚Äì</p>
    <p>Durchschnitt Gewinn/Verlust: ‚Äì</p>
  </div>

  <div class="stats-box" id="monatBox" style="display:none">
    <h3>üìä Monatsauswertung</h3>
    <p>Gewinne: 0 | Verluste: 0</p>
    <p>Gesamt PnL: 0 ‚Ç¨</p>
    <p>Profitfaktor: ‚Äì</p>
    <p>Durchschnitt Gewinn/Verlust: ‚Äì</p>
  </div>

<div id="resetPopup" class="popup" style="display: none;">
  <h3>Was m√∂chtest du zur√ºcksetzen?</h3>
  <button id="resetDay">üìÖ Tag zur√ºcksetzen</button>
  <button id="resetWeek">üìà Woche zur√ºcksetzen</button>
  <button id="resetMonth">üìä Monat zur√ºcksetzen</button>
  <button id="resetAllBtn" style="background: crimson;">Alles l√∂schen</button>
  <button id="cancelReset" style="background:#555;">Abbrechen</button>
</div>
 <button id="resetBtn">Alles zur√ºcksetzen</button>
  

</div>

<div class="popup" id="tradePopup">
  <h3>Trade eingeben</h3>

  <label>Paare ausw√§hlen (mehrere m√∂glich):</label><br>
  <div id="pairMultiSelect"></div>

  <label for="directionSelect">Richtung w√§hlen:</label>
  <select id="directionSelect" style="width: 100%; margin-top: 5px;">
    <option value="">Bitte w√§hlen</option>
    <option value="Long">Long</option>
    <option value="Short">Short</option>
  </select>

  <button onclick="addTrades()">Trades speichern</button>
   <button onclick="hidePopups()" style="margin-top:10px; background:#555;">Abbrechen</button>
</div>

<div class="popup" id="resultPopup">
  <h3>Ergebnis</h3>
  <input type="number" inputmode="decimal" id="pnlInput" placeholder="z.‚ÄØB. 120.50" />
  <button onclick="saveResult()">Speichern</button>
</div>

<div class="position-bar" id="positionBar"></div>

<script>
  const pairs = [
    "AUD/CAD",
    "AUD/JPY",
    "AUD/USD",
    "CHF/JPY",
    "EUR/AUD",
    "EUR/CAD",
    "EUR/GBP",
    "EUR/JPY",
    "EUR/USD",
    "GBP/AUD",
    "GBP/JPY",
    "GBP/USD",
    "NZD/JPY",
    "NZD/USD",
    "USD/CAD",
    "USD/CHF",
    "USD/JPY",
    "XAG/USD",
    "XAU/USD"
  ];

  function initMultiPairSelect() {
    const container = document.getElementById("pairMultiSelect");
    container.innerHTML = "";

    pairs.forEach(pair => {
      const label = document.createElement("label");
      label.style.marginRight = "15px";
      label.style.cursor = "pointer";
      label.style.userSelect = "none";

      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.value = pair;
      checkbox.checked = false;

      label.appendChild(checkbox);
      label.appendChild(document.createTextNode(" " + pair));
      container.appendChild(label);
    });
  }

  function addTrades() {
    const container = document.getElementById("pairMultiSelect");
    const checkboxes = container.querySelectorAll("input[type=checkbox]:checked");
    const direction = document.getElementById("directionSelect").value;

    if (!direction) {
      alert("Bitte w√§hle eine Richtung!");
      return;
    }
    if (checkboxes.length === 0) {
      alert("Bitte w√§hle mindestens ein Paar aus!");
      return;
    }

    checkboxes.forEach(box => {
      const pair = box.value;
      const now = new Date();
      const tradeObj = {
        id: Date.now() + Math.random(),
        pair: pair,
        direction: direction,
        date: now,
        pnl: null,
        resultType: null
      };
      tradesData.push(tradeObj);
      renderTradeBox(tradeObj);
    });

    saveTrades();
    hidePopups();
  }

  function resetAll() {
    if (!confirm("Willst du wirklich ALLE Trades und Statistiken l√∂schen?")) return;

    tradesData.length = 0;
    localStorage.removeItem("tradesData");
    document.getElementById("positionBar").innerHTML = "";
    updateStats();
  }

  function isSameDay(date1, date2) {
    return (
      date1.getDate() === date2.getDate() &&
      date1.getMonth() === date2.getMonth() &&
      date1.getFullYear() === date2.getFullYear()
    );
  }

  function isSameWeek(date1, date2) {
    const startOfWeek = new Date(date2);
    startOfWeek.setDate(date2.getDate() - date2.getDay());
    const endOfWeek = new Date(startOfWeek);
    endOfWeek.setDate(startOfWeek.getDate() + 6);
    return date1 >= startOfWeek && date1 <= endOfWeek;
  }

  function isSameMonth(date1, date2) {
    return date1.getMonth() === date2.getMonth() && date1.getFullYear() === date2.getFullYear();
  }

  const tradesData = [];
  let activeBox = null;
  let resultType = "win";

  function loadTrades() {
    const saved = localStorage.getItem("tradesData");
    if (saved) {
      const arr = JSON.parse(saved);
      tradesData.length = 0;
      document.getElementById("positionBar").innerHTML = "";
      arr.forEach((trade) => {
        trade.date = new Date(trade.date);
        tradesData.push(trade);
        if (trade.pnl === null) {
          renderTradeBox(trade);
        }
      });
    }
    updateStats();
  }

  function saveTrades() {
    localStorage.setItem("tradesData", JSON.stringify(tradesData));
  }

 function renderTradeBox(tradeObj) {
  const box = document.createElement("div");
  box.className = "trade-box " + tradeObj.direction;
  box.dataset.id = tradeObj.id;

  // Close (X) Button zum Entfernen oben rechts
  // Close (X) Button zum Entfernen oben rechts
  const closeBtn = document.createElement("button");
  closeBtn.type = "button"; // wichtig f√ºr mobile Browser
  closeBtn.textContent = "‚úñ"; // kleines X
  closeBtn.style.position = "absolute";
  closeBtn.style.top = "8px";
  closeBtn.style.right = "8px";
  closeBtn.style.background = "transparent";
  closeBtn.style.border = "none";
  closeBtn.style.color = "white";
  closeBtn.style.fontSize = "20px";
  closeBtn.style.cursor = "pointer";
  closeBtn.style.zIndex = "10"; // sicherstellen, dass oben
  closeBtn.title = "Trade entfernen";
  closeBtn.addEventListener("click", (e) => {
    e.stopPropagation(); // Verhindert, dass andere Events feuern
    removeTradeById(tradeObj.id);
  });
  box.style.position = "relative"; // damit closeBtn richtig positioniert ist
  box.appendChild(closeBtn);

  let resultText = "";
  if (tradeObj.pnl !== null) {
    resultText = `<div class="result-value">PnL: ${tradeObj.pnl.toFixed(2)} ‚Ç¨</div>`;
  } else {
    resultText = `
      <button onclick="markResult(this, 'win')">‚úÖ Erfolg</button>
      <button onclick="markResult(this, 'loss')">‚ùå Misserfolg</button>
      <div class="result-value"></div>
    `;
  }

  const contentDiv = document.createElement("div");
  contentDiv.innerHTML = `<strong>${tradeObj.pair}</strong><br>${tradeObj.direction}<br>${resultText}`;
  box.appendChild(contentDiv);

  // Robustere Swipe-Erkennung (f√ºr vertikales Swipen)
  let touchStartY = 0;
  let touchCurrentY = 0;
  let isSwiping = false;


  // Swipe-up f√ºr Handy (Touch-Event)
    box.addEventListener("touchmove", e => {
    touchCurrentY = e.touches[0].clientY;
    const diffY = touchStartY - touchCurrentY;

    if (diffY > 15) { // kleiner Swipe-Up Threshold
      if (!isSwiping) {
        isSwiping = true;
        e.preventDefault(); // verhindert Scrolle
        removeTradeById(tradeObj.id);
      }
    }
  }, { passive: false });

  box.addEventListener("touchend", () => {
    touchStartY = 0;
    touchCurrentY = 0;
    isSwiping = false;
  });

  document.getElementById("positionBar").appendChild(box);
}

function removeTradeById(id) {
  const index = tradesData.findIndex(t => t.id === id);
  if (index !== -1) {
    tradesData.splice(index, 1);
    saveTrades();
    loadTrades(); // neu rendern
  }
}
  function markResult(btn, type) {
    activeBox = btn.closest(".trade-box");
    resultType = type;
    document.getElementById("pnlInput").value = "";
    document.getElementById("resultPopup").style.display = "block";
  }

  function saveResult() {
    let pnlRaw = document.getElementById("pnlInput").value.replace(",", ".");
    if (pnlRaw === "") return;
    let pnl = parseFloat(pnlRaw);
    if (isNaN(pnl)) return;
    pnl = Math.abs(pnl);
    pnl = resultType === "loss" ? -pnl : pnl;

    const resultDiv = activeBox.querySelector(".result-value");
    resultDiv.innerText = `PnL: ${pnl.toFixed(2)} ‚Ç¨`;

    const tradeId = Number(activeBox.dataset.id);
    const trade = tradesData.find((t) => t.id === tradeId);
    if (trade) {
      trade.pnl = pnl;
      trade.resultType = resultType;
    }

    activeBox.remove();

    saveTrades();

    hidePopups();
    updateStats();
  }

  function updateStats() {
  const now = new Date();

  function calcStats(filterFn) {
    const filtered = tradesData.filter((t) => t.pnl !== null && filterFn(t.date));
    const wins = filtered.filter((t) => t.pnl > 0);
    const losses = filtered.filter((t) => t.pnl < 0);
    const totalPnl = filtered.reduce((sum, t) => sum + t.pnl, 0);
    const totalAbsPnl = filtered.reduce((sum, t) => sum + Math.abs(t.pnl), 0);

    const profitFactor =
      losses.length === 0
        ? "‚Äì"
        : (wins.reduce((s, t) => s + t.pnl, 0) / Math.abs(losses.reduce((s, t) => s + t.pnl, 0))).toFixed(2);

    const avg = filtered.length === 0 ? "‚Äì" : (totalPnl / filtered.length).toFixed(2);
    const profitPercent = totalAbsPnl === 0 ? null : ((wins.reduce((sum, t) => sum + t.pnl, 0) / totalAbsPnl) * 100);

    return {
      wins: wins.length,
      losses: losses.length,
      totalPnl,
      avg,
      totalTrades: wins.length + losses.length,
      profitPercent
    };
  }

  const isToday = (date) => isSameDay(date, now);
  const isThisWeek = (date) => isSameWeek(date, now);
  const isThisMonth = (date) => isSameMonth(date, now);

  const dayStats = calcStats(isToday);
  const weekStats = calcStats(isThisWeek);
  const monthStats = calcStats(isThisMonth);

  function colorText(value, isPnl = false) {
    if (isPnl) {
      return value >= 0 ? `<span style="color: #0f0;">${value.toFixed(2)} ‚Ç¨</span>` : `<span style="color: #f44;">${value.toFixed(2)} ‚Ç¨</span>`;
    } else {
      return `<span style="color: ${value > 0 ? "#0f0" : "#f44"}">${value}</span>`;
    }
  }

  function colorProfitPercent(p) {
    if (p === null) return "‚Äì";
    if (p < 35) return `<span style="color:#f44">${p.toFixed(1)}%</span>`;
    if (p < 50) return `<span style="color:#ffcc00">${p.toFixed(1)}%</span>`;
    if (p < 75) return `<span style="color:#9acd32">${p.toFixed(1)}%</span>`;
    return `<span style="color:#008000">${p.toFixed(1)}%</span>`;
  }

  const tagBox = document.getElementById("tagBox");
  tagBox.querySelector("p:nth-child(2)").innerHTML = `Gewinne: ${colorText(dayStats.wins)} | Verluste: ${colorText(dayStats.losses)}`;
  tagBox.querySelector("p:nth-child(3)").innerHTML = `Gesamt PnL: ${colorText(dayStats.totalPnl, true)}`;
  tagBox.querySelector("p:nth-child(4)").innerHTML = `Anzahl Trades: ${dayStats.totalTrades}`;
  tagBox.querySelector("p:nth-child(5)").innerHTML = `Profitabel: ${colorProfitPercent(dayStats.profitPercent)}`;

  const wocheBox = document.getElementById("wocheBox");
  wocheBox.querySelector("p:nth-child(2)").innerHTML = `Gewinne: ${colorText(weekStats.wins)} | Verluste: ${colorText(weekStats.losses)}`;
  wocheBox.querySelector("p:nth-child(3)").innerHTML = `Gesamt PnL: ${colorText(weekStats.totalPnl, true)}`;
  wocheBox.querySelector("p:nth-child(4)").innerHTML = `Anzahl Trades: ${weekStats.totalTrades}`;
  wocheBox.querySelector("p:nth-child(5)").innerHTML = `Profitabel: ${colorProfitPercent(weekStats.profitPercent)}`;

  const monatBox = document.getElementById("monatBox");
  monatBox.querySelector("p:nth-child(2)").innerHTML = `Gewinne: ${colorText(monthStats.wins)} | Verluste: ${colorText(monthStats.losses)}`;
  monatBox.querySelector("p:nth-child(3)").innerHTML = `Gesamt PnL: ${colorText(monthStats.totalPnl, true)}`;
  monatBox.querySelector("p:nth-child(4)").innerHTML = `Anzahl Trades: ${monthStats.totalTrades}`;
  monatBox.querySelector("p:nth-child(5)").innerHTML = `Profitabel: ${colorProfitPercent(monthStats.profitPercent)}`;
}


  function switchTab(tab) {
    document.querySelectorAll(".tab-buttons button").forEach((btn) => btn.classList.remove("active"));
    document.querySelectorAll(".stats-box").forEach((box) => (box.style.display = "none"));
    document.getElementById(tab + "Box").style.display = "block";
    document.querySelectorAll(".tab-buttons button").forEach((btn) => {
      if (btn.innerText.toLowerCase().includes(tab)) btn.classList.add("active");
    });
  }

  function showPopup() {
    document.getElementById("tradePopup").style.display = "block";
  }

  function hidePopups() {
    document.getElementById("tradePopup").style.display = "none";
    document.getElementById("resultPopup").style.display = "none";
  }
  
  function resetDay() {
  // Beispiel: Nur heutige Trades l√∂schen
  const today = new Date();
  const remaining = tradesData.filter(t => !isSameDay(t.date, today));
  tradesData.length = 0;
  tradesData.push(...remaining);
  saveTrades();
  loadTrades();
}

function resetWeek() {
  const today = new Date();
  const remaining = tradesData.filter(t => !isSameWeek(t.date, today));
  tradesData.length = 0;
  tradesData.push(...remaining);
  saveTrades();
  loadTrades();
}

function resetMonth() {
  const today = new Date();
  const remaining = tradesData.filter(t => !isSameMonth(t.date, today));
  tradesData.length = 0;
  tradesData.push(...remaining);
  saveTrades();
  loadTrades();
}
  
 window.addEventListener("load", () => {
  initMultiPairSelect();
  loadTrades();

  const resetBtn = document.getElementById("resetBtn");
  const resetDayBtn = document.getElementById("resetDay");
  const resetWeekBtn = document.getElementById("resetWeek");
  const resetMonthBtn = document.getElementById("resetMonth");
  const resetAllBtn = document.getElementById("resetAllBtn");
  const cancelResetBtn = document.getElementById("cancelReset");

  if (resetBtn) {
    resetBtn.addEventListener("click", () => {
      document.getElementById("resetPopup").style.display = "block";
    });
  }

  if (resetDayBtn) {
    resetDayBtn.addEventListener("click", () => {
      resetDay();
      document.getElementById("resetPopup").style.display = "none";
    });
  }

  if (resetWeekBtn) {
    resetWeekBtn.addEventListener("click", () => {
      resetWeek();
      document.getElementById("resetPopup").style.display = "none";
    });
  }

  if (resetMonthBtn) {
    resetMonthBtn.addEventListener("click", () => {
      resetMonth();
      document.getElementById("resetPopup").style.display = "none";
    });
  }

  if (resetAllBtn) {
    resetAllBtn.addEventListener("click", () => {
      resetAll();
      document.getElementById("resetPopup").style.display = "none";
    });
  }

  if (cancelResetBtn) {
    cancelResetBtn.addEventListener("click", () => {
      document.getElementById("resetPopup").style.display = "none";
    });
  }
});
  

  </script>
  
<script>
  // Session Bar JS
  
  

  const sessionText = document.getElementById("sessionText");
  const progressBar = document.getElementById("progressBar");
  const progressContainer = document.querySelector(".progress-container");
  const alertBox = document.getElementById("alertBox");
  const sessionInfoEl = document.getElementById("sessionInfo");
  const sessionDetailsBox = document.getElementById("sessionDetailsBox");
  
  sessionText.addEventListener("click", () => {
  sessionDetailsBox.style.display = sessionDetailsBox.style.display === "block" ? "none" : "block";
});

function formatHM(mins) {
  const h = Math.floor(mins / 60) % 24;
  const m = mins % 60;
  return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
}

  const sessionColors = {
    Sydney: "#3388ff",
    Tokyo: "#00aaff",
    London: "#ffd700",
    "New York": "#ff4500",
    "London Killzone": "#ccff00",
    "New York Killzone": "#ff8800",
    Deadzone: "#333",
  };

const sessions = [
  {
    name: "Sydney",
    start: 1380,
    end: 480,
    info: "Ruhiger Markt, geringere Liquidit√§t, Vorbereitung auf Asien.",
    weekDaysInfo: [
      { day: "Sonntag", text: "üõ†Ô∏è Vorbereitung auf neue Woche" },
      { day: "Montag", text: "üåè Asien-Session startet" },
      { day: "Mittwoch", text: "üìä Wirtschaftsdaten Australien" },
      { day: "Freitag", text: "üìÖ W√∂chentliche Analyse & Planung" }
    ],
  },
  {
    name: "Tokyo",
    start: 60,
    end: 600,
    info: "Moderate Volatilit√§t, Fokus auf JPY/AUD/NZD, Breakouts m√∂glich.",
    weekDaysInfo: [
      { day: "Dienstag", text: "üè¶ BoJ Pressekonferenz" },
      { day: "Donnerstag", text: "üìà Japan BIP-Daten" },
      { day: "Freitag", text: "üá∫üá∏ US NFP wirkt oft nach" }
    ],
  },
  {
    name: "London",
    start: 540,
    end: 1020,
    info: "Hohe Liquidit√§t, starke Bewegungen, europ√§ische Wirtschaftsdaten.",
    weekDaysInfo: [
      { day: "Montag", text: "üìâ EU Handelsdaten" },
      { day: "Dienstag", text: "üèõÔ∏è Zinsentscheidungen der EZB" },
      { day: "Donnerstag", text: "üìä Inflationsdaten UK" },
      { day: "Freitag", text: "üìÖ Arbeitsmarktdaten UK" }
    ],
  },
  {
    name: "New York",
    start: 870,
    end: 1380,
    info: "Hohe Volatilit√§t, US-Daten dominieren, Trendfortsetzungen m√∂glich.",
    weekDaysInfo: [
      { day: "Mittwoch", text: "üè¶ Fed Zinsentscheidungen" },
      { day: "Freitag", text: "üìä US NFP Arbeitsmarktdaten" },
      { day: "Freitag", text: "üìà W√∂chentliche Arbeitslosenmeldung" }
    ],
  },
  {
    name: "London Killzone",
    start: 420,
    end: 660,
    info: "Volatile Phase vor London-Open, Stop-Hunts m√∂glich.",
    weekDaysInfo: [
      { day: "Montag", text: "‚ö° Hohe Volatilit√§t durch Markt√∂ffnung" },
      { day: "Mittwoch", text: "üî• Breakouts oft m√∂glich" }
    ],
  },
  {
    name: "New York Killzone",
    start: 810,
    end: 1020,
    info: "Start der NY Session, hohe Aktivit√§t, gute Chancen f√ºr Daytrader.",
    weekDaysInfo: [
      { day: "Dienstag", text: "‚ö° Erh√∂hte Volatilit√§t durch US-Daten" },
      { day: "Donnerstag", text: "üéôÔ∏è Fed Reden & Daten" }
    ],
  },
  {
    name: "Deadzone",
    start: 1380,
    end: 0,
    info: "Niedrige Volatilit√§t, Seitw√§rtsbewegungen, Ruhephase.",
    weekDaysInfo: [
      { day: "T√§glich", text: "üò¥ Markt ruhig, kaum Bewegung" }
    ],
  }
];

  let lastAlertSession = null;

  function getMinutesNow() {
    const now = new Date();
    return now.getHours() * 60 + now.getMinutes();
  }

  function getCurrentSessions(minNow) {
    return sessions.filter((s) => {
      const start = s.start;
      const end = s.end;
      if (start > end) {
        return minNow >= start || minNow < end;
      } else {
        return minNow >= start && minNow < end;
      }
    });
  }

  function updateGradientBar(colors) {
    if (colors.length === 0) {
      progressBar.style.background = "#444";
      progressBar.style.backgroundImage = "";
      return;
    }

    const svg = `
      <svg xmlns='http://www.w3.org/2000/svg' width='100%' height='100%'>
        <defs>
          <linearGradient id='g' x1='0%' y1='0%' x2='100%' y2='0%'>
            ${colors
              .map((c, i) => `<stop offset='${(i / (colors.length - 1)) * 100}%' stop-color='${c}'/>`)
              .join("")}
          </linearGradient>
        </defs>
        <rect x='0' y='0' width='100%' height='100%' fill='url(#g)'/>
      </svg>`;
    const base64 = btoa(svg);
    progressBar.style.backgroundImage = `url("data:image/svg+xml;base64,${base64}")`;
  }

  function hexToRgba(hex, alpha) {
    hex = hex.replace("#", "");
    const r = parseInt(hex.substring(0, 2), 16);
    const g = parseInt(hex.substring(2, 4), 16);
    const b = parseInt(hex.substring(4, 6), 16);
    return `rgba(${r},${g},${b},${alpha})`;
  }

  function getMinutesToNextSession(minNow) {
    const futureStarts = sessions.map((s) => s.start).filter((start) => start > minNow);

    if (futureStarts.length === 0) {
      return sessions[0].start + 1440 - minNow;
    }

    const nextStart = Math.min(...futureStarts);
    return nextStart - minNow;
  }
  
  // Sound f√ºr Alarm (kannst du auch ersetzen)
const alertSound = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');

function requestNotificationPermission() {
  if ("Notification" in window && Notification.permission !== "granted") {
    Notification.requestPermission().then(permission => {
      if (permission === "granted") {
        console.log("Notifications erlaubt");
      }
    });
  }
}

function showNotification(title, message) {
  if ("Notification" in window && Notification.permission === "granted") {
    const options = {
      body: message,
      icon: 'https://cdn-icons-png.flaticon.com/512/1827/1827409.png',
      vibrate: [200, 100, 200],  // Vibrieren (wenn Handy das unterst√ºtzt)
      tag: "session-alert"
    };
    const notification = new Notification(title, options);
    notification.onclick = () => {
      window.focus();
      notification.close();
    };
  }
}

// Beispiel: Session-Wechsel Alarm
function triggerSessionAlert() {
  alertSound.play();           // Ton abspielen (optional)
  showNotification("Trade App", "‚ö†Ô∏è Session-Wechsel in 5 Minuten!");
}

  function showAlert(msg) {
    const el = document.createElement("div");
    el.className = "alert-message";
    el.textContent = msg;
    alertBox.innerHTML = "";
    alertBox.appendChild(el);
    setTimeout(() => (alertBox.innerHTML = ""), 5000);
  // Spiel Sound ab
  alertSound.play();
  // Push Notification zeigen
  showNotification("Trade App Alarm", msg);
  }
  
  // Beim Laden einmal Erlaubnis abfragen
window.addEventListener("load", () => {
  requestNotificationPermission();
});

  function updateRealTimeBar() {
   const progressBar = document.getElementById("progressBar");
  const progressContainer = document.querySelector(".progress-container");

  if (!progressBar || !progressContainer) return;
  
  const now = new Date();
const minutes = getMinutesNow();
const percent = (minutes / 1439) * 100;
  progressBar.style.width = percent + "%";

  const activeSessions = getCurrentSessions(minutes);
  const names = activeSessions.map((s) => s.name);
  const colors = names.map((name) => sessionColors[name] || "#666");

  updateGradientBar(colors);

  if (colors.length > 0) {
    progressContainer.style.boxShadow = `0 0 12px 6px ${hexToRgba(colors[0], 0.6)}`;
  } else {
    progressContainer.style.boxShadow = "0 0 12px 6px rgba(0,0,0,0)";
  }

  const hours = String(now.getHours()).padStart(2, "0");
  const mins = String(now.getMinutes()).padStart(2, "0");

  const sessionInfo = names.length > 0 ? `‚Äì ${names.join(" + ")} l√§uft` : "‚Äì Keine Session aktiv";
  sessionText.textContent = `üïí Aktuelle Uhrzeit: ${hours}:${mins} ${sessionInfo}`;

  // Session Info Textlogik (deine bestehende Logik, keine √Ñnderungen n√∂tig)
  const minuteNow = now.getHours() * 60 + now.getMinutes();
  const name = activeSessions.length > 0 ? activeSessions[0].name : "";

  let infoText = "Keine aktiven Sessions ‚Äì Markt wahrscheinlich ruhig.";

  if (name === "Tokyo") {
    if (minuteNow < 180) infoText = "üåè Tokyo er√∂ffnet ‚Äì erste Bewegungen durch asiatische H√§ndler.";
    else if (minuteNow < 360) infoText = "üáØüáµ Asiatische Volatilit√§t aktiv ‚Äì m√∂gliche Bewegungen bei JPY.";
    else infoText = "üõë Tokyo flacht ab ‚Äì Fokus wechselt langsam nach Europa.";
  }
  else if (name === "London Killzone") {
    infoText = "‚ö†Ô∏è London Killzone ‚Äì hohe Volatilit√§t & starke Bewegungen m√∂glich.";
  }
  else if (name === "London") {
    if (minuteNow < 720) infoText = "üí∑ London Session ‚Äì Markt in Bewegung, europ√§ische Daten entscheidend.";
    else if (minuteNow < 840) infoText = "üò¥ Mittagliche Deadzone ‚Äì Markt konsolidiert h√§ufig, Vorsicht bei Entries.";
    else infoText = "üìà London-Teilnehmer bleiben aktiv ‚Äì Vorbereitung auf NY.";
  }
  else if (name === "New York Killzone") {
    infoText = "üî• New York Killzone ‚Äì starke Reaktionen auf US-News & Breakouts m√∂glich.";
  }
  else if (name === "New York") {
    if (minuteNow < 1080) infoText = "üá∫üá∏ New York Session ‚Äì starker US-Einfluss, Trendfortsetzungen m√∂glich.";
    else if (minuteNow < 1200) infoText = "üìâ New York flacht ab ‚Äì Markt beruhigt sich langsam.";
    else infoText = "üåÉ New York Session endet ‚Äì geringe Bewegung, Vorsicht bei Entries.";
  }
  else if (minuteNow >= 720 && minuteNow < 840) {
    infoText = "üò¥ Mittagliche Deadzone ‚Äì Markt konsolidiert h√§ufig, Vorsicht bei Entries.";
  }
  else if (minuteNow >= 1380 || minuteNow < 60) {
    infoText = "üåô Nacht-Deadzone ‚Äì Markt ist extrem ruhig, keine relevanten Bewegungen.";
  }

  sessionInfoEl.textContent = infoText;

  if (activeSessions.length > 0) {
    const currentSession = activeSessions[0];

    let weekDaysHtml = "";
    if (currentSession.weekDaysInfo) {
      weekDaysHtml = "<br><strong>üìÖ Wichtige Tage:</strong><ul style='margin-left:18px;'>";
      currentSession.weekDaysInfo.forEach(({ day, text }) => {
        weekDaysHtml += `<li><strong>${day}:</strong> ${text}</li>`;
      });
      weekDaysHtml += "</ul>";
    }

    sessionDetailsBox.innerHTML = `
      <strong>üü° ${currentSession.name} Session</strong><br>
      üìÖ Start: ${formatHM(currentSession.start)} Uhr<br>
      üïì Ende: ${formatHM(currentSession.end)} Uhr<br>
      ${currentSession.killzone ? `‚ö†Ô∏è Killzone: ${formatHM(currentSession.killzone[0])} ‚Äì ${formatHM(currentSession.killzone[1])} Uhr<br>` : ""}
      ‚ÑπÔ∏è ${currentSession.info}
      ${weekDaysHtml}
    `;
  } else {
    sessionDetailsBox.innerHTML = "Keine aktive Session ‚Äì Markt ist ruhig.";
  }

  // Session-Wechsel Alarm-Logik
  const minutesToNext = getMinutesToNextSession(minutes);

  if (minutesToNext <= 5 && minutesToNext > 0) {
    if (lastAlertSession !== sessionText.textContent && sessionText.textContent !== "Session-Zeit: 00:00") {
      showAlert(`‚ö†Ô∏è Session-Wechsel in 5 Minuten!`);
      lastAlertSession = sessionText.textContent;
    }
  } else {
    lastAlertSession = null;
  }
}

  setInterval(updateRealTimeBar, 60000);
  updateRealTimeBar();
</script>

<script>
  // Service Worker Registrierung
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker
        .register("sw.js")
        .then(reg => {
          console.log("Service Worker registriert:", reg);
        })
        .catch(err => {
          console.error("Service Worker Registrierung fehlgeschlagen:", err);
        });
    });
  }
</script>
</body>
</html>
