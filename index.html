<!DOCTYPE html>
<html lang="de">
<head>
<link rel="stylesheet" href="CSS/ticker.css" />
<link rel="stylesheet" href="CSS/star.css" />
<link rel="stylesheet" href="CSS/session.css" />
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#00aa44" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trade App Layout</title>
  <style>
html, body {
  margin: 0;
  padding: 0;
  overflow-x: hidden;
  width: 100%;
  max-width: 100vw;
}
* {
  box-sizing: border-box;
}

body {
  width: 100%;
  max-width: 100vw;
  overflow-x: hidden;
}

img, canvas, .stats-box, .calc-box, .popup, .position-bar, .trade-box, .tool-box {
  max-width: 100%;
  width: 100%;
}
body {
  --session-bg-color: #111;
  --session-glow: radial-gradient(ellipse at bottom, rgba(100, 0, 150, 0.2) 0%, transparent 70%);

  background-color: var(--session-bg-color);
  color: white;
  font-family: sans-serif;
  margin: 0;
  padding: 0;
  overflow-x: hidden;
  width: 100%;
  max-width: 100vw;

  background-image:
    var(--session-glow),
    linear-gradient(0deg, rgba(255,255,255,0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
  background-size:
    100% 100%, 
    40px 40px, 
    40px 40px;
  background-repeat: no-repeat;
  background-attachment: fixed;
  animation: bgScroll 40s linear infinite;
}




@keyframes bgScroll {
  0% { background-position: 0 0, 0 0, 0 0; }
  100% { background-position: 400px 400px, 40px 40px, 40px 40px; }
}
#bgCandles {
  opacity: 0.035;        /* super dezent */
  filter: blur(0.6px);   /* weiche Kanten */
  pointer-events: none;  /* klickt nicht durch */
}

.stats-box {
  background: linear-gradient(145deg, #1e1e1e, #262626); /* sanftes Dunkelgrau mit Lichtschimmer */
  padding: 18px 22px;
  border-radius: 16px;
  box-shadow:
    inset 0 1px 2px rgba(255, 255, 255, 0.04),
    0 4px 10px rgba(0, 0, 0, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.05);
  margin-top: 25px;
  text-align: left;
  max-width: 440px;
  margin-left: auto;
  margin-right: auto;
  transition: box-shadow 0.3s ease;
  overflow-x: hidden;
}

.stats-box:hover {
  box-shadow:
    inset 0 1px 2px rgba(255, 255, 255, 0.06),
    0 6px 16px rgba(0, 0, 0, 0.5),
    0 0 0 1px rgba(255, 255, 255, 0.07);
}


.crypto-animate {
  font-weight: bold;
  font-size: 18px;
  color: #ffffff;
  text-shadow: 0 0 4px #00ffff, 0 0 8px #00ffff, 0 0 16px #ff00cc;
  animation: cryptoGlowPulse 2.4s ease-in-out infinite alternate;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: linear-gradient(90deg, #00ffff, #ff00cc, #9900ff);
  background-size: 300% 300%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.crypto-animate .coin {
  display: inline-block;
  animation: spinCoin 1.5s linear infinite;
  font-size: 22px;
  color: #ff00cc;
  text-shadow: 0 0 5px #ff00cc, 0 0 12px #ff00cc;
}

@keyframes spinCoin {
  0%   { transform: rotateY(0deg); }
  100% { transform: rotateY(360deg); }
}

@keyframes cryptoGlowPulse {
  0% {
    text-shadow: 0 0 4px #00ffff, 0 0 8px #00ffff, 0 0 12px #ff00cc;
    background-position: 0% 50%;
  }
  100% {
    text-shadow: 0 0 10px #ff00cc, 0 0 20px #ff00cc, 0 0 40px #00ffff;
    background-position: 100% 50%;
  }
}
@keyframes bgScroll {
  from {
    background-position: 0 0;
  }
  to {
    background-position: 40px 40px;
  }
}


</style>
<link rel="stylesheet" href="mobile.css" media="screen and (max-width: 480px)">

<div class="ticker-box">
  <div id="tickerContent" class="ticker-content">
    📢 Lade Marktdaten...
  </div>
</div>
<canvas id="bgCandles" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1;"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="scripts/position.js"></script>
<script src="scripts/dawn.js"></script>
<script src="scripts/tax.js"></script>
<script src="scripts/bg-candles.js"></script>
<script src="scripts/ticker.js"></script> <!-- 👈 wichtig -->
<script src="imageStorage.js"></script>



</head>
<body>
<div id="sessionBackgroundOverlay"></div>
<!-- ⏱️ Session-Zeit oben prominent -->
<div class="ticker" id="sessionText">Session-Zeit: 00:00</div>

<!-- 🗓️ Tageszusammenfassung -->
<div id="daySummary" class="ticker day-summary">
  🗓️ Lade Tagesinfo...
</div>
<!-- 📦 Session-Details-Box -->
<div class="session-details-box" id="sessionDetailsBox"></div>
<!-- 📄 Detail-Text zur Tageszusammenfassung -->
<div id="dayDetails" class="day-details" style="display: none;"></div>


<!-- 📊 Session-Fortschritt mit Countdown & Nächste -->
<div id="sessionProgressDisplay"
     style="text-align: center;
            font-size: clamp(15px, 4vw, 18px);
            font-weight: 600;
            margin: 16px 0 12px 0;
            color: #ffffff;
            padding: 14px 20px;
            border-radius: 12px;
            background: linear-gradient(90deg, #181818, #1f1f1f);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow:
              0 0 8px rgba(255, 255, 255, 0.04),
              inset 0 0 8px rgba(255, 255, 255, 0.02);
            text-shadow: 0 0 1px rgba(255, 255, 255, 0.2);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            letter-spacing: 0.4px;
            backdrop-filter: blur(1px);
            user-select: none;
            transition: all 0.3s ease;">
</div>

<!-- 💬 Session-Kommentar (z. B. flacht ab) -->
<div id="sessionInfo"
     style="margin-top: 12px;
            padding: 12px 18px;
            color: #ffffff;
            font-size: clamp(13px, 3.5vw, 16px);
            font-style: italic;
            text-align: center;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(0, 255, 153, 0.12), rgba(0, 255, 153, 0.22));
            text-shadow: 0 0 2px rgba(0, 255, 153, 0.6), 0 0 6px rgba(0, 255, 153, 0.3);
            box-shadow: inset 0 0 10px rgba(0, 255, 153, 0.3), 0 0 6px rgba(0, 255, 153, 0.2);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 600;
            backdrop-filter: blur(2px);
            transition: all 0.3s ease;">
  Tipps und Infos zur Session erscheinen hier...
</div>






<!-- 🟢 Fortschrittsbalken (zentriert & optisch zugehörig) -->
<div class="progress-container">
  <div class="progress-bar" id="progressBar"></div>
</div>



<!-- 🚨 Alerts direkt darunter, aber eher selten sichtbar -->
<div class="alert-below-header" id="alertBox"></div>


<!-- Tab-Buttons -->
<div class="tab-buttons" style="margin-top: 20px;">
  <!-- 📐 Position Size -->
  <button id="btn-calc-pos" onclick="switchCalcTab('pos')" style="
    background: #ffffff;
    color: #111;
    box-shadow: 0 0 8px rgba(255,255,255,0.4);
    padding: 10px 15px;
    margin: 5px;
    border-radius: 8px;
    border: none;
    font-weight: bold;
    cursor: pointer;
    font-size: 15px;
    transition: all 0.15s ease;
    transform: scale(1);
  " onmousedown="this.style.transform='scale(0.94)'" onmouseup="this.style.transform='scale(1)'">
    📐 Position Size
  </button>

  <!-- 🌒 Dawn Rechner -->
  <button id="btn-calc-dawn" onclick="switchCalcTab('dawn')" style="
    background: #0077cc;
    color: white;
    box-shadow: 0 0 8px rgba(0,119,204,0.6);
    padding: 10px 15px;
    margin: 5px;
    border-radius: 8px;
    border: none;
    font-weight: bold;
    cursor: pointer;
    font-size: 15px;
    transition: all 0.15s ease;
    transform: scale(1);
  " onmousedown="this.style.transform='scale(0.94)'" onmouseup="this.style.transform='scale(1)'">
    🌒 Dawn Rechner
  </button>

  <!-- 📄 Steuer / Netto -->
  <button id="btn-calc-taxpro" onclick="switchCalcTab('taxpro')" style="
    background: #cc3333;
    color: white;
    box-shadow: 0 0 8px rgba(204,51,51,0.6);
    padding: 10px 15px;
    margin: 5px;
    border-radius: 8px;
    border: none;
    font-weight: bold;
    cursor: pointer;
    font-size: 15px;
    transition: all 0.15s ease;
    transform: scale(1);
  " onmousedown="this.style.transform='scale(0.94)'" onmouseup="this.style.transform='scale(1)'">
    📄 Steuer / Netto-Planer
  </button>
</div>







<div id="calc-taxpro" class="calc-box" style="margin-top: 15px; display: none;">
  <div class="stats-box">
    <!-- 🔁 Umschaltbare Ansicht -->
    <div id="steuerMode">
      <label for="gewinnBetrag">📈 Gesamtgewinn (€):</label>
      <input type="number" id="gewinnBetrag" placeholder="z. B. 17200" />

      <label for="einkommenSteuer">💸 Einkommensteuer-Satz (%):</label>
      <input type="number" id="einkommenSteuer" placeholder="z. B. 25" value="25" step="0.1" />

      <label><input type="checkbox" id="kirchensteuer" /> ✝️ Kirchensteuer (9 %)</label><br>
      <label><input type="checkbox" id="soliZuschlag" /> 💣 Solidaritätszuschlag (5.5 %)</label><br>
      <label><input type="checkbox" id="reserveZehn" /> 💥 +10 % Reserve</label><br>

      <button onclick="berechneSteuern()" class="tax-button">📊 Steuer berechnen</button>
      <div id="steuerAusgabe"></div>
    </div>

    <div id="nettoMode" style="display:none">
      <label for="nettoBrutto">📈 Brutto-Gewinn (€):</label>
      <input type="number" id="nettoBrutto" placeholder="z. B. 10000" />

      <label for="nettoSteuer">💸 Steuerlast (€):</label>
      <input type="number" id="nettoSteuer" placeholder="z. B. 3500" />

      <label for="nettoEntnommen">🏦 Tatsächlich entnommen (€):</label>
      <input type="number" id="nettoEntnommen" placeholder="z. B. 8000" />

      <button onclick="berechneNettoPlan()" class="tax-button">💸 Netto berechnen</button>
      <div id="nettoAusgabe"></div>
    </div>

    <!-- 🧠 Umschalter -->
    <button onclick="switchPlanMode()" id="planToggleBtn" style="
      margin-top: 15px;
      background: #444;
      color: white;
      padding: 10px;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      width: 100%;
      cursor: pointer;
      font-weight: bold;
    ">
    🔁 Zu Netto-Planer wechseln
    </button>
  </div>
</div>




<div id="calc-dawn" class="calc-box" style="display:none; margin-top: 15px;">
  <div class="stats-box">
    <label for="dawnCapital">📦 Startkapital (€):</label>
    <input type="number" id="dawnCapital" placeholder="z. B. 1000">

    <label for="dawnLoss">📉 Verlust pro Dawn (%) :</label>
    <input type="number" id="dawnLoss" placeholder="z. B. 3" step="0.1">

    <button onclick="simulateDawnDeath()" style="
      background: #0077cc;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 10px;
      font-weight: bold;
      margin-top: 12px;
      width: 100%;
      cursor: pointer;
    ">☠️ Dawn-Simulation starten</button>

    <p id="dawnDeathResult" style="margin-top: 10px; font-weight: bold; font-size: 16px;"></p>
  </div>
</div>





<div id="calc-pos" class="calc-box" style="margin-top: 15px; display:none;">

  <div class="stats-box">
    <label for="accountSize">📦 Kontogröße (€):</label>
    <input type="number" id="accountSize" placeholder="z. B. 1000" />

    <label for="riskPercent">⚠️ Risiko in %:</label>
    <input type="number" id="riskPercent" placeholder="z. B. 1" step="0.1" />

    <label for="stopLossPips">🛑 Stop-Loss (in Pips):</label>
    <input type="number" id="stopLossPips" placeholder="z. B. 20" />

<label for="symbolSelector">💱 Trading-Paar:</label>
<select id="symbolSelector">
  <optgroup label="🌍 Forex Standard">
    <option value="AUD/USD">AUD/USD</option>
    <option value="EUR/USD">EUR/USD</option>
    <option value="GBP/USD">GBP/USD</option>
    <option value="NZD/USD">NZD/USD</option>
    <option value="USD/CHF">USD/CHF</option>
    <option value="USD/CAD">USD/CAD</option>
  </optgroup>

  <optgroup label="💴 Forex Yen-Paare">
    <option value="USD/JPY">USD/JPY</option>
    <option value="EUR/JPY">EUR/JPY</option>
    <option value="GBP/JPY">GBP/JPY</option>
    <option value="CHF/JPY">CHF/JPY</option>
    <option value="AUD/JPY">AUD/JPY</option>
    <option value="NZD/JPY">NZD/JPY</option>
    <option value="CAD/JPY">CAD/JPY</option>
  </optgroup>

  <optgroup label="🔁 Cross-Paare">
    <option value="EUR/GBP">EUR/GBP</option>
    <option value="EUR/AUD">EUR/AUD</option>
    <option value="EUR/CAD">EUR/CAD</option>
    <option value="GBP/AUD">GBP/AUD</option>
    <option value="GBP/CAD">GBP/CAD</option>
    <option value="AUD/CAD">AUD/CAD</option>
  </optgroup>

  <optgroup label="🥇 Metalle">
    <option value="XAU/USD">XAU/USD</option>
    <option value="XAG/USD">XAG/USD</option>
  </optgroup>

  <optgroup label="🪙 Krypto">
    <option value="BTC/USD">BTC/USD</option>
    <option value="ETH/USD">ETH/USD</option>
  </optgroup>

  <optgroup label="📊 Indizes">
    <option value="US30">US30</option>
    <option value="NAS100">NAS100</option>
    <option value="SPX500">SPX500</option>
    <option value="GER40">GER40</option>
    <option value="UK100">UK100</option>
  </optgroup>
  
</select>

<label for="leverage">⚙️ Hebel:</label>
<input type="number" id="leverage" value="500" min="1" placeholder="z. B. 500" />




    <button onclick="calculatePositionSize()">📐 Berechnen</button>
    <p id="positionSizeResult" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
  </div>

  <div style="text-align:right; margin-bottom: 5px;">
    <span onclick="toggleInfoBox()" 
          style="cursor:pointer; background:#444; border-radius:50%; padding:3px 8px; font-weight:bold; color:#0ff;"
          title="Erklärung anzeigen">i</span>
  </div>
  <div id="posInfoBox" style="display:none; background:#222; padding:12px; border-radius:8px; margin-top:10px; color:#ccc; font-size:14px; text-align:left;">
    <strong>ℹ️ Was macht dieser Rechner?</strong><br><br>
    Der Positionsgrößen-Rechner hilft dir zu ermitteln, wie viele Lots du in einem Trade einsetzen darfst, ohne mehr als einen bestimmten Prozentsatz deines Kontos zu riskieren. Die Berechnung basiert auf vier Angaben:
    <ul style="margin-top:10px; margin-bottom:10px;">
      <li><strong>📦 Kontogröße:</strong> Dein aktuelles Guthaben in Euro.</li>
      <li><strong>⚠️ Risiko in %:</strong> Wie viel Prozent deines Kontos du maximal pro Trade verlieren willst (z. B. 1%).</li>
      <li><strong>🛑 Stop-Loss (Pips):</strong> Die Distanz zwischen Einstieg und Stop-Loss in Pips.</li>
      <li><strong>💡 Pip-Wert pro Lot:</strong> Wie viel ein Pip pro Standard-Lot wert ist (z. B. 10 € bei EUR/USD).</li>
    </ul>
    <strong>📐 Formel:</strong><br>
    <code style="color:#0ff;">Positionsgröße = (Kontogröße × Risiko%) / (Stop-Loss × Pip-Wert)</code><br><br>
    <strong>🔍 Beispiel:</strong><br>
    Kontogröße: 1000 €<br>
    Risiko: 2%<br>
    Stop-Loss: 20 Pips<br>
    Pip-Wert: 10 €/Lot<br><br>
    <strong>→</strong> Du riskierst 20 € (1000 × 0,02).<br>
    <strong>→</strong> Bei 20 Pips wären das 1 €/Pip erlaubt (20 € / 20 Pips).<br>
    <strong>→</strong> Der Pip-Wert ist 10 €/Lot ⇒ <strong>Erlaubte Lotgröße: 0.10</strong><br><br>
    <em style="color:#aaa;">Hinweis: Bei Indizes oder Gold kann der Pip-Wert unterschiedlich sein!</em>
  </div>
</div>


  <div style="text-align:right; margin-bottom: 5px;">
    <span onclick="toggleRiskInfo()" 
          style="cursor:pointer; background:#444; border-radius:50%; padding:3px 8px; font-weight:bold; color:#0ff;"
          title="Erklärung anzeigen">i</span>
  </div>

  <div id="riskInfoBox" style="display:none; background:#222; padding:12px; border-radius:8px; margin-top:10px; color:#ccc; font-size:14px; text-align:left;">
    <strong>ℹ️ Was macht dieser Rechner?</strong><br><br>
    Der Risiko-%-Rechner zeigt dir, wie viel Geld du bei einem Trade riskierst und wie viel Prozent deines Kontos das ausmacht. Er basiert auf:

    <ul style="margin-top:10px; margin-bottom:10px;">
      <li><strong>📦 Kontogröße:</strong> Dein Kontoguthaben in Euro</li>
      <li><strong>🧮 Lotgröße:</strong> Wie groß dein Trade ist (z. B. 0.1 = Mini-Lot)</li>
      <li><strong>🛑 Stop-Loss (Pips):</strong> Wie weit der SL vom Einstieg entfernt ist</li>
      <li><strong>💡 Pip-Wert:</strong> Wie viel 1 Pip pro Lot kostet (z. B. 10 €)</li>
    </ul>

    <strong>📐 Formel:</strong><br>
    <code style="color:#0ff;">Risiko (€) = Lotgröße × SL × Pip-Wert<br>
    Risiko-% = Risiko / Kontogröße × 100</code><br><br>

    <strong>🔍 Beispiel:</strong><br>
    Konto: 1000 €<br>
    Lot: 0.2<br>
    SL: 30 Pips<br>
    Pip-Wert: 10 €<br>
    → Risiko = 0.2 × 30 × 10 = 60 €<br>
    → Risiko-% = 60 / 1000 = <strong>6 %</strong><br><br>

    <em style="color:#aaa;">Achte darauf, dass dein Risiko unter 2 % bleibt, um langfristig zu überleben.</em>
  </div>
</div>



<div id="calc-lot" class="calc-box" style="display:none; margin-top: 15px;">
  <div class="stats-box">
    <label for="lotFixedRisk">💰 Risiko in Euro:</label>
    <input type="number" id="lotFixedRisk" placeholder="z. B. 50" />

    <label for="lotSL">🛑 Stop-Loss (in Pips):</label>
    <input type="number" id="lotSL" placeholder="z. B. 20" />

    <label for="lotPipValue">💡 Pip-Wert pro Lot (€):</label>
    <input type="number" id="lotPipValue" placeholder="z. B. 10" value="10" />

    <button onclick="calculateLotFromFixed()">🧮 Lotgröße berechnen</button>

    <p id="lotResult" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
  </div>

  <div style="text-align:right; margin-bottom: 5px;">
    <span onclick="toggleLotInfo()" 
          style="cursor:pointer; background:#444; border-radius:50%; padding:3px 8px; font-weight:bold; color:#0ff;"
          title="Erklärung anzeigen">i</span>
  </div>

  <div id="lotInfoBox" style="display:none; background:#222; padding:12px; border-radius:8px; margin-top:10px; color:#ccc; font-size:14px; text-align:left;">
    <strong>ℹ️ Was macht dieser Rechner?</strong><br><br>
    Du gibst an, wie viel Euro du maximal verlieren willst – der Rechner sagt dir, welche Lotgröße das erlaubt.<br><br>

    <strong>Beispiel:</strong><br>
    Risiko: 100 €<br>
    SL: 25 Pips<br>
    Pip-Wert: 10 €/Lot<br>
    → <code style="color:#0ff;">Lots = 100 / (25 × 10) = 0.40</code>
  </div>
</div>

<div id="calc-breakeven" class="calc-box" style="display:none; margin-top: 15px;">
  <div class="stats-box">
    <label for="entryPrice">🎯 Einstiegspreis:</label>
    <input type="number" id="entryPrice" placeholder="z. B. 1.12345" step="0.00001" />

    <label for="spreadPips">📏 Spread (Pips):</label>
    <input type="number" id="spreadPips" placeholder="z. B. 1.5" step="0.1" />

    <label for="fees">💸 Gebühren (€):</label>
    <input type="number" id="fees" placeholder="z. B. 2.00" step="0.01" />

    <label for="beLotSize">🧮 Lotgröße:</label>
    <input type="number" id="beLotSize" placeholder="z. B. 0.1" step="0.01" />

    <label for="bePipValue">💡 Pip-Wert pro Lot (€):</label>
    <input type="number" id="bePipValue" placeholder="z. B. 10" value="10" />

    <button onclick="calculateBreakeven()">🧠 Break-even berechnen</button>

    <p id="breakevenResult" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
  </div>

  <div style="text-align:right; margin-bottom: 5px;">
    <span onclick="toggleBreakevenInfo()" 
          style="cursor:pointer; background:#444; border-radius:50%; padding:3px 8px; font-weight:bold; color:#0ff;"
          title="Erklärung anzeigen">i</span>
  </div>

  <div id="breakevenInfoBox" style="display:none; background:#222; padding:12px; border-radius:8px; margin-top:10px; color:#ccc; font-size:14px; text-align:left;">
    <strong>ℹ️ Was macht dieser Rechner?</strong><br><br>
    Der Break-even-Rechner zeigt dir den Preis, bei dem dein Trade exakt auf Null läuft – also weder Gewinn noch Verlust.<br><br>

    Dabei berücksichtigt werden:
    <ul style="margin-top:10px; margin-bottom:10px;">
      <li><strong>🎯 Einstiegspreis:</strong> Der Preis, zu dem du den Trade geöffnet hast.</li>
      <li><strong>📏 Spread:</strong> Unterschied zwischen Bid und Ask in Pips.</li>
      <li><strong>💸 Gebühren:</strong> z. B. Kommissionen des Brokers.</li>
      <li><strong>🧮 Lotgröße:</strong> Deine aktuelle Positionsgröße.</li>
      <li><strong>💡 Pip-Wert:</strong> Wert eines Pips pro Lot (z. B. 10 € bei Forex).</li>
    </ul>

    <strong>📐 Formel:</strong><br>
    <code style="color:#0ff;">Break-even = Einstiegspreis ± (Spread + Gebühren ÷ (Lotgröße × Pip-Wert))</code><br><br>

    <em style="color:#aaa;">Ob du + oder – rechnest, hängt davon ab, ob du Long oder Short bist. Dieser Rechner geht vom LONG-Trade aus.</em>
  </div>
</div>

<div id="calc-leverage" class="calc-box" style="display:none; margin-top: 15px;">
  <div class="stats-box">
    <label for="leverageMode">Berechnungsmodus:</label>
    <select id="leverageMode" onchange="toggleLeverageMode()">
      <option value="capital">🔁 Hebel ➜ Kapital berechnen</option>
      <option value="lotcheck">📊 Hebel + Kapital ➜ Lotcheck</option>
    </select>

    <!-- MODUS 1: Hebel ➜ Kapital -->
    <div id="capitalMode">
      <label for="leverageInput1">📦 Kapital (in €):</label>
      <input type="number" id="leverageInput1" placeholder="z. B. 500" />

      <label for="leverageInput2">💼 Lotgröße:</label>
      <input type="number" id="leverageInput2" placeholder="z. B. 1.0" step="0.01" />

      <label for="leverageInput3">📈 Hebel:</label>
      <input type="number" id="leverageInput3" placeholder="z. B. 10" step="1" />
    </div>

    <!-- MODUS 2: Hebel + Kapital ➜ Lotcheck -->
    <div id="lotCheckMode" style="display:none">
  <label for="lotCapital">📦 Kapital (in €):</label>
  <input type="number" id="lotCapital" placeholder="z. B. 250" />

  <label for="lotLeverage">💡 Hebel (z. B. 500):</label>
  <input type="number" id="lotLeverage" placeholder="z. B. 500" />

  <label for="lotPair">📊 Währungspaar:</label>
<select id="lotPair">
  <optgroup label="🔁 Forex">
    <option value="EUR/USD">EUR/USD</option>
    <option value="GBP/USD">GBP/USD</option>
    <option value="AUD/USD">AUD/USD</option>
    <option value="NZD/USD">NZD/USD</option>
    <option value="USD/CAD">USD/CAD</option>
    <option value="USD/CHF">USD/CHF</option>
    <option value="USD/JPY">USD/JPY</option>
    <option value="EUR/JPY">EUR/JPY</option>
    <option value="GBP/JPY">GBP/JPY</option>
    <option value="CHF/JPY">CHF/JPY</option>
    <option value="AUD/JPY">AUD/JPY</option>
    <option value="CAD/JPY">CAD/JPY</option>
    <option value="EUR/GBP">EUR/GBP</option>
    <option value="EUR/AUD">EUR/AUD</option>
    <option value="EUR/CAD">EUR/CAD</option>
    <option value="GBP/AUD">GBP/AUD</option>
    <option value="GBP/CAD">GBP/CAD</option>
  </optgroup>

  <optgroup label="🥇 Rohstoffe">
    <option value="XAU/USD">XAU/USD (Gold)</option>
    <option value="XAG/USD">XAG/USD (Silber)</option>
  </optgroup>

  <optgroup label="💹 Indizes">
    <option value="US30">US30 (Dow Jones)</option>
    <option value="NAS100">NAS100 (Nasdaq)</option>
    <option value="SPX500">SPX500 (S&P 500)</option>
    <option value="GER40">GER40 (DAX)</option>
    <option value="UK100">UK100 (FTSE)</option>
  </optgroup>

  <optgroup label="₿ Krypto">
    <option value="BTC/USD">BTC/USD</option>
    <option value="ETH/USD">ETH/USD</option>
  </optgroup>
</select>

</div>

    <button onclick="calculateLeverage()">🔧 Berechnen</button>
    <p id="leverageResult" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
  </div>
</div>

  <!-- 📆 Kalender -->
<div id="journalCalendarBox" class="stats-box" style="margin-top: 20px;">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <button onclick="changeMonth(-1)">⬅️</button>
    <h3 id="calendarTitle">🗓️ Journal-Kalender</h3>
    <button onclick="changeMonth(1)">➡️</button>
  </div>

  <canvas id="calendarEquityChart" height="150" style="margin:10px auto 5px auto; display:block;"></canvas>

  <div id="calendarEquityStats" style="color: #ccc; margin-top: 5px;"></div>
  <div id="calendarContainer" style="margin-top: 10px;"></div>
  <div id="calendarStats" style="margin-top: 5px; color: #ccc;"></div>
  <div id="journalEntryList" style="margin-top: 0;"></div>
</div>
<!-- ✅ Immer sichtbare Buttons -->
<div style="margin:20px 0; text-align:center;">
  <button onclick="resetCurrentMonth()" style="margin:5px; background:#cc6600; color:white; padding:8px 15px; border:none; border-radius:5px;">🗓️ Monat zurücksetzen</button>
  <button onclick="resetSelectedDay()" style="margin:5px; background:#0066cc; color:white; padding:8px 15px; border:none; border-radius:5px;">📅 Tag zurücksetzen</button>
  <button onclick="resetAllJournal()" style="margin:5px; background:#990000; color:white; padding:8px 15px; border:none; border-radius:5px;">🗑️ Alles löschen</button>
</div>
<!-- 📘 Journal-Eingabe -->
<div id="calc-journal" class="calc-box" style="display:none; margin-top: 10px;">
  <div class="stats-box" style="display: flex; flex-direction: column; gap: 14px; max-width: 500px; margin: auto; padding: 20px; border-radius: 12px; background: #1a1a1a; color: #eee;">

    <label>🧭 Strategie-Modus:</label>
    <select id="tradingMode" onchange="updateBiasOptions()" class="input" style="width: 100%;">

      <option value="day">Daytrading</option>
      <option value="swing">Swing-Trading</option>
    </select>

    <label>📆 Datum:</label>
    <input type="date" id="journalManualDate" class="input" style="width: 100%;" />

    <label>💱 Symbol:</label>
    <input type="text" id="journalSymbol" class="input" placeholder="z. B. EUR/USD" oninput="suggestSymbol()" autocomplete="off" style="width: 100%;" />
    <div id="symbolSuggestions" style="background:#222; color:white; padding:5px; display:none; border-radius:6px;"></div>

<!-- Einstieg + Ausstieg + Richtung -->
<div style="display: flex; gap: 10px; flex-wrap: wrap;">
  <div style="flex: 1; min-width: 130px;">
    <label>🎯 Einstieg:</label>
    <input type="number" id="journalEntry" class="input" style="width: 100%;" onchange="autoSuggestExit()" />
  </div>
  <div style="flex: 1; min-width: 130px;">
    <label>🏁 Ausstieg:</label>
    <input type="number" id="journalExit" class="input" style="width: 100%;" onchange="userChangedExit = true;" />
  </div>
  <div style="flex: 1; min-width: 130px;">
    <label>Richtung:</label>
    <select id="journalDirection" class="input" onchange="autoSuggestExit()">
      <option value="long">📈 Long</option>
      <option value="short">📉 Short</option>
    </select>
  </div>
</div>


  <div style="display: flex; flex-direction: column; gap: 10px;">
<div>
  <label>📦 Lotgröße:</label>
  <select id="journalLots" class="input" style="width: 100%; background-color: white; color: black;">
    <option value="">– Bitte wählen –</option>
    <option value="0.01">0.01</option>
    <option value="0.02">0.02</option>
    <option value="0.03">0.03</option>
    <option value="0.05">0.05</option>
    <option value="0.10">0.10</option>
    <option value="0.25">0.25</option>
    <option value="0.50">0.50</option>
    <option value="1.00">1.00</option>
    <option value="2.00">2.00</option>
    <option value="3.00">3.00</option>
    <option value="5.00">5.00</option>
    <option value="10.00">10.00</option>
    <option value="25.00">25.00</option>
    <option value="50.00">50.00</option>
    <option value="100.00">100.00</option>
  </select>
</div>


  <div>
    <label>📊 PnL (€):</label>
<input type="text"
       id="journalPnL"
       class="input"
       placeholder="z. B. -50.00"
       inputmode="numeric"
       pattern="^-?[0-9]+([.,][0-9]{1,2})?$"
       style="width: 100%; background-color: white; color: black;" />


  </div>
</div>


  <div class="emotion-block">
  <label>😐 Fokus <strong>vor</strong> dem Trade:</label>
  <div id="starsBefore" class="star-rating"></div>
  <input type="hidden" id="emotionBefore" value="5" />
</div>

<div class="emotion-block">
  <label>😤 Emotion <strong>nach</strong> dem Trade:</label>
  <div id="starsAfter" class="star-rating"></div>
  <input type="hidden" id="emotionAfter" value="5" />
</div>


    <label>🧠 Setup:</label>
<select id="journalSetup" class="input" style="width: 100%;">
  <option value="">– Setup wählen –</option>
  <option value="Rejectiont">Rejection</option>
  <option value="Breakout + Rejection">Breakout + Rejection</option>
  <option value="Liquidity Grab">Liquidity Grab</option>
  <option value="Shift">Shift HTF/LTF</option>
  <option value="HH HL LH LL">HH HL LH LL</option>
</select>

<!-- 🧱 Setup-Box Start -->
<div id="setupBoxWrapper"
  style="margin-top: 10px; border-radius: 12px; padding: 16px;
         background: linear-gradient(135deg, #3d1e1e, #6b2f2f);
         border: 2px solid #aa3333;
         color: #eee;
         box-shadow: 0 0 8px rgba(255, 50, 50, 0.25);
         transition: all 0.3s ease;">

  <label style="font-weight: bold; font-size: 16px; display: block; margin-bottom: 10px; color: #f0f0f0; text-shadow: 1px 1px 2px black;">
    ✅ Setup-Check
  </label>

  <label style="margin-top: 5px; color: #f0f0f0; text-shadow: 1px 1px 2px black;">🧭 Multi-Timeframe Bias:</label>
  <div id="biasTimeframes" style="display: flex; flex-wrap: wrap; gap: 10px; font-size: 14px; color: #eeeeee; text-shadow: 1px 1px 2px black;">
    <label><input type="checkbox" value="15M" onchange="updateSetupScoreDisplay()" /> 15M</label>
    <label><input type="checkbox" value="30M" onchange="updateSetupScoreDisplay()" /> 30M</label>
    <label><input type="checkbox" value="1H" onchange="updateSetupScoreDisplay()" /> 1H</label>
    <label><input type="checkbox" value="4H" onchange="updateSetupScoreDisplay()" /> 4H</label>
    <label><input type="checkbox" value="D1" onchange="updateSetupScoreDisplay()" /> D1</label>
    <label><input type="checkbox" value="W1" onchange="updateSetupScoreDisplay()" /> W1</label>
  </div>

  <div id="ruleChecklist" style="display: flex; flex-direction: column; gap: 10px; font-size: 14px; margin-top:10px; color: #eeeeee; text-shadow: 1px 1px 2px black;">
    <label><input type="checkbox" id="ruleAOI" onchange="updateSetupScoreDisplay()" />
      🧱 AOI / POI reagiert sichtbar
    </label>
    <small style="margin-left: 20px; color:#dddddd; text-shadow: 1px 1px 1px black;">
      ▶ Preis reagiert klar in AOI&POI (z. B. W, D1)
    </small>

    <label><input type="checkbox" id="ruleEntry" onchange="updateSetupScoreDisplay()" />
      🎯 Entry-Trigger bestätigt
    </label>
    <small style="margin-left: 20px; color:#dddddd; text-shadow: 1px 1px 1px black;">
      ▶ Rejection, Equal High/Low Raid, Shift
    </small>

    <label><input type="checkbox" id="ruleEntryPattern" onchange="updateSetupScoreDisplay()" />
      🧠 Einstiegsmuster sichtbar
    </label>
    <small style="margin-left: 20px; color:#dddddd; text-shadow: 1px 1px 1px black;">
      ▶ z. B. Inside Bar, Morning Star, Pinbar, Engulfing, Quasimodo
    </small>

    <label><input type="checkbox" id="rulePsych" onchange="updateSetupScoreDisplay()" />
      💡 Psychologisches Level
    </label>
    <small style="margin-left: 20px; color:#dddddd; text-shadow: 1px 1px 1px black;">
      ▶ 00/50-Level, Vorwochen-Hoch/Tief, runde Zahlen (z. B. 1900, 1950)
    </small>

    <label><input type="checkbox" id="ruleSession" onchange="updateSetupScoreDisplay()" />
      🕒 Richtiges Zeitfenster
    </label>
    <small style="margin-left: 20px; color:#dddddd; text-shadow: 1px 1px 1px black;">
      ▶ Killzones: London (08:00–11:00), New York (14:30–17:00), Asia (02:00–04:00)
    </small>

    <label><input type="checkbox" id="ruleRR" onchange="updateSetupScoreDisplay()" />
      📏 Minimum 1:2.5 RR
    </label>
    <small style="margin-left: 20px; color:#dddddd; text-shadow: 1px 1px 1px black;">
      ▶ Laut Struktur realistisch erreichbares Ziel: ≥ 2,5x SL-Distanz
    </small>

    <label><input type="checkbox" id="ruleLTFShift" onchange="updateSetupScoreDisplay()" />
      🔁 LTF Strukturwechsel (Shift)
    </label>
    <small style="margin-left: 20px; color:#dddddd; text-shadow: 1px 1px 1px black;">
      ▶ MSS auf 15M - 2H → z. B. HL → HH → LL
    </small>

    <div id="setupScoreDisplay" style="margin-top: 12px; font-size: 14px; font-weight: bold; color: #f0f0f0; text-shadow: 1px 1px 2px black;">
      📊 Setup-Score: <strong>0%</strong> – ❌ Nicht gültig
    </div>
  </div> <!-- ✅ Ende der Regel-Checkliste-Box -->

</div> <!-- ✅ Ende setupBoxWrapper -->

<!-- 🔻 Jetzt alles außerhalb der Box -->
<div style="margin-top: 20px; font-size: 14px; color: #eeeeee; text-shadow: 1px 1px 2px black;">

  <label>📝 Kommentar <strong>vor dem Trade</strong>:</label>
  <textarea id="journalNotesBefore" rows="2" class="input" style="border-radius: 6px; width: 100%; margin-bottom: 10px;"></textarea>

  <label>📝 Kommentar <strong>nach dem Trade</strong>:</label>
  <textarea id="journalNotesAfter" rows="2" class="input" style="border-radius: 6px; width: 100%; margin-bottom: 10px;"></textarea>

  <label for="screenshotInput">📸 Screenshots hochladen (optional):</label>
  <input type="file" id="screenshotInput" accept="image/*" multiple class="input" style="margin-bottom: 15px;" />

  <button id="saveJournalEntryButton" onclick="saveJournalEntry()" style="
    background-color: #0077cc;
    color: white;
    padding: 14px;
    border: none;
    border-radius: 8px;
    margin-top: 10px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    width: 100%;
  ">💾 Eintrag speichern</button>
</div>




<div id="lightboxOverlay" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:9999;" onclick="closeLightbox()">
  <img id="lightboxImage" src="" alt="Bild" style="max-width:90vw; max-height:90vh; border-radius:10px; box-shadow: 0 0 20px #000;" />
</div>

<!-- 🔍 Lightbox für vergrößerte Bilder -->
<div id="lightboxOverlay" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:9999;" onclick="closeLightbox()">
  <img id="lightboxImage" src="" alt="Full Screenshot" style="max-width:90vw; max-height:90vh; border-radius:10px; box-shadow: 0 0 20px #000;" />
</div>



<div class="popup" id="resultPopup">
  <h3>Ergebnis</h3>
  <input type="text" inputmode="decimal" id="pnlInput" placeholder="z. B. 120.50" value="00,00" />
  <button onclick="saveResult()">Speichern</button>
</div>


<body>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="scripts/session.js"></script>
<script src="scripts/screen.js"></script>
<script src="scripts/background-session.js"></script>
<script src="scripts/position.js"></script>
<script src="scripts/dawn.js"></script>
<script src="scripts/tax.js"></script>
<script src="imageStorage.js"></script>
<script src="scripts/bg-candles.js"></script>
<script src="scripts/ticker.js"></script>
<script src="scripts/jornal.js"></script>
<script src="scripts/pwa.js"></script>
<script src="scripts/AI.js"></script>

</body>

</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<script>
function sendPushNotification(title, message) {
  if ("Notification" in window && Notification.permission === "granted" && "serviceWorker" in navigator) {
    navigator.serviceWorker.ready.then((registration) => {
      registration.showNotification(title, {
        body: message,
        icon: "https://cdn-icons-png.flaticon.com/512/1827/1827409.png",
        vibrate: [200, 100, 200],
        tag: "session-alert",
        renotify: true
      });
    }).catch(err => {
      console.error("❌ Notification via Service Worker fehlgeschlagen:", err);
    });
  } else {
    console.warn("❌ Keine Notification möglich – Erlaubnis oder SW fehlen.");
  }
}

// ✅ Einheitlicher Notification-Aufruf für Sessionstarts
function showSessionStartNotification(sessionName, message) {
  const title = `📣 ${sessionName}-Session gestartet!`;
  sendPushNotification(title, message);
}

// ✅ Diagnosetool zum Testen
function diagnoseNotifications() {
  const output = document.getElementById("notificationStatus");
  output.style.display = "block";

  let msg = "🔍 <strong>Benachrichtigungs-Check:</strong><br>";

  if (!("Notification" in window)) {
    msg += "❌ Notifications werden vom Browser nicht unterstützt.<br>";
  } else {
    msg += `📱 Notification.permission: <strong>${Notification.permission}</strong><br>`;
    if (Notification.permission === "granted") {
      try {
        sendPushNotification("✅ Test-Notification", "🎯 Die Notification funktioniert!");
        msg += "✅ Test-Notification wurde ausgelöst.<br>";
      } catch (err) {
        msg += "❌ Fehler beim Notification-Aufruf: " + err.message + "<br>";
      }
    } else if (Notification.permission === "denied") {
      msg += "🚫 Du hast Benachrichtigungen blockiert.<br>";
    } else if (Notification.permission === "default") {
      Notification.requestPermission().then((perm) => {
        msg += `📩 Neue Erlaubnis: ${perm}<br>`;
      });
    }
  }

  output.innerHTML = msg;
}

// ✅ Aktivierungs-Button
function enableNotifications() {
  Notification.requestPermission().then(permission => {
    const statusBox = document.getElementById("notificationStatus");
    statusBox.style.display = "block";

    if (permission === "granted") {
      sendPushNotification("✅ Erlaubt", "Du bekommst ab jetzt Benachrichtigungen!");
      statusBox.innerHTML = "✅ Benachrichtigungen erlaubt!";
    } else if (permission === "denied") {
      statusBox.innerHTML = "❌ Benachrichtigungen blockiert. Aktiviere sie im Schloss-Symbol der Adresszeile.";
    } else {
      statusBox.innerHTML = "ℹ️ Keine Entscheidung getroffen.";
    }
  });
}
</script>





</html>
