const sessionText = document.getElementById("sessionText");
const sessionProgressEl = document.getElementById("sessionProgressDisplay");
const sessionInfoEl = document.getElementById("sessionInfo");
const sessionDetailsBox = document.getElementById("sessionDetailsBox");
const alertBox = document.getElementById("alertBox");
const progressBar = document.getElementById("progressBar");
const progressContainer = document.querySelector(".progress-container");

sessionText.addEventListener("click", () => {
  const visible = sessionDetailsBox.style.display === "block";
  sessionDetailsBox.style.display = visible ? "none" : "block";

  if (!visible) {
    const minutes = getMinutesNow();
    const activeSessions = getCurrentSessions(minutes);

    let fullInfo = "";

    // üîπ Headline
    fullInfo += `
      <div style="
        font-size: 18px;
        font-weight: bold;
        padding: 10px 15px;
        background: linear-gradient(to right, #222, #111);
        border-bottom: 1px solid #333;
        margin-bottom: 10px;
        letter-spacing: 1px;
      ">
        üîπ Aktive Sessions
      </div>
    `;

    if (activeSessions.length > 0) {
      activeSessions.forEach((s) => {
        let start = s.start;
        let end = s.end;
        if (start > end) end += 1440;
        let nowMins = minutes;
        if (nowMins < start) nowMins += 1440;
        const timeLeft = end - nowMins;

        const label = s.name.includes("Killzone") ? "üî•" :
                      s.name.includes("New York") ? "üá∫üá∏" :
                      s.name.includes("London") ? "üí∑" :
                      s.name.includes("Tokyo") ? "üåè" :
                      s.name.includes("Sydney") ? "üåô" :
                      s.name.includes("Crypto") ? "ü™ô" : "üü°";

        const color = sessionColors[s.name] || "#0cf";
        const glow = `0 0 5px ${color}, 0 0 12px ${hexToRgba(color, 0.5)}`;

       let weekDaysHtml = "";
if (s.weekDaysInfo) {
  weekDaysHtml = "<div style='margin-top:8px;'>";
  s.weekDaysInfo.forEach(({ day, text }) => {
    weekDaysHtml += `
      <div style="margin-bottom:4px;">
        <strong style="color:${color}; text-shadow:${glow};">${day}:</strong>
        <span style="color:#ccc;"> ${text}</span>
      </div>
    `;
  });
  weekDaysHtml += "</div>";
}


       fullInfo += `
  <div style="
    border-left: 4px solid ${color};
    padding: 12px 16px;
    margin: 12px 15px;
    background: rgba(255,255,255,0.02);
    border-radius: 10px;
    box-shadow: inset 0 0 6px ${hexToRgba(color, 0.3)};
    font-size: 14px;
    line-height: 1.6;
  ">
    <div style="font-size: 16px; font-weight: bold; color: ${color}; text-shadow: ${glow};">
      ${label} ${s.name}
    </div>
    ‚è±Ô∏è Noch <strong style="color:${color}; text-shadow:${glow};">${formatHM(timeLeft)}</strong><br>
    üìÖ Start: <strong style="color:${color}; text-shadow:${glow};">${formatHM(s.start)} Uhr</strong><br>
    üïì Ende: <strong style="color:${color}; text-shadow:${glow};">${formatHM(s.end)} Uhr</strong><br>
    ‚ÑπÔ∏è <span style="color:${color}; text-shadow:${glow};">${s.info}</span>
    ${weekDaysHtml}
  </div>
`;

      });
    } else {
      fullInfo += `<div style="padding:10px 15px;">‚è±Ô∏è Aktuell <strong>keine Session aktiv</strong></div>`;
    }

    // üîú N√§chste Session
    const futureSessions = sessions
      .map(s => ({
        ...s,
        startMins: s.start > minutes ? s.start : s.start + 1440
      }))
      .sort((a, b) => a.startMins - b.startMins);

    const next = futureSessions[0];
    const minsToNext = next.startMins - minutes;
    const nextColor = sessionColors[next.name] || "#999";
    const nextGlow = `0 0 5px ${nextColor}, 0 0 10px ${hexToRgba(nextColor, 0.4)}`;

    fullInfo += `
      <div style="
        font-size: 15px;
        margin: 18px 15px 10px 15px;
        color: ${nextColor};
        text-shadow: ${nextGlow};
      ">
        üîú <strong>N√§chste:</strong> ${next.name} in <strong>${formatHM(minsToNext)}</strong>
      </div>
    `;

    const name = activeSessions.length > 0 ? activeSessions[0].name : "";
if (name) {
  updateBodyBackground(name);
  manualSessionOverride = name; // optional, wenn du sp√§ter resetten willst
}

sessionDetailsBox.innerHTML = fullInfo;

  }
});





function formatHM(mins) {
  const h = Math.floor(mins / 60) % 24;
  const m = mins % 60;
  return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
}

const sessionColors = {
  Sydney: "#3388ff",
  Tokyo: "#00aaff",
  London: "#ffd700",
  "New York": "#ff4500",
  "London Killzone": "#ccff00",
  "New York Killzone": "#ff8800",
  Deadzone: "#333",
  Crypto: "#9900ff"  // üî• Jetzt mit Farbe!
};


const sessions = [
  {
    name: "Sydney",
    start: 1380,
    end: 480,
    info: "Ruhiger Markt, geringere Liquidit√§t, Vorbereitung auf Asien.",
    weekDaysInfo: [
      { day: "Sonntag", text: "üõ†Ô∏è Vorbereitung auf neue Woche" },
      { day: "Montag", text: "üåè Asien-Session startet ‚Äì AUD/USD, NZD/USD im Fokus" },
      { day: "Mittwoch", text: "üìä Wirtschaftsdaten Australien ‚Äì AUD/CAD, AUD/JPY interessant" },
      { day: "Freitag", text: "üìÖ W√∂chentliche Analyse & Planung ‚Äì AUD/NZD Moves m√∂glich" }
    ],
  },
  {
    name: "Tokyo",
    start: 60,
    end: 600,
    info: "Moderate Volatilit√§t, Fokus auf JPY/AUD/NZD, Breakouts m√∂glich.",
    weekDaysInfo: [
      { day: "Dienstag", text: "üè¶ BoJ Pressekonferenz ‚Äì EUR/JPY, GBP/JPY sehr aktiv" },
      { day: "Donnerstag", text: "üìà Japan BIP-Daten ‚Äì USD/JPY, CAD/JPY im Blick behalten" },
      { day: "Freitag", text: "üá∫üá∏ US NFP wirkt oft nach ‚Äì Yen-Paare volatil: USD/JPY, GBP/JPY" }
    ],
  },
  {
    name: "London",
    start: 540,
    end: 1020,
    info: "Hohe Liquidit√§t, starke Bewegungen, europ√§ische Wirtschaftsdaten.",
    weekDaysInfo: [
      { day: "Montag", text: "üìâ EU Handelsdaten ‚Äì EUR/USD, EUR/JPY, DAX" },
      { day: "Dienstag", text: "üèõÔ∏è Zinsentscheidungen der EZB ‚Äì EUR/USD, EUR/GBP, EUR/CHF" },
      { day: "Donnerstag", text: "üìä Inflationsdaten UK ‚Äì GBP/USD, GBP/JPY, FTSE100" },
      { day: "Freitag", text: "üìÖ Arbeitsmarktdaten UK ‚Äì GBP/USD, EUR/GBP" }
    ],
  },
  {
    name: "New York",
    start: 870,
    end: 1380,
    info: "Hohe Volatilit√§t, US-Daten dominieren, Trendfortsetzungen m√∂glich.",
    weekDaysInfo: [
      { day: "Mittwoch", text: "üè¶ Fed Zinsentscheidungen ‚Äì USD/JPY, EUR/USD, Gold (XAU/USD)" },
      { day: "Freitag", text: "üìä US NFP Arbeitsmarktdaten ‚Äì XAU/USD, NAS100, USD/CHF" },
      { day: "Freitag", text: "üìà W√∂chentliche Arbeitslosenmeldung ‚Äì EUR/USD, USD/CAD" }
    ],
  },
  {
    name: "London Killzone",
    start: 420,
    end: 660,
    info: "Volatile Phase vor London-Open, Stop-Hunts m√∂glich.",
    weekDaysInfo: [
      { day: "Montag", text: "‚ö° Hohe Volatilit√§t durch Markt√∂ffnung ‚Äì GBP/USD, EUR/JPY" },
      { day: "Mittwoch", text: "üî• Breakouts oft m√∂glich ‚Äì GBP/JPY, DAX, EUR/USD" }
    ],
  },
  {
    name: "New York Killzone",
    start: 810,
    end: 1020,
    info: "Start der NY Session, hohe Aktivit√§t, gute Chancen f√ºr Daytrader.",
    weekDaysInfo: [
      { day: "Dienstag", text: "‚ö° Erh√∂hte Volatilit√§t durch US-Daten ‚Äì XAU/USD, NAS100" },
      { day: "Donnerstag", text: "üéôÔ∏è Fed Reden & Daten ‚Äì USD/JPY, Gold, SPX500" }
    ],
  },
  {
    name: "Deadzone",
    start: 1380,
    end: 0,
    info: "Niedrige Volatilit√§t, Seitw√§rtsbewegungen, Ruhephase.",
    weekDaysInfo: [
      { day: "T√§glich", text: "üò¥ Markt ruhig, kaum Bewegung ‚Äì Scalping-Pause empfohlen" }
    ],
  },
  {
    name: "Crypto",
    start: 0,
    end: 1440,
    info: "Krypto l√§uft 24/7 ‚Äì Spitzenvolumen oft bei √úberschneidung mit NY & Asien.",
    weekDaysInfo: [
      { day: "Montag", text: "üöÄ Reaktion auf Wochenstart ‚Äì Gap-Moves checken ‚Äì BTC/USD, ETH/USD" },
      { day: "Mittwoch", text: "üìâ Midweek-Reversal bei BTC h√§ufig ‚Äì BTC/USD, SOL/USDT" },
      { day: "Freitag", text: "üí∏ Ausbruch vor Wochenende, dann Flat Market ‚Äì ETH/USD, XRP/USD" },
      { day: "Samstag", text: "üßò Wenig Volumen ‚Äì Fokus auf Konsolidierungen ‚Äì BTC, ETH" },
      { day: "Sonntag", text: "‚è≥ Pre-Move f√ºr Montag oft sichtbar ‚Äì BTC/USD, LINK/USDT" }
    ],
  }
];




let lastAlertSession = null;

function getMinutesNow() {
  const now = new Date();
  return now.getHours() * 60 + now.getMinutes();
}

function getCurrentSessions(minNow) {
  return sessions.filter((s) => {
    const start = s.start;
    const end = s.end;
    if (start > end) {
      return minNow >= start || minNow < end;
    } else {
      return minNow >= start && minNow < end;
    }
  });
}

function updateGradientBar(colors) {
  if (colors.length === 0) {
    progressBar.style.background = "#444";
    progressBar.style.backgroundImage = "";
    return;
  }
  const svg = `
    <svg xmlns='http://www.w3.org/2000/svg' width='100%' height='100%'>
      <defs>
        <linearGradient id='g' x1='0%' y1='0%' x2='100%' y2='0%'>
          ${colors.map((c, i) => `<stop offset='${(i / (colors.length - 1)) * 100}%' stop-color='${c}'/>`).join("")}
        </linearGradient>
      </defs>
      <rect x='0' y='0' width='100%' height='100%' fill='url(#g)'/>
    </svg>`;
  const base64 = btoa(svg);
  progressBar.style.backgroundImage = `url("data:image/svg+xml;base64,${base64}")`;
}

function hexToRgba(hex, alpha) {
  hex = hex.replace("#", "");
  const r = parseInt(hex.substring(0, 2), 16);
  const g = parseInt(hex.substring(2, 4), 16);
  const b = parseInt(hex.substring(4, 6), 16);
  return `rgba(${r},${g},${b},${alpha})`;
}

function getMinutesToNextSession(minNow) {
  const futureStarts = sessions.map((s) => s.start).filter((start) => start > minNow);
  if (futureStarts.length === 0) return sessions[0].start + 1440 - minNow;
  return Math.min(...futureStarts) - minNow;
}

const alertSound = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');

function requestNotificationPermission() {
  if ("Notification" in window && Notification.permission !== "granted") {
    Notification.requestPermission().then(permission => {
      console.log("üîê Notification permission:", permission);
    });
  }
}



function updateRealTimeBar() {
	
  const now = new Date();
  const weekday = now.getDay(); // Sonntag = 0, Samstag = 6
  const hours = String(now.getHours()).padStart(2, "0");
  const mins = String(now.getMinutes()).padStart(2, "0");
  const minutes = now.getHours() * 60 + now.getMinutes();
  const percent = (minutes / 1439) * 100;

  // Fortschrittsbalken immer aktualisieren
  progressBar.style.width = `${percent}%`;
progressBar.style.background = "linear-gradient(270deg, #00ffcc, #ff00cc, #9900ff)";
progressBar.style.animation = "cryptoBarShift 8s linear infinite";
progressContainer.style.boxShadow = "0 0 14px 4px rgba(153, 0, 255, 0.4)";

  

  // ‚úÖ Definiere echten Krypto-Wochenende-Zeitraum
  const isCryptoWeekend =
    (weekday === 6) || // Samstag
    (weekday === 0) || // Sonntag
    (weekday === 5 && minutes >= 1380); // Freitag ab 23:00

  if (isCryptoWeekend) {
    sessionText.textContent = `üïí ${hours}:${mins} | Krypto-Wochenende aktiv`;
    sessionInfoEl.innerHTML = `
      üì¥ Forex & Indizes geschlossen ‚Äì
      <span class="crypto-animate">
        <span class="coin">ü™ô</span> Krypto 24/7!
      </span>
    `;
    sessionProgressEl.innerHTML = "üü¢ Aktive Crypto-Session ‚Äì Trade BTC, ETH & Co. jederzeit!";
sessionInfoEl.style.background = "linear-gradient(135deg, rgba(255,0,204,0.15), rgba(0,255,255,0.15))";
sessionInfoEl.style.textShadow = "0 0 4px #ff00cc, 0 0 8px #00ffff";
sessionInfoEl.style.boxShadow = "inset 0 0 10px rgba(153, 0, 255, 0.25), 0 0 6px rgba(0, 255, 255, 0.15)";
sessionInfoEl.style.color = "#ffffff";


    let weekendInfo = "";

    if (weekday === 5 && minutes >= 1380) {
      weekendInfo = `
        <strong>ü™ô Krypto ist aktiv (24/7)</strong><br>
        üìÖ <strong>Freitagabend:</strong><br>
        ‚Ä¢ üïñ Letzte Volatilit√§t vor dem Wochenschluss (18‚Äì22 Uhr)<br>
        ‚Ä¢ üîÅ Take-Profits & Wochenschluss-Spikes<br>
        ‚Ä¢ üìâ BTC oft r√ºckl√§ufig durch Positionsschlie√üungen<br>
        ‚Ä¢ ‚ö†Ô∏è Fakeouts & Liquidit√§tsgrabs vor der Ruhephase<br><br>
        üöÄ Bereite deine Watchlist f√ºrs Wochenende vor!
      `;
    } else if (weekday === 6) {
      weekendInfo = `
        <strong>ü™ô Krypto ist aktiv (24/7)</strong><br>
        üìÖ <strong>Samstag:</strong><br>
        ‚Ä¢ üò¥ Niedriges Volumen ‚Äì kaum Institutionelle aktiv<br>
        ‚Ä¢ üîÑ Meist Seitw√§rtsphasen ‚Üí ideal f√ºr Range-Trading<br>
        ‚Ä¢ ‚ùÑÔ∏è Impulsarme M√§rkte, gute Zeit f√ºr technische Analyse<br>
        ‚Ä¢ üìê Setups vorbereiten & Trading-Journal pflegen<br><br>
        üßò Fokus auf Klarheit statt Action ‚Äì perfekter Analyse-Tag.
      `;
    } else if (weekday === 0) {
      weekendInfo = `
        <strong>ü™ô Krypto ist aktiv (24/7)</strong><br>
        üìÖ <strong>Sonntag:</strong><br>
        ‚Ä¢ ‚è≥ Pre-Move-Phase startet oft ab 18‚Äì20 Uhr<br>
        ‚Ä¢ üß† Smart Money beginnt Positionierung f√ºr Montag<br>
        ‚Ä¢ ü™§ False Breakouts oder ‚ÄûLiquidity Sweeps‚Äú typisch<br>
        ‚Ä¢ üî• Volumen steigt sp√ºrbar, besonders vor News-Wochen<br><br>
        üöÄ Nutze den Sonntagabend f√ºr Setup-Feintuning & Ausblick!
      `;
    }

    sessionDetailsBox.innerHTML = weekendInfo;
    return; // üëâ Verhindert normale Session-Anzeige
  }


  // ‚è¨ Werktag-Session-Logik
  const activeSessions = getCurrentSessions(minutes);
  const names = activeSessions
  .map(s => s.name)
  .filter(n => n !== "Crypto"); // üî• Crypto wird vom Balken ausgeschlossen
updateTabButtonColors(names);
  const activeNames = names.length > 0 ? `| Aktive Session: ${names.join(" + ")}` : "| Keine Session aktiv";
  sessionText.textContent = `üïí ${hours}:${mins} ${activeNames}`;

  const colors = names.map(n => sessionColors[n] || "#666");
  updateGradientBar(colors);
  if (document.getElementById("sessionProgressDisplay")) {
  showSessionProgress(activeSessions, minutes);
}


  progressContainer.style.boxShadow = colors.length > 0
    ? `0 0 12px 6px ${hexToRgba(colors[0], 0.6)}`
    : "0 0 12px 6px rgba(0,0,0,0)";

  const name = activeSessions.length > 0 ? activeSessions[0].name : "";
  let infoText = "Keine aktiven Sessions ‚Äì Markt wahrscheinlich ruhig.";
  

if (name === "Sydney") {
  infoText = minutes >= 1380 ? "üåô Sydney startet ‚Äì ruhiger Handelsbeginn, Fokus auf AUD/NZD." :
              minutes < 180 ? "ü¶ò Sydney aktiv ‚Äì geringe Volatilit√§t, Setups oft technisch." :
              "üåÖ Sp√§te Sydney-Phase ‚Äì √úbergang zu Tokyo beginnt.";
} else if (name === "Tokyo") {
    infoText = minutes < 180 ? "üåè Tokyo er√∂ffnet ‚Äì erste Bewegungen durch asiatische H√§ndler." :
                minutes < 360 ? "üáØüáµ Asiatische Volatilit√§t aktiv ‚Äì m√∂gliche Bewegungen bei JPY." :
                "üõë Tokyo flacht ab ‚Äì Fokus wechselt langsam nach Europa.";
  } else if (name === "London Killzone") {
    infoText = "‚ö†Ô∏è London Killzone ‚Äì hohe Volatilit√§t & starke Bewegungen m√∂glich.";
	
  } else if (name === "London") {
    infoText = minutes < 720 ? "üí∑ London Session ‚Äì Markt in Bewegung, europ√§ische Daten entscheidend." :
                minutes < 840 ? "üò¥ Mittagliche Deadzone ‚Äì Markt konsolidiert h√§ufig, Vorsicht bei Entries." :
                "üìà London-Teilnehmer bleiben aktiv ‚Äì Vorbereitung auf NY.";
  } else if (name === "New York Killzone") {
    infoText = "üî• New York Killzone ‚Äì starke Reaktionen auf US-News & Breakouts m√∂glich.";
  } else if (name === "New York") {
    infoText = minutes < 1080 ? "üá∫üá∏ New York Session ‚Äì starker US-Einfluss, Trendfortsetzungen m√∂glich." :
                minutes < 1200 ? "üìâ New York flacht ab ‚Äì Markt beruhigt sich langsam." :
                "üåÉ New York Session endet ‚Äì geringe Bewegung, Vorsicht bei Entries.";
  } else if (name === "Crypto") {
    if (weekday === 6) {
      infoText = "üßò Samstag ‚Äì ruhige Konsolidierungen, optimal f√ºr Range-Trading.";
    } else if (weekday === 0) {
      infoText = minutes < 1080 ? "üò¥ Sonntagvormittag ‚Äì flacher Markt, aber Pre-Move kann sich aufbauen." :
                  "‚è≥ Sonntagabend ‚Äì m√∂gliche Pre-Moves vor dem Forex-Start.";
    } else if (weekday === 5 && minutes >= 1080) {
      infoText = "üí∏ Freitagabend ‚Äì letzte Volatilit√§t, oft BTC-Ausbr√ºche vor dem Wochenende.";
    } else {
      infoText = "ü™ô Krypto l√§uft 24/7 ‚Äì typischer Fokus: BTC/ETH & News-getriebene Altcoins.";
    }
  } else if (minutes >= 720 && minutes < 840) {
    infoText = "üò¥ Mittagliche Deadzone ‚Äì Markt konsolidiert h√§ufig, Vorsicht bei Entries.";
 } else if (minutes >= 1380 || minutes < 60) {
  if (activeSessions.length === 0) {
    infoText = "üåô Nacht-Deadzone ‚Äì Markt ist extrem ruhig, keine relevanten Bewegungen.";
  }
}

updateBodyBackground(name);
  sessionInfoEl.textContent = infoText;

  // üìã Aktive Session-Details + Wochentagstexte
  if (activeSessions.length > 0) {
    let fullInfo = "";

    activeSessions.forEach(s => {
      let weekDaysHtml = "";
      if (s.weekDaysInfo) {
        weekDaysHtml = "<ul style='margin-left:18px; margin-top:4px;'>";
        s.weekDaysInfo.forEach(({ day, text }) => {
          weekDaysHtml += `<li><strong>${day}:</strong> ${text}</li>`;
        });
        weekDaysHtml += "</ul>";
      }

      const label = s.name.includes("Killzone") ? "üî•" :
                    s.name.includes("New York") ? "üá∫üá∏" :
                    s.name.includes("London") ? "üí∑" :
                    s.name.includes("Tokyo") ? "üåè" :
                    s.name.includes("Sydney") ? "üåô" :
                    s.name.includes("Crypto") ? "ü™ô" : "üü°";

      fullInfo += `
        <strong>${label} ${s.name}</strong><br>
        üìÖ Start: ${formatHM(s.start)} Uhr<br>
        üïì Ende: ${formatHM(s.end)} Uhr<br>
        ‚ÑπÔ∏è ${s.info}
        ${weekDaysHtml}
        <hr style="border: none; border-top: 1px solid #444; margin: 10px 0;">
      `;
    });

    sessionDetailsBox.innerHTML = fullInfo;
  } else {
    sessionDetailsBox.innerHTML = "Keine aktive Session ‚Äì Markt ist ruhig.";
  }

  // ‚è∞ Session-Wechsel-Warnung
  const minutesToNext = getMinutesToNextSession(minutes);
  if (minutesToNext <= 5 && minutesToNext > 0) {
    const currentActive = sessionText.textContent;
    if (lastAlertSession !== currentActive) {
      showAlert(`‚ö†Ô∏è Session-Wechsel in 5 Minuten!`);
      lastAlertSession = currentActive;

      if (activeSessions.length > 0) {
        const s = activeSessions[0];
        showSessionStartNotification(s.name, s.info);
      }
    }
  } else {
    lastAlertSession = null;
  }
// ‚úÖ Nur setzen, wenn noch nichts drinsteht (Backup)
if (!sessionInfoEl.innerHTML.trim()) {
  sessionInfoEl.textContent = infoText;
}


// üé® Farbe aus aktiver Session √ºbernehmen
if (sessionColors[name]) {
  const infoColor = sessionColors[name];
  sessionInfoEl.style.background = hexToRgba(infoColor, 0.07);
  sessionInfoEl.style.color = infoColor;
  sessionInfoEl.style.textShadow = `0 0 2px ${infoColor}, 0 0 6px ${hexToRgba(infoColor, 0.3)}`;
  sessionInfoEl.style.boxShadow = `inset 0 0 6px ${hexToRgba(infoColor, 0.15)}`;
} else {
  // Standard-Fallback
  sessionInfoEl.style.background = "transparent";
  sessionInfoEl.style.color = "#ccc";
  sessionInfoEl.style.textShadow = "none";
  sessionInfoEl.style.boxShadow = "none";
}

}



function updateDaySummary() {
  const days = ["Sonntag", "Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag"];
  const infos = {
    "Montag": `
üöÄ Start in die Woche ‚Äì neue Impulse, frische Trends m√∂glich.
ü™ô Krypto oft ruhig nach Sonntag ‚Äì Fokus auf BTC-Reaktion.
    `,
    "Dienstag": `
üìà Trend-Fortsetzung oder technische Korrekturen im Forex.
ü™ô BTC & Altcoins reagieren oft auf Marktstimmung.
    `,
    "Mittwoch": `
‚ö†Ô∏è Midweek-Reversal m√∂glich ‚Äì Vorsicht bei Trendwechseln.
ü™ô BTC h√§ufig impulsiv ‚Äì Fakeouts nicht selten.
    `,
    "Donnerstag": `
üìä News-Donnerstag ‚Äì viele Wirtschaftsreleases.
ü™ô Volatile Altcoins ‚Äì gute Chancen f√ºr Breakouts.
    `,
    "Freitag": `
üìÖ Wochenabschluss ‚Äì Gewinne sichern, keine Paniktrades.
ü™ô Abends oft BTC-Volatilit√§t vor dem Krypto-Wochenende.
    `,
    "Samstag": `
üì¥ Forex geschlossen ‚Äì Markt schl√§ft.
ü™ô Nur Krypto aktiv ‚Äì ideale Zeit f√ºr Range-Trading & Analyse.
    `,
    "Sonntag": `
üõ†Ô∏è Vorbereitung auf neue Woche ‚Äì Forex inaktiv.
ü™ô BTC Pre-Move oft ab 18‚Äì20 Uhr ‚Äì Setup planen!
    `
  };


  const now = new Date();
  const dayIndex = now.getDay();
  const dayName = days[dayIndex];
  const info = infos[dayName] || "üìÜ Trading-Tag";

  const el = document.getElementById("daySummary");
  el.textContent = `üóìÔ∏è ${dayName} ‚Äì ${info}`;
}
function getSessionColor(sessionName) {
  const sessionColors = {
    "London": "#FFD700",
    "New York": "#FF4500",
    "Tokyo": "#00c8ff",
    "Sydney": "#0070ff",
    "Crypto": "#9900ff"
  };
  return sessionColors[sessionName] || "#0cf";
}

function hexToRgba(hex, opacity) {
  const bigint = parseInt(hex.replace("#", ""), 16);
  const r = (bigint >> 16) & 255;
  const g = (bigint >> 8) & 255;
  const b = bigint & 255;
  return `rgba(${r}, ${g}, ${b}, ${opacity})`;
}

document.addEventListener("DOMContentLoaded", () => {
  const daySummaryEl = document.getElementById("daySummary");
  const dayDetailsEl = document.getElementById("dayDetails");
const dayDetailsMap = {
  "Montag": `
üîµ <strong>Montag</strong><br><br>
<strong>üìå Setup:</strong><br>
Wochenstart ‚Äì noch keine klare Richtung. Fokus auf erste Liquidit√§tsreaktionen.<br><br>

<strong>‚úÖ Strategie:</strong><br>
Vorsichtiger Einstieg nach London-Open (09:00‚Äì10:00 Uhr)<br><br>

<strong>üïì Marktverhalten:</strong><br>
Volumen steigt langsam an ‚Äì viele Trader warten auf Dienstag.<br><br>

<strong>üìä Wirtschaftsdaten:</strong><br>
<ul>
  <li>üá™üá∫ EU-Handelsdaten, Sentiment-Indikatoren</li>
  <li>üí¨ Kaum US-Daten ‚Äì NY-Session eher tr√§ge</li>
</ul><br>

<strong>üß† Mentaler Fokus:</strong><br>
Geduldig bleiben ‚Äì erste Impulse beobachten.<br><br>

<strong>üßæ To-do am Montag:</strong><br>
<ul>
  <li>üìÖ Wochenziele notieren</li>
  <li>üìà H1/H4 Bias eintragen</li>
</ul><br>

<strong>ü™ô Krypto-Notiz:</strong><br>
BTC reagiert oft tr√§ge nach dem Wochenende ‚Äì Strukturaufbau bis Montagabend.<br>
ETH/BTC-Paare zeigen erste Signale f√ºr Volatilit√§t der Woche.
`,

  "Dienstag": `
üü¢ <strong>Dienstag</strong><br><br>
<strong>üìå Setup:</strong><br>
Intraday-Trading meist am klarsten ‚Äì oft Trendfortsetzung oder Retest.<br><br>

<strong>‚úÖ Strategie:</strong><br>
Nutze saubere Marktstruktur ‚Üí Breakouts + Retest m√∂glich.<br><br>

<strong>üïì Marktverhalten:</strong><br>
Konstant ‚Äì London & NY liefern gute Bewegungen.<br><br>

<strong>üìä Wirtschaftsdaten:</strong><br>
<ul>
  <li>üá™üá∫ EZB oder UK Reden m√∂glich</li>
  <li>üá∫üá∏ US-Einstiegsdaten</li>
</ul><br>

<strong>üß† Mentaler Fokus:</strong><br>
Keine Hektik ‚Äì Struktur traden.<br><br>

<strong>üßæ To-do am Dienstag:</strong><br>
<ul>
  <li>‚öôÔ∏è Trade-Log abgleichen</li>
  <li>üìì Swing-Kandidaten markieren</li>
</ul><br>

<strong>ü™ô Krypto-Notiz:</strong><br>
BTC/ETH ziehen meist am Dienstag an ‚Äì viele Altcoins folgen.<br>
Guter Tag f√ºr FVG/Breaker-Entry in Krypto.
`,

  "Mittwoch": `
üü° <strong>Mittwoch</strong><br><br>
<strong>üìå Setup:</strong><br>
Midweek-Reversal ‚Äì viele Fehlausbr√ºche m√∂glich.<br><br>

<strong>‚úÖ Strategie:</strong><br>
Reversal-Potenziale beachten, Killzones gezielt handeln.<br><br>

<strong>üïì Marktverhalten:</strong><br>
Volatilit√§t steigt ‚Äì Intraday-Highs/Lows werden geholt.<br><br>

<strong>üìä Wirtschaftsdaten:</strong><br>
<ul>
  <li>üè¶ FOMC/Fed Minutes</li>
  <li>üá™üá∫ EU/UK Inflationsdaten</li>
</ul><br>

<strong>üß† Mentaler Fokus:</strong><br>
Flexibel bleiben ‚Äì Bias kann kippen.<br><br>

<strong>üßæ To-do am Mittwoch:</strong><br>
<ul>
  <li>üìà Midweek-Revue</li>
</ul><br>

<strong>ü™ô Krypto-Notiz:</strong><br>
BTC macht oft genau am Mittwoch seine Wochenrichtung klar oder Fake-Move ‚Äì Fokus auf Liquidit√§tszonen.
`,

  "Donnerstag": `
üü† <strong>Donnerstag</strong><br><br>
<strong>üìå Setup:</strong><br>
Momentum-Tag ‚Äì viele Impulse durch News.<br><br>

<strong>‚úÖ Strategie:</strong><br>
NY-Killzone aktiv handeln ‚Äì Fokus auf USD, Gold, NAS100.<br><br>

<strong>üïì Marktverhalten:</strong><br>
London & NY klar ‚Äì guter Trend-Tag.<br><br>

<strong>üìä Wirtschaftsdaten:</strong><br>
<ul>
  <li>üá∫üá∏ GDP, PCE, CPI</li>
</ul><br>

<strong>üß† Mentaler Fokus:</strong><br>
Mutig, aber sauber ‚Äì Reaktionen abwarten.<br><br>

<strong>üßæ To-do am Donnerstag:</strong><br>
<ul>
  <li>üß† Gewinne sichern</li>
</ul><br>

<strong>ü™ô Krypto-Notiz:</strong><br>
Donnerstag ist oft der ‚ÄûCatch-up-Tag‚Äú f√ºr Altcoins ‚Äì hohe Dynamik bei Krypto-Volumen im NY-Overlap.
`,

  "Freitag": `
üî¥ <strong>Freitag</strong><br><br>
<strong>üìå Setup:</strong><br>
Scalping & Intraday ‚Äì gro√üe Bewegungen meist vorbei.<br><br>

<strong>‚úÖ Strategie:</strong><br>
Nur Liquidit√§tsjagden handeln ‚Äì keine blind Breakouts.<br><br>

<strong>üïì Marktverhalten:</strong><br>
Ruhiger ab 13:00 Uhr ‚Äì Positionsschlie√üung dominiert.<br><br>

<strong>üìä Wirtschaftsdaten:</strong><br>
<ul>
  <li>üìà US-Arbeitsmarktdaten (oft 14:30 Uhr)</li>
</ul><br>

<strong>üß† Mentaler Fokus:</strong><br>
Kein FOMO, kein Revenge-Trading.<br><br>

<strong>üßæ To-do am Freitag:</strong><br>
<ul>
  <li>üìä Wochenstatistik eintragen</li>
</ul><br>

<strong>ü™ô Krypto-Notiz:</strong><br>
Ab 18:00 Uhr: BTC beginnt Pre-Move f√ºr Wochenende.<br>
BTC/ETH brechen oft vor dem ‚ÄûKrypto-Samstag‚Äú aus ‚Äì Watchlist ready machen.
`,

  "Samstag": `
üì¥ <strong>Samstag</strong><br><br>
Kein Handel in Forex ‚Äì aber Krypto l√§uft.<br><br>

<strong>ü™ô Krypto-Notiz:</strong><br>
‚Ä¢ Wenig Volumen ‚Äì ideal f√ºr Struktur-Analyse<br>
‚Ä¢ Range-Trading auf BTC/ETH sehr effektiv<br>
‚Ä¢ Vorbereitung auf Sonntag ‚Üí Pre-Move beachten
`,

  "Sonntag": `
üì¥ <strong>Sonntag</strong><br><br>
Noch kein Handel in Forex ‚Äì aber wichtigster Vorbereitungstag.<br><br>

<strong>ü™ô Krypto-Notiz:</strong><br>
‚Ä¢ Ab 18:00 Uhr: BTC/ETH zeigen oft erste Richtung<br>
‚Ä¢ Pre-Move f√ºr die Woche sichtbar<br>
‚Ä¢ Setups validieren & Einstiegslevel berechnen
`
};


  if (daySummaryEl && dayDetailsEl) {
  daySummaryEl.addEventListener("click", () => {
  const now = new Date();
  const dayName = ["Sonntag", "Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag"][now.getDay()];
  const rawContent = dayDetailsMap[dayName] || "üìÜ Keine Details f√ºr diesen Tag.";

  // Session-Name zu Tag zuordnen
  const sessionMap = {
    "Montag": "London",
    "Dienstag": "London",
    "Mittwoch": "Tokyo",
    "Donnerstag": "New York",
    "Freitag": "New York",
    "Samstag": "Crypto",
    "Sonntag": "Crypto"
  };

  const color = getSessionColor(sessionMap[dayName]);
  const glow = `0 0 5px ${color}, 0 0 12px ${hexToRgba(color, 0.5)}`;

  const wrappedContent = `
    <div style="
      padding: 16px;
      margin: 15px;
      border-left: 4px solid ${color};
      border-radius: 10px;
      background: rgba(255,255,255,0.02);
      box-shadow: inset 0 0 8px ${hexToRgba(color, 0.3)};
      color: #ccc;
      line-height: 1.6;
      font-size: 14px;
    ">
      <div style="font-size: 17px; font-weight: bold; color: ${color}; text-shadow: ${glow}; margin-bottom: 8px;">
        üìÖ ${dayName}
      </div>
      <div style="color:#ccc;">
        ${rawContent.replaceAll("<strong>", `<strong style="color:${color}; text-shadow:${glow};">`)}
      </div>
    </div>
  `;

  const visible = dayDetailsEl.style.display === "block";
  dayDetailsEl.style.display = visible ? "none" : "block";
  if (!visible) dayDetailsEl.innerHTML = wrappedContent;
});

  }

  updateDaySummary();
});

function updateBodyBackground(sessionName) {
  const glowMap = {
    "Sydney": "radial-gradient(ellipse at bottom, rgba(0, 128, 255, 0.15) 0%, transparent 70%)",
    "Tokyo": "radial-gradient(ellipse at bottom, rgba(0, 200, 255, 0.15) 0%, transparent 70%)",
    "London": "radial-gradient(ellipse at bottom, rgba(255, 215, 0, 0.1) 0%, transparent 70%)",
    "New York": "radial-gradient(ellipse at bottom, rgba(255, 69, 0, 0.1) 0%, transparent 70%)",
    "London Killzone": "radial-gradient(ellipse at bottom, rgba(204, 255, 0, 0.15) 0%, transparent 70%)",
    "New York Killzone": "radial-gradient(ellipse at bottom, rgba(255, 136, 0, 0.15) 0%, transparent 70%)",
    "Crypto": "radial-gradient(ellipse at bottom, rgba(153, 0, 255, 0.2) 0%, transparent 70%)"
  };

  const baseColor = {
    "Sydney": "#0a0e1a",
    "Tokyo": "#0a1018",
    "London": "#1b1a0e",
    "New York": "#1a0e0e",
    "London Killzone": "#12160a",
    "New York Killzone": "#1a1408",
    "Crypto": "#1b0e1e"
  };

  const sessionColorClassMap = {
    "Sydney": "session-sydney",
    "Tokyo": "session-tokyo",
    "London": "session-london",
    "New York": "session-ny",
    "London Killzone": "session-killzone",
    "New York Killzone": "session-killzone",
    "Crypto": "session-crypto"
  };

  // ‚úÖ Korrektur: Parameter `sessionName` statt `name`
  sessionDetailsBox.className = "session-details-box";
  if (sessionColorClassMap[sessionName]) {
    sessionDetailsBox.classList.add(sessionColorClassMap[sessionName]);
  }

  document.body.style.setProperty("--session-glow", glowMap[sessionName] || "radial-gradient(ellipse at bottom, rgba(255,255,255,0.1) 0%, transparent 70%)");
  document.body.style.setProperty("--session-bg-color", baseColor[sessionName] || "#111");
}





window.addEventListener("load", () => {
  requestNotificationPermission();
  updateRealTimeBar();

  updateDaySummary(); // üìÖ Wochentag-Anzeige aktualisieren

  setInterval(updateRealTimeBar, 60000);
});